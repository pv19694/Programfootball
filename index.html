
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏ô‡∏≤‡∏°‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏• Jakhong</title>
  <script src="https://cdn.tailwindcss.com"></script>
  
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap" rel="stylesheet">
  
<style>
  @layer components {
    .input { @apply w-full rounded-xl border border-slate-300 px-3 py-2 text-sm
                   focus:outline-none focus:ring-2 focus:ring-slate-400; }
    .lbl   { @apply block mb-1 text-sm font-medium text-slate-700; }

    .btn   { @apply inline-flex items-center justify-center rounded-xl px-3 py-2 text-sm font-medium
                     border transition shadow-sm hover:shadow active:scale-[.99]; }
    .btn-green { @apply bg-emerald-500 text-white border-transparent hover:bg-emerald-600; }  /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤ */
    .btn-white { @apply bg-white text-slate-700 border-slate-300 hover:bg-slate-50; }         /* ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°/‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î */
    .btn-red   { @apply bg-rose-500 text-white border-transparent hover:bg-rose-600; }         /* ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å/‡∏•‡∏ö‡∏£‡∏π‡∏õ */

    .btn-ghost { @apply bg-white text-slate-700 border-slate-300 hover:bg-slate-50; }          /* ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πà‡∏≠‡∏¢ ‡πÜ */
    .chip      { @apply inline-flex items-center rounded-full bg-slate-100 text-slate-700
                         px-2 py-0.5 text-[11px] font-medium; }
    .avatar { @apply w-40 h-40 md:w-56 md:h-56 rounded-2xl bg-slate-100 grid place-items-center text-3xl overflow-hidden; }
    .avatar img { width:100%; height:100%; object-fit:cover; display:block; }
  }
    :root{ color-scheme:light; --team-color:#16a34a; --team-contrast:#ffffff }
    body{font-family:'Kanit',system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    .page{display:none}.page.active{display:block}
    .btn{border-radius:.9rem;padding:.55rem .9rem;font-weight:700;cursor:pointer}
    .btn-main{background:#0ea5e9;color:#fff;box-shadow:0 8px 18px rgba(14,165,233,.25)}
    .btn-s{background:#3b82f6;color:#fff;border-radius:.9rem;padding:.5rem .9rem}
    .btn-danger{background:#ef4444;color:#fff;border-radius:.9rem;padding:.5rem .9rem}
    .inp,.sel{width:100%;padding:.7rem;border:2px solid #e5e7eb;border-radius:.9rem;background:#fff}
    .inp:focus,.sel:focus{outline:none;border-color:#93c5fd;box-shadow:0 0 0 4px rgba(147,197,253,.3)}
    .card{background:#fff;border-radius:1rem;box-shadow:0 1px 4px rgba(0,0,0,.08);padding:1rem;text-align:center}
    .card .t{font-size:.85rem;color:#64748b}
    .card .v{font-size:1.5rem;font-weight:800;color:#2563eb}
    .panel{background:#fff;border-radius:1rem;box-shadow:0 1px 4px rgba(0,0,0,.08);padding:1rem}
    table th,table td{padding:.5rem;text-align:center}
    /* player card */
    .player-card{position:relative;background:#fff;border-radius:1.1rem;border:1px solid rgba(2,6,23,.06);
      padding:.85rem;display:flex;gap:.8rem;align-items:center;
      box-shadow:0 18px 30px rgba(2,6,23,.06),0 2px 6px rgba(2,6,23,.04),inset 0 1px 0 rgba(255,255,255,.9)}
    .player-card:hover{transform:translateY(-2px);transition:.2s ease;box-shadow:0 22px 36px rgba(2,6,23,.10),0 4px 10px rgba(2,6,23,.06)}
    .player-avatar { width: 72px; height: 72px; border-radius: 6px;overflow: hidden;border: 2px solid #e5e7eb;box-shadow: 0 2px 6px rgba(0,0,0,.06);background: #fff;}
    .num-badge{position:absolute;left:44px;top:-6px;transform:translateX(-50%);
      background:var(--team-color);color:var(--team-contrast);font-weight:800;
      border-radius:999px;padding:.18rem .5rem;font-size:.7rem;box-shadow:0 4px 10px rgba(0,0,0,.25)}
    .chip{border:1px solid rgba(2,6,23,.08);background:linear-gradient(180deg,#fff,rgba(255,255,255,.92));
      border-radius:999px;padding:.1rem .5rem;font-size:.72rem}
    .team-header{background:var(--team-color);color:var(--team-contrast);border-radius:1rem;
      padding:.9rem 1rem;box-shadow:inset 0 -2px 0 rgba(255,255,255,.25),0 10px 24px rgba(0,0,0,.08)}
    /* ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà (‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô‡∏Ç‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠) */
.num-badge-static{background: var(--team-color);color: var(--team-contrast);font-weight: 700;border-radius: 999px;padding: 0.1rem 0.5rem;font-size: 0.7rem;line-height: 1;white-space: nowrap;box-shadow: 0 4px 10px rgba(0,0,0,.12);}
    /* ‡∏ß‡∏á‡∏Å‡∏•‡∏°‡πÄ‡∏•‡πá‡∏Å ‡πÜ ‡∏ö‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô */
.icon-dot{
  width:20px; height:20px; border-radius:9999px;
  display:inline-block; border:1px solid rgba(0,0,0,.08);
  box-shadow:0 2px 6px rgba(0,0,0,.12);
  cursor:pointer; transition:transform .12s ease, opacity .12s ease;
}
.icon-dot:hover{ transform:scale(1.08); }
.icon-dot.gray{ background:#e5e7eb; } /* ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç */
.icon-dot.red { background:#ef4444; } /* ‡∏•‡∏ö   */
  /* ‡∏Ç‡∏ô‡∏≤‡∏î‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ó‡∏µ‡∏°‡∏ö‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (‡∏ß‡∏á‡∏Å‡∏•‡∏°) */
.team-logo{
  width: 40px;
  height: 40px;
  border-radius: 50%;       /* <<< ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å .5rem ‡πÄ‡∏õ‡πá‡∏ô 50% */
  object-fit: cover;
  border: 1px solid rgba(0,0,0,.08);
}
@media (min-width: 768px){
  .team-logo{ width: 48px; height: 48px; } /* ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÉ‡∏´‡∏ç‡πà */
}
/* --- Modern Save Button --- */
.btn-pro{
  --accent:#2563eb;            /* ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏π‡πÇ‡∏õ‡∏£ ‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö‡∏™‡∏µ‡∏ó‡∏µ‡∏°‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á */
  position:relative;
  display:inline-flex; align-items:center; gap:.6rem;
  padding:.78rem 1.15rem;
  border-radius:9999px;
  font-weight:700;
  color:#fff;
  background: linear-gradient(135deg, var(--accent), #60a5fa);
  box-shadow: 0 12px 22px rgba(37,99,235,.25), inset 0 1px 0 rgba(255,255,255,.25);
  border:none; outline:0;
  transition:transform .12s ease, filter .12s ease, box-shadow .12s ease;
}
.btn-pro:hover{ transform: translateY(-1px); filter:brightness(1.04); }
.btn-pro:active{ transform: translateY(0); filter:brightness(.98); box-shadow:0 8px 16px rgba(37,99,235,.28), inset 0 1px 0 rgba(255,255,255,.25); }

.btn-pro .ico{
  width:20px; height:20px; display:inline-grid; place-items:center;
  background:rgba(255,255,255,.22);
  border-radius:9999px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.35);
}

/* ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô */
.btn-stat{
  display:inline-flex;
  align-items:center;
  gap:6px;                        /* ‡πÄ‡∏ß‡πâ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
  padding:6px 14px;               /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏Ç‡∏≠‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡πÉ‡∏ô */
  border-radius: 0.75rem;         /* ‡∏°‡∏ô‡πÜ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏Å‡∏•‡∏° */
  background: #fff;
  color: #374151;                 /* slate-700 */
  font-size: 0.9rem;              /* ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á */
  line-height: 1.2;
  box-shadow: 0 2px 6px rgba(0,0,0,.08);
  border: 1px solid rgba(0,0,0,.05);
  transition: all .15s ease;
  cursor:pointer;
}
.btn-stat:hover{
  transform: translateY(-1px);
  box-shadow: 0 4px 10px rgba(0,0,0,.12);
}
.btn-stat:active{
  transform: translateY(0);
  box-shadow: 0 1px 3px rgba(0,0,0,.1);
}

/* ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏• (‡∏°‡∏¥‡∏ô‡∏¥‡∏°‡∏≠‡∏•) */
.btn-save {
  padding: 0.6rem 1.5rem;
  border-radius: 0.75rem;          /* ‡∏°‡∏ô ‡πÜ */
  background: #10b981;             /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏°‡∏¥‡∏ô‡∏¥‡∏°‡∏≠‡∏• (tailwind emerald-500) */
  color: #fff;
  font-weight: 600;
  font-size: 1rem;
  box-shadow: 0 4px 10px rgba(0,0,0,.12);
  transition: all .15s ease;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.btn-save:hover {
  background: #059669;             /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡∏∂‡πâ‡∏ô */
  transform: translateY(-1px);
  box-shadow: 0 6px 14px rgba(0,0,0,.15);
}

.btn-save:active {
  transform: translateY(0);
  box-shadow: 0 3px 6px rgba(0,0,0,.1);
}


/* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å */
.btn-pro[data-loading="1"]{
  pointer-events:none; filter:grayscale(.2) brightness(.9);
}
.btn-pro[data-loading="1"] .label{ opacity:.0; }
.btn-pro[data-loading="1"] .spinner{
  position:absolute; inset:0; display:grid; place-items:center;
}
.spinner:before{
  content:""; width:18px; height:18px; border-radius:50%;
  border:2.5px solid rgba(255,255,255,.55);
  border-top-color:#fff; animation:spin 1s linear infinite;
}
@keyframes spin{ to{ transform:rotate(360deg);} }

/* ===== ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö ‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ ===== */
.hist-row{
  display:flex; align-items:center; justify-content:space-between;
  gap:.75rem; padding:.4rem .6rem; border-radius:.5rem;
}
.hist-row:nth-child(odd){ background:#f8fafc; } /* ‡∏™‡∏•‡∏±‡∏ö‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏™‡∏µ‡∏≠‡πà‡∏≠‡∏ô */
.hist-main{ display:flex; gap:.5rem; align-items:center; min-width:0; }
.hist-time{ font-size:.72rem; color:#64748b; white-space:nowrap; }

.hist-actions{ display:flex; gap:.35rem; }
.hist-btn{
  border:1px solid rgba(0,0,0,.06); background:#fff; padding:.25rem .45rem;
  border-radius:.5rem; font-size:.8rem; cursor:pointer;
  box-shadow:0 1px 3px rgba(0,0,0,.08);
  transition:transform .12s ease, box-shadow .12s ease;
}
.hist-btn:hover{
  transform:translateY(-1px);
  box-shadow:0 3px 8px rgba(0,0,0,.12);
}
.hist-btn.red{ color:#b91c1c; }
.hist-type{ font-weight:700; }
  
</style>
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 min-h-screen">

  <!-- Header -->
<header class="bg-white/90 backdrop-blur shadow sticky top-0 z-50">
  <div class="container mx-auto px-4 py-3 flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
    
    <!-- ‡πÇ‡∏•‡πÇ‡∏Å‡πâ + ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ -->
    <div class="flex items-center gap-3 text-xl md:text-2xl font-bold text-gray-800">
      <img src="https://img5.pic.in.th/file/secure-sv1/S__2703408.jpg" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ Jakhong" class="h-10 w-10">
      <span>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏ö‡∏≠‡∏•‡∏™‡∏ô‡∏≤‡∏° Jakhong</span>
    </div>

    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
    <div class="flex gap-2">
      <button id="btnClear" class="btn-danger">üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>
  </div>
</header>

<!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π -->
<nav class="container mx-auto px-4 py-3">
  <div class="flex flex-wrap items-center gap-3 justify-center md:justify-start">

    <button class="nav-btn inline-flex items-center gap-2 px-5 py-2.5 rounded-xl font-semibold tracking-wide text-gray-700
      bg-white shadow-md transition-all duration-300
      hover:shadow-xl hover:-translate-y-0.5 active:translate-y-0 active:shadow-md
      border border-transparent"
      style="border-image: linear-gradient(90deg, #ec4899, #8b5cf6, #3b82f6) 1;"
      data-target="dashboard">
      üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
    </button>

    <button class="nav-btn inline-flex items-center gap-2 px-5 py-2.5 rounded-xl font-semibold tracking-wide text-gray-700
      bg-white shadow-md transition-all duration-300
      hover:shadow-xl hover:-translate-y-0.5 active:translate-y-0 active:shadow-md
      border border-transparent"
      style="border-image: linear-gradient(90deg, #ec4899, #8b5cf6, #3b82f6) 1;"
      data-target="table">
      üèÜ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
    </button>

    <button class="nav-btn inline-flex items-center gap-2 px-5 py-2.5 rounded-xl font-semibold tracking-wide text-gray-700
      bg-white shadow-md transition-all duration-300
      hover:shadow-xl hover:-translate-y-0.5 active:translate-y-0 active:shadow-md
      border border-transparent"
      style="border-image: linear-gradient(90deg, #ec4899, #8b5cf6, #3b82f6) 1;"
      data-target="match">
      ‚öΩ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•
    </button>

    <button class="nav-btn inline-flex items-center gap-2 px-5 py-2.5 rounded-xl font-semibold tracking-wide text-gray-700
      bg-white shadow-md transition-all duration-300
      hover:shadow-xl hover:-translate-y-0.5 active:translate-y-0 active:shadow-md
      border border-transparent"
      style="border-image: linear-gradient(90deg, #ec4899, #8b5cf6, #3b82f6) 1;"
      data-target="players">
      üë§ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
    </button>

    <button class="nav-btn inline-flex items-center gap-2 px-5 py-2.5 rounded-xl font-semibold tracking-wide text-gray-700
      bg-white shadow-md transition-all duration-300
      hover:shadow-xl hover:-translate-y-0.5 active:translate-y-0 active:shadow-md
      border border-transparent"
      style="border-image: linear-gradient(90deg, #ec4899, #8b5cf6, #3b82f6) 1;"
      data-target="teams">
      ‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°
    </button>

    <button class="nav-btn inline-flex items-center gap-2 px-5 py-2.5 rounded-xl font-semibold tracking-wide text-gray-700
      bg-white shadow-md transition-all duration-300
      hover:shadow-xl hover:-translate-y-0.5 active:translate-y-0 active:shadow-md
      border border-transparent"
      style="border-image: linear-gradient(90deg, #ec4899, #8b5cf6, #3b82f6) 1;"
      data-target="roster">
      üìù ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤
    </button>

  </div>
</nav>


<!-- ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS animation -->
<style>
@keyframes gradient-x {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
.animate-gradient-x {
  background-size: 200% 200%;
  animation: gradient-x 3s ease infinite;
}
</style>

  <main class="container mx-auto px-4 py-6 space-y-6">
    <!-- Dashboard -->
    <section id="dashboard" class="page active">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
        <div class="card"><div class="t">‡∏ó‡∏µ‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div><div id="statTeams" class="v"></div></div>
        <div class="card"><div class="t">‡πÅ‡∏°‡∏ï‡∏ä‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div><div id="statMatches" class="v"></div></div>
        <div class="card"><div class="t">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div><div id="statMembers" class="v"></div></div>
        <div class="card"><div class="t">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div><div id="statWeek" class="v"></div></div>
        <div class="bg-white rounded-2xl shadow p-5 mt-5">
        <h3 class="font-bold text-gray-800 mb-3">üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°</h3>
        <div id="teamContacts" class="grid grid-cols-1 gap-2"></div>
</div>

      </div>
      <div class="bg-white rounded-2xl shadow p-5 mt-5">
        <h3 class="font-bold text-gray-800 mb-3">ü•á Top Teams</h3>
        <div id="topTeams" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"></div>
      </div>
      <div class="bg-white rounded-2xl shadow p-5 mt-5">
        <h3 class="font-bold text-gray-800 mb-3">üóìÔ∏è ‡πÅ‡∏°‡∏ï‡∏ä‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
        <div id="recentMatches" class="space-y-2"></div>
      </div>
      <div class="bg-white rounded-2xl shadow p-5 mt-5">
        <h3 class="font-bold text-gray-800 mb-3">üìä ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
        <div id="activities" class="space-y-2 max-h-64 overflow-y-auto" aria-live="polite"></div>
      </div>
      
    </section>
    <!-- Table -->
    <section id="table" class="page">
      <div class="bg-white rounded-2xl shadow overflow-hidden">
        <div class="bg-gradient-to-r from-blue-800 to-blue-600 text-white p-4 text-center text-xl font-bold">JAKHONG LEAGUE</div>
        <div class="p-3 overflow-x-auto">
          <table class="w-full text-sm">
            <thead class="bg-blue-700 text-white">
              <tr><th>#</th><th class="text-left">‡∏ó‡∏µ‡∏°</th><th>‡πÅ‡∏Ç‡πà‡∏á</th><th>‡∏ä‡∏ô‡∏∞</th><th>‡πÄ‡∏™‡∏°‡∏≠</th><th>‡πÅ‡∏û‡πâ</th><th>‡πÑ‡∏î‡πâ</th><th>‡πÄ‡∏™‡∏µ‡∏¢</th><th>+/-</th><th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th><th>‡∏ü‡∏≠‡∏£‡πå‡∏°</th></tr>
            </thead>
            <tbody id="tbl"></tbody>
          </table>
        </div>
      </div>
    </section>

    
    <!-- ====== ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏• ====== -->
<section id="match" class="page">
  <div class="bg-white rounded-2xl shadow p-5 max-w-3xl mx-auto space-y-4">

    <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏° -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
      <div class="min-w-0">
        <label class="lbl">‡∏ó‡∏µ‡∏° 1</label>
        <select id="selHome" class="sel"></select>
      </div>
      <div class="min-w-0">
        <label class="lbl">‡∏ó‡∏µ‡∏° 2</label>
        <select id="selAway" class="sel"></select>
      </div>
    </div>

    <!-- ‡∏™‡∏Å‡∏≠‡∏£‡πå -->
    <div class="grid grid-cols-2 gap-3">
      <div class="min-w-0">
        <label class="lbl">‡∏™‡∏Å‡∏≠‡∏£‡πå‡∏ó‡∏µ‡∏° 1</label>
        <input id="hg" type="number" min="0" max="20" value="0" class="inp text-center">
      </div>
      <div class="min-w-0">
        <label class="lbl">‡∏™‡∏Å‡∏≠‡∏£‡πå‡∏ó‡∏µ‡∏° 2</label>
        <input id="ag" type="number" min="0" max="20" value="0" class="inp text-center">
      </div>
    </div>

    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏• (‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô) -->
    <div class="w-full flex justify-center mt-4">
      <button type="button" class="btn-save" id="btnSaveMatch">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•</button>
    </div>

    <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏°‡∏ï‡∏ä‡πå -->
    <div class="space-y-2">
      <div class="flex items-center gap-2 text-slate-600">
        <span>üìú</span><span class="font-semibold">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏°‡∏ï‡∏ä‡πå</span>
      </div>
      <div id="matchHistory" class="mt-2"></div>
    </div>

  </div>
</section>

<script>
let editingMatchId = null; // null = ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà, ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ = ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

function setMatchForm(m){
  const selHome = document.getElementById('selHome');
  const selAway = document.getElementById('selAway');
  const hgEl    = document.getElementById('hg');
  const agEl    = document.getElementById('ag');
  if(!selHome || !selAway || !hgEl || !agEl) return;
  if(!m) return;

  selHome.value = m.homeId || '';
  selAway.value = m.awayId || '';
  hgEl.value    = m.hg ?? 0;
  agEl.value    = m.ag ?? 0;
}

function renderMatchHistory(){
  const box = document.getElementById('matchHistory');
  if(!box) return;

  const rows = [...(state.matches||[])]
    .sort((a,b)=> b.ts-a.ts)
    .map(m=>{
      const t1 = (state.teams||[]).find(t=>t.id===m.homeId)?.name || '‡∏ó‡∏µ‡∏° 1';
      const t2 = (state.teams||[]).find(t=>t.id===m.awayId)?.name || '‡∏ó‡∏µ‡∏° 2';
      const time = new Date(m.ts||Date.now()).toLocaleString();
      return `
        <div class="rounded border px-3 py-2 text-sm flex items-center justify-between" data-mid="${m.id}">
          <div>${t1} vs ${t2} ‚Ä¢ <b>${m.hg}:${m.ag}</b></div>
          <div class="flex items-center gap-2 text-xs text-slate-500">
            <span>${time}</span>
            <button class="hist-btn" data-act="edit" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">‚úèÔ∏è</button>
            <button class="hist-btn red" data-act="del" title="‡∏•‡∏ö">‚úñÔ∏è</button>
          </div>
        </div>`;
    }).join('');

  box.innerHTML = rows || `<div class="text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>`;
}

function wireMatchHistoryActions(){
  const box = document.getElementById('matchHistory');
  if(!box || box.dataset.bound==='1') return;

  box.addEventListener('click', (e)=>{
    const btn = e.target.closest('button[data-act]');
    if(!btn) return;

    const row = e.target.closest('[data-mid]');
    const id  = row?.getAttribute('data-mid');
    const m   = (state.matches||[]).find(x=>x.id===id);
    if(!m) return;

    if(btn.dataset.act==='edit'){
      // ‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
      editingMatchId = id;
      setMatchForm(m);
      const saveBtn = document.getElementById('btnSaveMatch');
      if(saveBtn) saveBtn.textContent = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ú‡∏•';
      return;
    }

    if(btn.dataset.act==='del'){
      if(!confirm('‡∏•‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ô‡∏µ‡πâ?')) return;
      state.matches = (state.matches||[]).filter(x=>x.id!==id);
      save();               // ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
      renderTable?.();      // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏´‡∏°‡πà
      renderDashboard?.();  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
      renderMatchHistory(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
    }
  });

  box.dataset.bound = '1';
}

document.addEventListener('DOMContentLoaded', ()=>{
  const btn = document.getElementById('btnSaveMatch');
  if(!btn) return;

  btn.addEventListener('click', ()=>{
    const selHome = document.getElementById('selHome');
    const selAway = document.getElementById('selAway');
    const hgEl = document.getElementById('hg');
    const agEl = document.getElementById('ag');

    const homeId = selHome?.value || '';
    const awayId = selAway?.value || '';
    const hg = Number(hgEl?.value || 0);
    const ag = Number(agEl?.value || 0);

    if(!homeId || !awayId) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
    if(homeId === awayId) return alert('‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô');

    // ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    if(editingMatchId){
      const m = (state.matches||[]).find(x=>x.id===editingMatchId);
      if(m){
        m.homeId = homeId;
        m.awayId = awayId;
        m.hg = hg;
        m.ag = ag;
        m.ts = Date.now();
        save();
        renderTable?.();
        renderDashboard?.();
        renderMatchHistory();
      }
      editingMatchId = null;
      btn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•';
      hgEl.value = 0; agEl.value = 0;
      return;
    }

    // ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
    window.state = window.state || { teams: [], matches: [], playersStats: [] };
    state.matches = Array.isArray(state.matches) ? state.matches : [];
    const match = { id: crypto.randomUUID?.() || String(Date.now()), homeId, awayId, hg, ag, ts: Date.now() };
    state.matches.push(match);

    save();
    renderTable?.();
    renderDashboard?.();
    renderMatchHistory();

    hgEl.value = 0; agEl.value = 0;
  });

  // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ + ‡∏ú‡∏π‡∏Å‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ/‡∏•‡∏ö
  renderMatchHistory();
  wireMatchHistoryActions();
});

// ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å renderMatchLog() ‡πÄ‡∏î‡∏¥‡∏°‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
function renderMatchLog(){ renderMatchHistory(); }
</script>


    <!-- Players -->
<section id="players" class="page">
  <div class="bg-white rounded-2xl shadow p-5 mb-5">

    <!-- ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ + ‡∏õ‡∏∏‡πà‡∏°‡∏•‡πâ‡∏≤‡∏á (‡πÉ‡∏´‡∏°‡πà) -->
    <div class="flex items-center justify-between mb-4">
      <h3 class="font-bold text-gray-800">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h3>
      <div class="flex items-center gap-2">
        <button id="btnClearPlayerStats" class="btn-danger">üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ</button>
        <!-- ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏°‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏î‡πâ‡∏ß‡∏¢ ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏≤‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå‡∏≠‡∏≠‡∏Å -->
        <!-- <button id="btnClearAllStats" class="btn btn-white">üßΩ ‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button> -->
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
      <div><label class="lbl">‡∏ó‡∏µ‡∏°</label><select id="selTeamForPlayer" class="sel"></select></div>
      <div><label class="lbl">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</label><select id="selPlayer" class="sel"></select></div>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
      <button data-s="goals"        class="btn-stat btn-s">‚öΩ ‡∏õ‡∏£‡∏∞‡∏ï‡∏π</button>
      <button data-s="saves"        class="btn-stat btn-s">ü•Ö ‡πÄ‡∏ã‡∏ü</button>
      <button data-s="yellowCards"  class="btn-stat btn-s">üü® ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á</button>
      <button data-s="redCards"     class="btn-stat btn-s">üü• ‡πÅ‡∏î‡∏á</button>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-4">
    <div class="panel"><h4>üèÜ ‡∏î‡∏≤‡∏ß‡∏ã‡∏±‡∏•‡πÇ‡∏ß (‡∏õ‡∏£‡∏∞‡∏ï‡∏π)</h4><div id="topGoals"></div></div>
    <div class="panel"><h4>üß§ ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° (‡πÄ‡∏ã‡∏ü)</h4><div id="topSaves"></div></div>
    <div class="panel"><h4>üü® ‡πÉ‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á</h4><div id="topYellow"></div></div>
    <div class="panel"><h4>üü• ‡πÉ‡∏ö‡πÅ‡∏î‡∏á</h4><div id="topRed"></div></div>

    <div class="panel lg:col-span-2">
      <h4>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö)</h4>
      <div id="statsHistory"></div>
    </div>
  </div>
</section>


    <!-- Teams -->
<section id="teams" class="page">
  <div class="bg-white rounded-2xl shadow p-5 mb-5">

    <!-- ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏° / ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏° / ‡πÇ‡∏•‡πÇ‡∏Å‡πâ -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-3">
      <div>
        <label class="lbl">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°</label>
        <select id="selEditTeam" class="sel"></select>
      </div>

      <div>
        <label class="lbl">‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°</label>
        <input id="inpTeamName" class="inp" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°">
      </div>

      <div>
        <label class="lbl">‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ó‡∏µ‡∏°</label>
        <div class="flex items-center gap-3">
          <div id="teamLogoPreviewEdit" class="w-14 h-14 rounded-full overflow-hidden border-2 border-gray-200 bg-gradient-to-b from-blue-400 to-blue-600 flex items-center justify-center text-white font-bold">üè≥Ô∏è</div>
          <input id="teamLogoInputEdit" type="file" accept="image/*" class="hidden">
          <button id="btnChooseTeamLogoEdit" class="btn-s">üì∑ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</button>
          <button id="btnClearTeamLogoEdit" class="btn-danger">üßπ ‡∏•‡∏ö‡∏£‡∏π‡∏õ</button>
        </div>
      </div>
    </div>

    <!-- ‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡∏°‡πà: ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏° / ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 mt-3">
      <div>
        <label class="lbl">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°</label>
        <input id="inpManagerName" class="inp" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏Å‡∏ä‡∏±‡∏¢">
      </div>
      <div>
        <label class="lbl">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</label>
        <input id="inpManagerPhone" class="inp" inputmode="tel" placeholder="08x-xxx-xxxx">
      </div>
    </div>

    <div class="flex gap-2 justify-center mt-3">
      <button id="btnTeamUpdate" class="btn-pro">
        <span class="ico">üíæ</span>
        <span class="label">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</span>
        <span class="spinner" style="display:none"></span>
      </button>
      <button id="btnTeamAdd" class="btn-s">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà</button>
      <button id="btnTeamDelete" class="btn-danger">üóëÔ∏è ‡∏•‡∏ö‡∏ó‡∏µ‡∏°</button>
    </div>

  </div>
</section>


        <!-- Roster -->
    <section id="roster" class="page">
      <div class="bg-white rounded-2xl shadow p-5 mb-4 flex flex-col md:flex-row gap-3 md:items-center md:justify-between">
       
        <div class="flex items-center gap-2">
          <span class="font-semibold">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°:</span>
          <select id="selRosterTeam" class="sel w-56"></select>
        </div>
        <div class="flex items-center gap-3">
          <input id="teamColor" type="color" value="#16a34a" class="w-10 h-8 p-0 border rounded-lg">
         
          <button id="btnToggleAddPlayer"
  class="relative inline-flex items-center gap-2 rounded-full px-5 py-2 font-semibold text-black bg-white overflow-hidden">
  <span class="relative z-10 text-xl font-bold">Ôºã</span>
  <span class="relative z-10">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤</span>
  <span class="absolute inset-0 rounded-full p-[2px] bg-gradient-to-r from-pink-500 via-yellow-400 to-cyan-500 animate-[gradient-move_3s_linear_infinite]"></span>
  <span class="absolute inset-[2px] rounded-full bg-white"></span>
</button>

        </div>
      </div>

<div id="addPlayerForm" class="bg-white rounded-2xl shadow p-5 mb-5 hidden">
  <h3 class="text-center font-bold text-gray-800 mb-4">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-5">
    <!-- ‡∏ã‡πâ‡∏≤‡∏¢: ‡∏£‡∏π‡∏õ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á + ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ -->
    <div class="flex flex-col items-center gap-3">
      <div id="preview" class="avatar">üë§</div>
      <input id="npPhoto" type="file" accept="image/*" class="hidden">
      <div class="flex gap-2">
        <button id="btnPickPhoto"  type="button" class="btn btn-ghost">üì∑ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</button>
        <button id="btnClearPhoto" type="button" class="btn btn-red">üßπ ‡∏•‡∏ö‡∏£‡∏π‡∏õ</button>
      </div>
    </div>

    <!-- ‡∏Ç‡∏ß‡∏≤: ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ü‡∏≠‡∏£‡πå‡∏° (‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô) -->
    <div class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- ‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤ (‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏° options ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥) -->
      <div class="md:col-span-2">
        <label class="lbl" for="npTeam">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏°</label>
        <select id="npTeam" class="input">
          <!-- renderTeamSelects() ‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏° option ‡πÉ‡∏´‡πâ -->
        </select>
      </div>

      <div class="md:col-span-2">
        <label class="lbl" for="npName">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤</label>
        <input id="npName" name="name" type="text" class="input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏∏‡πÄ‡∏°‡∏ò ‡∏®‡∏∏‡∏†‡∏Å‡∏¥‡∏à">
      </div>

      <div>
        <label class="lbl" for="npNum">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏™‡∏∑‡πâ‡∏≠</label>
        <input id="npNum" name="num" type="number" class="input" min="0" placeholder="‡πÄ‡∏ä‡πà‡∏ô 10">
      </div>

      <div>
        <label class="lbl" for="npPos">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
        <select id="npPos" name="pos" class="input">
          <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ‚Äî</option>
          <option value="GK">GK ‚Äî ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏õ‡∏£‡∏∞‡∏ï‡∏π</option>
          <option value="DF">DF ‚Äî ‡∏Å‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á</option>
          <option value="MF">MF ‚Äî ‡∏Å‡∏≠‡∏á‡∏Å‡∏•‡∏≤‡∏á</option>
          <option value="FW">FW ‚Äî ‡∏Å‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤</option>
        </select>
      </div>

      <div>
        <label class="lbl" for="npAge">‡∏≠‡∏≤‡∏¢‡∏∏</label>
        <input id="npAge" name="age" type="number" class="input" min="0" placeholder="‡πÄ‡∏ä‡πà‡∏ô 24">
      </div>

      <div>
        <label class="lbl" for="npBirth">‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î</label>
        <input id="npBirth" name="birth" type="date" class="input">
      </div>

      <div class="col-span-2 md:col-span-1">
        <label for="npPhone" class="lbl">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
        <input id="npPhone" name="phone" type="tel" inputmode="tel"
         class="input" placeholder="08x-xxx-xxxx" />
      </div>

      <div class="md:col-span-2 flex flex-wrap items-center gap-2 pt-2">
        <button id="btnAddNewPlayer"    type="button" class="btn btn-green">‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤</button>
        <button id="btnClearNewPlayer"  type="button" class="btn btn-white">üßΩ ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
        <button id="btnDownloadRoster"  type="button" class="btn btn-white">‚¨áÔ∏è ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</button>
        <button id="btnCancelNewPlayer" type="button" class="btn btn-red">‚úñÔ∏è ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
    </div>
  </div>
</div>


      <div class="team-header mb-4"><h2 class="font-bold text-xl">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°: <span id="rosterTeamName">-</span></h2></div>
      <div id="rosterGrid" class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
    </section>
  </main>

  <!-- Script -->
<script>
/* =========================
   Football CE ‚Äî Single Script (Clean, Full)
========================= */

/* ---------- Utils ---------- */
const STORAGE_KEY = 'football_state_ce_v2';
const $  = (s, r=document) => r.querySelector(s);
const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));
const esc = s => String(s ?? '')
  .replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')
  .replaceAll('"','&quot;').replaceAll("'",'&#39;');
const nid = (p='id') => p + '_' + Math.random().toString(36).slice(2,9);
const log = (msg) => { try { console.log('[LOG]', msg); } catch(e){} };

function calcAgeFromISO(iso){
  if(!iso) return '';
  const [y,m,d] = iso.split('-').map(Number);
  if(!y||!m||!d) return '';
  const today = new Date();
  let age = today.getFullYear() - y;
  const beforeBirthday = (today.getMonth()+1 < m) || (today.getMonth()+1===m && today.getDate()<d);
  if(beforeBirthday) age--;
  return age;
}

/* ---------- State + persistence ---------- */
let state = { teams:[], matches:[], playersStats:[], playersEvents:[] };

function load(){
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw){
      const obj = JSON.parse(raw);
      if(obj && typeof obj==='object'){
        state.teams        = Array.isArray(obj.teams)? obj.teams : [];
        state.matches      = Array.isArray(obj.matches)? obj.matches : [];
        state.playersStats = Array.isArray(obj.playersStats)? obj.playersStats : [];

        // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ ‚Äú‡πÉ‡∏ô‚Äù load()
        state.playersEvents = Array.isArray(obj.playersEvents) ? obj.playersEvents : [];
      }
    } else {
      state.playersEvents = [];
    }
  } catch(e){
    console.warn('load failed', e);
  }
}
  
function save(){
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
  catch(e){ console.warn('save failed', e); }
}

/* ---------- Navigation (‡πÄ‡∏°‡∏ô‡∏π .nav-btn + ‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤) ---------- */
const pageLoaders = {
  dashboard(){ renderDashboard?.(); renderMatchLog?.(); renderTopStats?.(); },
  table(){ renderTable?.(); },
  teams(){ renderTeamSelects?.(); renderTeamEditPreview?.(null); },
  roster(){ renderTeamSelects?.(); renderRosterGrid?.(); renderRosterHooks?.(); },

  // üëá ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≠‡∏á‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ
  players(){
    renderTeamSelects?.();
    renderPlayerDropdowns?.();
    renderTopStats?.();
    renderStatsHistory?.();
    wireStatsHistoryActions?.();
    wireClearStatsButton?.();
  },

  match(){
    renderTeamSelects?.();
    renderMatchLog?.();
  },
};

  
function showPage(id){
  // ‡∏ã‡πà‡∏≠‡∏ô/‡πÇ‡∏ä‡∏ß‡πå‡∏´‡∏ô‡πâ‡∏≤
  $$('.page').forEach(sec=>{
    sec.classList.remove('active'); sec.classList.add('hidden');
    if (sec.id === id){ sec.classList.add('active'); sec.classList.remove('hidden'); }
  });
  // ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ï‡πå‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π
  $$('.nav-btn').forEach(b=> b.classList.remove('ring-2','ring-offset-2','ring-purple-400'));
  const active = $(`.nav-btn[data-target="${id}"]`);
  if (active) active.classList.add('ring-2','ring-offset-2','ring-purple-400');

  // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤
  if (pageLoaders[id]) pageLoaders[id]();
}

function wireNavigation(){
  $$('.nav-btn').forEach(btn=>{
    if (btn.tagName === 'BUTTON') btn.type = 'button';
    btn.addEventListener('click', (e)=>{
      e.preventDefault();
      const target = btn.dataset.target;
      if (target) showPage(target);
    }, {passive:false});
  });
}

/* ---------- Teams select (reuse) ---------- */
function renderTeamSelects(){
  const opts = state.teams.map(t=>`<option value="${t.id}">${esc(t.name)}</option>`).join('');
  if($('#selEditTeam'))        $('#selEditTeam').innerHTML        = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏° --</option>'+opts;
  if($('#selHome'))            $('#selHome').innerHTML            = opts;
  if($('#selAway'))            $('#selAway').innerHTML            = opts;
  if($('#selTeamForPlayer'))   $('#selTeamForPlayer').innerHTML   = opts;
  if($('#selRosterTeam'))      $('#selRosterTeam').innerHTML      = opts;
  if($('#npTeam'))             $('#npTeam').innerHTML             = opts;
}

/* ---------- Standings / Table ---------- */
function computeTable(){
  const tmap = {};
  state.teams.forEach(t=>{
    tmap[t.id] = { id:t.id, name:t.name, logo:t.logo||'', P:0,W:0,D:0,L:0,GF:0,GA:0,GD:0,PTS:0, form:[] };
  });
  state.matches.forEach(m=>{
    const H = tmap[m.homeId], A = tmap[m.awayId];
    if(!H||!A) return;
    H.P++; A.P++;
    H.GF+=m.hg; H.GA+=m.ag; H.GD=H.GF-H.GA;
    A.GF+=m.ag; A.GA+=m.hg; A.GD=A.GF-A.GA;
    if(m.hg>m.ag){ H.W++; A.L++; H.PTS+=3; H.form.push('W'); A.form.push('L'); }
    else if(m.hg<m.ag){ A.W++; H.L++; A.PTS+=3; A.form.push('W'); H.form.push('L'); }
    else { H.D++; A.D++; H.PTS+=1; A.PTS+=1; H.form.push('D'); A.form.push('D'); }
  });
  return Object.values(tmap).sort((a,b)=> b.PTS-a.PTS || b.GD-a.GD || b.GF-a.GF || a.name.localeCompare(b.name));
}
  
function renderTable(){
  const el = document.getElementById('tbl'); if(!el) return;

  const rows = computeTable().map((r,i)=>{
  const rank = i + 1;

  const rowClass =
    rank === 1
      ? 'bg-amber-50 border-l-4 border-amber-400'         // ü•á Gold
    : rank === 2
      ? 'bg-[#C0C0C0]/20 border-l-4 border-[#C0C0C0]'      // ü•à Silver
    : rank === 3
      ? 'bg-[#CD7F32]/15 border-l-4 border-[#CD7F32]'      // ü•â Bronze
    : 'odd:bg-white even:bg-slate-50';
    
    const last5 = r.form.slice(-5).join(' ');
    return `
      <tr class="${rowClass}">
        <td class="font-bold">${rank}</td>
        <td class="text-left">
          <div class="flex items-center gap-2">
            ${r.logo ? `<img src="${r.logo}" class="w-6 h-6 rounded-full object-cover border">` : '<span>üè≥Ô∏è</span>'}
            <span>${esc(r.name)}</span>
          </div>
        </td>
        <td>${r.P}</td><td>${r.W}</td><td>${r.D}</td><td>${r.L}</td>
        <td>${r.GF}</td><td>${r.GA}</td><td>${r.GD}</td>
        <td class="font-bold">${r.PTS}</td>
        <td class="text-xs">${last5}</td>
      </tr>`;
  }).join('');

  el.innerHTML = rows || `<tr><td colspan="11" class="py-6 text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
}

function telHref(s){ return 'tel:' + String(s||'').replace(/[^\d+]/g,''); }

function renderTeamContacts(){
  const box = document.getElementById('teamContacts');
  if(!box) return;

  const html = (state.teams||[]).map(t=>{
    const logo = t.logo
      ? `<img src="${t.logo}" class="w-7 h-7 rounded-full object-cover border" alt="">`
      : `<div class="w-7 h-7 rounded-full grid place-items-center bg-slate-100">üè≥Ô∏è</div>`;

    const m  = (t.managerName||'').trim();
    const ph = (t.managerPhone||'').trim();
    const phoneHtml = ph
      ? `<a href="${telHref(ph)}" class="chip inline-flex items-center">üìû ${esc(ph)}</a>`
      : `<span class="chip">‚Äî</span>`;

    return `
      <div class="rounded-lg border p-3">
        <div class="flex flex-wrap items-center gap-2">
          ${logo}
          <div class="min-w-0 flex-1">
            <div class="font-semibold break-words">${esc(t.name||'-')}</div>
            <div class="text-xs text-slate-500 break-words">${esc(m||'‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£')}</div>
          </div>
          <div class="w-full sm:w-auto sm:ml-auto mt-1 sm:mt-0">${phoneHtml}</div>
        </div>
      </div>`;
  }).join('');

  box.innerHTML = html || `<div class="text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏µ‡∏°</div>`;
}

// ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å "‡πÅ‡∏°‡∏ï‡∏ä‡πå‡πÅ‡∏£‡∏Å" (‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏•‡∏∞ 7 ‡∏ß‡∏±‡∏ô ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡∏ó‡∏µ‡πà 1)
function weekFromFirstMatch(now = Date.now()){
  const matches = Array.isArray(state.matches) ? state.matches : [];
  if (!matches.length) return 1; // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏°‡∏ï‡∏ä‡πå ‚Üí ‡πÅ‡∏™‡∏î‡∏á 1

  // ‡∏´‡∏≤‡∏ß‡∏±‡∏ô/‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏°‡∏ï‡∏ä‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á ts ‡πÅ‡∏•‡∏∞ date)
  const firstTs = Math.min(
    ...matches
      .map(m => m.ts || m.date || 0)
      .filter(Boolean)
  );
  if (!isFinite(firstTs)) return 1;

  const start = new Date(firstTs);
  start.setHours(0,0,0,0); // ‡∏õ‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏∑‡∏ô‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å

  const msPerWeek = 7 * 24 * 60 * 60 * 1000;
  const weeks = Math.floor((now - start.getTime()) / msPerWeek) + 1;
  return Math.max(1, weeks);
}

  
/* ---------- Dashboard ---------- */
function renderDashboard(){
  if($('#statTeams'))   $('#statTeams').textContent   = state.teams.length;
  if($('#statMatches')) $('#statMatches').textContent = state.matches.length;
  if($('#statMembers')) $('#statMembers').textContent = state.teams.reduce((s,t)=> s + (t.members?.length||0), 0);
  if($('#statWeek')) $('#statWeek').textContent = weekFromFirstMatch();
  
  // Top Teams
  const table = computeTable();
  const top = $('#topTeams');
  if(top){
    top.innerHTML = table.slice(0,3).map((r,i)=>`
      <div class="panel text-left flex items-center gap-3">
        <div class="text-2xl font-black text-sky-600">${i+1}</div>
        ${r.logo?`<img src="${r.logo}" class="w-10 h-10 rounded-full object-cover border">`:'<div class="w-10 h-10 rounded-full grid place-items-center bg-slate-100">üè≥Ô∏è</div>'}
        <div>
          <div class="font-bold">${esc(r.name)}</div>
          <div class="text-xs text-slate-500">Pts ${r.PTS} ‚Ä¢ GD ${r.GD}</div>
        </div>
      </div>`).join('') || `<div class="text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>`;
  }

  // Recent Matches
  const recBox = $('#recentMatches');
  if(recBox){
    const rec = [...state.matches].slice(-6).reverse().map(m=>{
      const h = state.teams.find(t=>t.id===m.homeId)?.name||'‚Äî';
      const a = state.teams.find(t=>t.id===m.awayId)?.name||'‚Äî';
      return `<div class="flex justify-between items-center text-sm">
        <span>${esc(h)} vs ${esc(a)}</span>
        <span class="font-bold">${m.hg} : ${m.ag}</span>
      </div>`;
    }).join('');
    recBox.innerHTML = rec || `<div class="text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏°‡∏ï‡∏ä‡πå</div>`;
  }
}

/* ---------- Match log + controls ---------- */
function renderMatchLog(){
  const box = $('#matchLog'); if(!box) return;
  const html = [...state.matches].reverse().map(m=>{
    const h = state.teams.find(t=>t.id===m.homeId)?.name||'‚Äî';
    const a = state.teams.find(t=>t.id===m.awayId)?.name||'‚Äî';
    const ts = new Date(m.date||Date.now()).toLocaleString();
    return `<div class="flex justify-between items-center bg-slate-50 rounded-lg px-3 py-2">
      <span class="text-sm">${esc(h)} vs ${esc(a)} ‚Ä¢ <span class="font-bold">${m.hg}:${m.ag}</span></span>
      <span class="text-xs text-slate-500">${ts}</span>
    </div>`;
  }).join('');
  box.innerHTML = html || `<div class="text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>`;
}
function wireMatchControls(){
  $('#incH')?.addEventListener('click', ()=> { const el=$('#hg'); if(el) el.value = (+el.value||0)+1; });
  $('#incA')?.addEventListener('click', ()=> { const el=$('#ag'); if(el) el.value = (+el.value||0)+1; });
  $('#setDraw')?.addEventListener('click', ()=> { if($('#hg')) $('#hg').value = 1; if($('#ag')) $('#ag').value = 1; });

  $('#saveMatch')?.addEventListener('click', ()=>{
    const homeId = $('#selHome')?.value, awayId = $('#selAway')?.value;
    const hg = +($('#hg')?.value||0), ag = +($('#ag')?.value||0);
    if(!homeId||!awayId||homeId===awayId) return alert('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡πÄ‡∏´‡∏¢‡πâ‡∏≤/‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
    const m = { id:nid('m'), homeId, awayId, hg, ag, date: Date.now() };
    state.matches.push(m);
    save(); renderTable(); renderDashboard(); renderMatchLog();
    log(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏• ${state.teams.find(t=>t.id===homeId)?.name} ${hg}:${ag} ${state.teams.find(t=>t.id===awayId)?.name}`);
    if($('#hg')) $('#hg').value = 0; if($('#ag')) $('#ag').value = 0;
  });
}

/* ---------- Player stats ---------- */
function ensurePlayerStat(playerId, name, teamId){
  let s = state.playersStats.find(x=>x.playerId===playerId);
  if(!s){ s = { playerId, name, teamId, goals:0, assists:0, saves:0, cleanSheets:0, yellowCards:0, redCards:0 }; state.playersStats.push(s); }
  return s;
}
function renderPlayerDropdowns(){
  const teamId = $('#selTeamForPlayer')?.value || state.teams[0]?.id || '';
  const team = state.teams.find(t=>t.id===teamId);
  if(!team) { if($('#selPlayer')) $('#selPlayer').innerHTML=''; return; }
  if($('#selPlayer')) $('#selPlayer').innerHTML = (team.members||[]).map(p=>`<option value="${p.id}">${esc(p.name)}</option>`).join('');
}
function topList(key){
  const arr = [...state.playersStats].sort((a,b)=> (b[key]||0)-(a[key]||0) ).slice(0,10);
  return arr.map((s,i)=>{
    const tname = state.teams.find(t=>t.id===s.teamId)?.name||'-';
    return `<div class="flex justify-between items-center py-1 ${i%2?'':'bg-slate-50'} rounded px-2">
      <span class="text-sm">${i+1}. ${esc(s.name)} <span class="text-xs text-slate-500">(${esc(tname)})</span></span>
      <span class="font-bold">${s[key]||0}</span>
    </div>`;
  }).join('') || `<div class="text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>`;
}
function renderTopStats(){
  const teamId = $('#selTeamForPlayer')?.value || '';
  if($('#topGoals'))   $('#topGoals').innerHTML   = topList('goals', teamId);
  if($('#topSaves'))   $('#topSaves').innerHTML   = topList('saves', teamId);         // üÜï
  if($('#topYellow'))  $('#topYellow').innerHTML  = topList('yellowCards', teamId);  // üÜï
  if($('#topRed'))     $('#topRed').innerHTML     = topList('redCards', teamId);     // üÜï
}
  
function wireStatsButtons(){
  $$('.btn-stat').forEach(b=>{
    b.addEventListener('click', ()=>{
      const teamId = $('#selTeamForPlayer')?.value;
      const pid = $('#selPlayer')?.value;
      if(!teamId||!pid) return alert('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô');

      const player = state.teams.find(t=>t.id===teamId)?.members?.find(m=>m.id===pid);
      if(!player) return alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô');

      const key  = b.getAttribute('data-s'); // goals, saves, yellowCards, redCards
      const stat = ensurePlayerStat(pid, player.name, teamId);
      stat[key] = (stat[key]||0) + 1;

      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å event ‡πÑ‡∏ß‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
      addStatEvent({ playerId: pid, teamId, type: key });

      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å‡∏à‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
      renderStatsHistory();
      save();
      renderTopStats?.();
      renderActivities?.();   // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï ‚Äú‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‚Äù

      log(`‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ ${player.name}: ${key}+1`);
    });
  });

  $('#selTeamForPlayer')?.addEventListener('change', () => {
    renderPlayerDropdowns();   // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡∏°
    renderTopStats?.();        // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö/‡∏™‡∏£‡∏∏‡∏õ
    renderStatsHistory?.();    // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
    renderActivities?.();      // ‚úÖ ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏î‡πâ‡∏ß‡∏¢
  });
}

// ‡∏õ‡∏∏‡πà‡∏° "‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ"
function wireClearStatsButton(){
  const btn = document.getElementById('btnClearPlayerStats');
  if (!btn || btn.dataset.bound === '1') return;
  btn.type = 'button';

  btn.addEventListener('click', ()=>{
    const teamId = document.getElementById('selTeamForPlayer')?.value;
    if (!teamId) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡∏Å‡πà‡∏≠‡∏ô'); return; }

    const t = state.teams.find(x=>x.id===teamId);
    const name = t?.name || '‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ';
    if (!confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á "${name}" ?\n(‡∏£‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏î‡πâ‡∏ß‡∏¢)`)) return;

    // ‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    state.playersStats  = state.playersStats.filter(s => s.teamId !== teamId);
    state.playersEvents = state.playersEvents.filter(e => e.teamId !== teamId);

    save();
    renderTopStats?.();
    renderStatsHistory?.();
    renderActivities?.();    // ‚úÖ ‡∏´‡∏•‡∏±‡∏á‡∏•‡πâ‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
  });

  btn.dataset.bound = '1';
}

// (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏∏‡πà‡∏° "‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏≤‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå‡∏≠‡∏≠‡∏Å + ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ)
function wireClearAllStatsButton(){
  const btn = document.getElementById('btnClearAllStats');
  if (!btn || btn.dataset.bound === '1') return;
  btn.type = 'button';
  btn.addEventListener('click', ()=>{
    if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) return;
    state.playersStats = [];
    state.playersEvents = [];
    save();
    renderTopStats?.();
    renderStatsHistory?.();
    renderActivities?.();     // ‚úÖ
  });
  btn.dataset.bound = '1';
}

// ===== Event helpers (‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥) =====
function labelStatType(t){
  return t==='goals' ? '‡∏õ‡∏£‡∏∞‡∏ï‡∏π'
       : t==='saves' ? '‡πÄ‡∏ã‡∏ü'
       : t==='yellowCards' ? '‡πÉ‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á'
       : t==='redCards' ? '‡πÉ‡∏ö‡πÅ‡∏î‡∏á'
       : t;
}

// ===== Helpers =====
function teamName(id){
  return (state.teams||[]).find(t=>t.id===id)?.name || '-';
}
function playerName(id){
  for (const t of (state.teams||[])){
    const p = (t.members||[]).find(m=>m.id===id);
    if (p) return p.name;
  }
  return '(‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠)';
}

function renderActivities(limit = 12){
  const box = document.getElementById('activities');
  if (!box) return;

  // ‡∏î‡∏∂‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏≤‡∏Å‡πÅ‡∏°‡∏ï‡∏ä‡πå
  const matchActs = (state.matches || []).map(m => ({
    ts: m.ts || m.date || 0,
    html: `<b>${esc(teamName(m.homeId))}</b> ${m.hg}:${m.ag} <b>${esc(teamName(m.awayId))}</b>`
  }));

  // ‡∏î‡∏∂‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
  const statActs = (state.playersEvents || []).map(e => ({
    ts: e.ts || 0,
    html: `${esc(playerName(e.playerId))} ‚Ä¢ ${esc(labelStatType(e.type))}
           <span class="text-xs text-slate-500">(${esc(teamName(e.teamId))})</span>`
  }));

  const acts = [...matchActs, ...statActs]
    .sort((a,b)=> b.ts - a.ts)
    .slice(0, limit);

  box.innerHTML = acts.length
    ? acts.map(a => `
        <div class="flex items-center justify-between rounded-lg bg-white/60 px-3 py-2">
          <div class="text-sm">${a.html}</div>
          <div class="text-xs text-slate-500">${new Date(a.ts).toLocaleString()}</div>
        </div>
      `).join('')
    : `<div class="text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</div>`;
}


// ===== Dashboard: ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î =====
function renderActivities(limit=12){
  const box = document.getElementById('activities');
  if(!box) return;

  // ‡πÅ‡∏õ‡∏•‡∏á matches ‡πÅ‡∏•‡∏∞ playersEvents ‡πÄ‡∏õ‡πá‡∏ô activity ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
  const matchActs = (state.matches||[]).map(m=>({
    ts: m.ts || m.date || 0,
    html: `<b>${esc(teamName(m.homeId))}</b> ${m.hg}:${m.ag} <b>${esc(teamName(m.awayId))}</b>`
  }));

  const statActs = (state.playersEvents||[]).map(e=>({
    ts: e.ts || 0,
    html: `${esc(playerName(e.playerId))} ‚Ä¢ ${esc(labelStatType(e.type))}
           <span class="text-xs text-slate-500">(${esc(teamName(e.teamId))})</span>`
  }));

  const acts = [...matchActs, ...statActs]
    .sort((a,b)=> b.ts - a.ts)
    .slice(0, limit);

  box.innerHTML = acts.length
    ? acts.map(a=>`
        <div class="flex items-center justify-between rounded-lg bg-white/60 px-3 py-2">
          <div class="text-sm">${a.html}</div>
          <div class="text-xs text-slate-500">${new Date(a.ts).toLocaleString()}</div>
        </div>`).join('')
    : `<div class="text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</div>`;
}
  
function addStatEvent({playerId, teamId, type}){
  const ev = { id: nid('ev'), playerId, teamId, type, ts: Date.now() };
  state.playersEvents.push(ev);
  return ev;
}

function deleteStatEvent(evId){
  const idx = state.playersEvents.findIndex(e=>e.id===evId);
  if (idx<0) return;
  const ev = state.playersEvents[idx];
  const stat = state.playersStats.find(s=>s.playerId===ev.playerId);
  if (stat && stat[ev.type]>0) stat[ev.type]--;
  state.playersEvents.splice(idx,1);
  save(); renderTopStats(); renderStatsHistory();
}

function editStatEvent(evId,newType){
  const ev = state.playersEvents.find(e=>e.id===evId);
  if (!ev) return;
  const stat = state.playersStats.find(s=>s.playerId===ev.playerId);
  if (stat){
    if (stat[ev.type]>0) stat[ev.type]--;
    stat[newType] = (stat[newType]||0)+1;
  }
  ev.type=newType;
  save(); renderTopStats(); renderStatsHistory(); renderActivities?.(); 
}

function renderStatsHistory(limit=30){
  const box=document.getElementById('statsHistory');
  if (!box) return;
  const rows=[...state.playersEvents]
    .sort((a,b)=>b.ts-a.ts)
    .slice(0,limit)
    .map(ev=>{
      const player=state.teams.flatMap(t=>t.members||[]).find(p=>p.id===ev.playerId);
      const team=state.teams.find(t=>t.id===ev.teamId);
      const name=player?.name||'(‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠)';
      const tname=team?.name||'-';
      const time=new Date(ev.ts).toLocaleString();
      return `<div class="hist-row" data-evid="${ev.id}">
        <div class="hist-main">
          <span class="hist-type">‚Ä¢ ${labelStatType(ev.type)}</span>
          <span class="truncate">${esc(name)} <span class="text-xs text-slate-500">(${esc(tname)})</span></span>
        </div>
        <div class="hist-actions">
          <span class="hist-time">${time}</span>
          <button class="hist-btn" data-act="edit">‚úèÔ∏è</button>
          <button class="hist-btn red" data-act="del">‚úñÔ∏è</button>
        </div>
      </div>`;
    }).join('');
  box.innerHTML=rows||`<div class="text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>`;
}
function wireStatsHistoryActions(){
  const box=document.getElementById('statsHistory');
  if (!box||box.dataset.bound==='1') return;
  box.addEventListener('click',(e)=>{
    const btn=e.target.closest('.hist-btn'); if(!btn) return;
    const row=e.target.closest('.hist-row'); if(!row) return;
    const evId=row.getAttribute('data-evid');
    if(btn.dataset.act==='del'){ if(confirm('‡∏•‡∏ö?')) deleteStatEvent(evId); }
    if(btn.dataset.act==='edit'){
      const newType=prompt('‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏∞‡πÑ‡∏£? (goals/saves/yellowCards/redCards)','goals');
      if(newType) editStatEvent(evId,newType.trim());
    }
  });
  box.dataset.bound='1';
}

/* ---------- Teams (logo upload + CRUD) ---------- */
function renderTeamEditPreview(team){
  const box = $('#teamLogoPreviewEdit');
  if(!box) return;
  if(team?.logo){ box.innerHTML = `<img src="${team.logo}" class="w-full h-full object-cover" alt="${esc(team.name)}">`; }
  else { box.innerHTML = `üè≥Ô∏è`; }
}
let pendingLogoDataURL_Edit = '';
function wireTeamLogoPickers(){
  $('#btnChooseTeamLogoEdit')?.addEventListener('click', ()=> $('#teamLogoInputEdit')?.click());
  $('#btnClearTeamLogoEdit')?.addEventListener('click', ()=>{
    pendingLogoDataURL_Edit=''; renderTeamEditPreview(null);
    if($('#teamLogoInputEdit')) $('#teamLogoInputEdit').value='';
  });
  $('#teamLogoInputEdit')?.addEventListener('change', e=>{
    const f = e.target.files?.[0]; if(!f) return;
    if(!f.type.startsWith('image/')) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û'); e.target.value=''; return; }
    if(f.size > 5*1024*1024) { alert('‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Å‡∏¥‡∏ô 5MB'); e.target.value=''; return; }
    const r = new FileReader();
    r.onload = ev => { pendingLogoDataURL_Edit = ev.target.result; if($('#teamLogoPreviewEdit')) $('#teamLogoPreviewEdit').innerHTML = `<img src="${pendingLogoDataURL_Edit}" class="w-full h-full object-cover">`; };
    r.readAsDataURL(f);
  });
}

  function wireTeamCRUD(){
  // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£/‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏à‡∏≤‡∏Å‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï
  const getMgr = () => ({
    name:  $('#inpManagerName')?.value?.trim() || '',
    phone: $('#inpManagerPhone')?.value?.trim() || ''
  });

  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà
  $('#btnTeamAdd')?.addEventListener('click', ()=>{
    const name = $('#inpTeamName')?.value?.trim();
    if(!name) return alert('‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°');
    if(state.teams.some(t=>t.name===name)) return alert('‡∏°‡∏µ‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß');

    const { name: mname, phone: mphone } = getMgr();

    const team = {
      id: nid('team'),
      name,
      logo: pendingLogoDataURL_Edit || '',
      managerName:  mname,
      managerPhone: mphone,
      members: []
    };

    state.teams.push(team);
    save();

    // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
    if($('#inpTeamName'))     $('#inpTeamName').value = '';
    if($('#inpManagerName'))  $('#inpManagerName').value = '';
    if($('#inpManagerPhone')) $('#inpManagerPhone').value = '';
    pendingLogoDataURL_Edit = '';
    if($('#teamLogoInputEdit')) $('#teamLogoInputEdit').value = '';

    renderTeamSelects(); renderTeamEditPreview(null);
    renderDashboard(); renderTable(); renderRosterHooks();
    if ($('#selRosterTeam') && !$('#selRosterTeam').value) $('#selRosterTeam').value = team.id;
    renderPlayerDropdowns?.(); renderRosterGrid?.();
    renderTeamContacts?.(); // üëà ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠
    log(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà: ${name}`);
  });

  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡∏°
  $('#btnTeamUpdate')?.addEventListener('click', ()=>{
    const id   = $('#selEditTeam')?.value;
    const name = $('#inpTeamName')?.value?.trim();
    if(!id) return alert('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°');
    if(!name) return alert('‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°');

    const t = state.teams.find(x=>x.id===id); if(!t) return;
    const { name: mname, phone: mphone } = getMgr();

    t.name = name;
    if(pendingLogoDataURL_Edit) t.logo = pendingLogoDataURL_Edit;
    t.managerName  = mname;
    t.managerPhone = mphone;

    save();

    renderTeamSelects();
    if($('#selEditTeam')) $('#selEditTeam').value = t.id;
    renderTeamEditPreview(t);
    pendingLogoDataURL_Edit = '';
    if($('#teamLogoInputEdit')) $('#teamLogoInputEdit').value = '';

    renderDashboard(); renderTable(); renderRosterHooks();
    renderRosterGrid?.(); renderPlayerDropdowns?.();
    renderTeamContacts?.(); // üëà
    log(`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡∏°: ${name}`);
  });

  // ‡∏•‡∏ö‡∏ó‡∏µ‡∏°
  $('#btnTeamDelete')?.addEventListener('click', ()=>{
    const id = $('#selEditTeam')?.value; if(!id) return alert('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°');
    const t  = state.teams.find(x=>x.id===id); if(!t) return;
    if(!confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏ó‡∏µ‡∏° "${t.name}" ?`)) return;

    state.teams   = state.teams.filter(x=>x.id!==id);
    state.matches = state.matches.filter(m=> m.homeId!==id && m.awayId!==id );
    save();

    if($('#inpTeamName'))     $('#inpTeamName').value = '';
    if($('#inpManagerName'))  $('#inpManagerName').value = '';
    if($('#inpManagerPhone')) $('#inpManagerPhone').value = '';
    pendingLogoDataURL_Edit = '';
    if($('#teamLogoInputEdit')) $('#teamLogoInputEdit').value = '';

    renderTeamSelects(); renderTeamEditPreview(null);
    renderDashboard(); renderTable(); renderMatchLog(); renderRosterHooks();
    renderPlayerDropdowns?.(); renderRosterGrid?.();
    renderTeamContacts?.(); // üëà
    log(`‡∏•‡∏ö‡∏ó‡∏µ‡∏°: ${t.name}`);
  });

  // ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏° ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡πà‡∏≤‡∏•‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
  $('#selEditTeam')?.addEventListener('change', e=>{
    const t = state.teams.find(x=>x.id===e.target.value);
    if($('#inpTeamName'))     $('#inpTeamName').value     = t?.name || '';
    if($('#inpManagerName'))  $('#inpManagerName').value  = t?.managerName  || '';
    if($('#inpManagerPhone')) $('#inpManagerPhone').value = t?.managerPhone || '';
    pendingLogoDataURL_Edit = '';
    renderTeamEditPreview(t||null);
    if($('#teamLogoInputEdit')) $('#teamLogoInputEdit').value = '';
  });
}

/* ---------- Roster (upload + add + grid + actions) ---------- */
let tempPlayerPhoto = '';
function wireRosterPhotoPickers(){
  $('#btnPickPhoto')?.addEventListener('click', ()=> $('#npPhoto')?.click());
  $('#btnClearPhoto')?.addEventListener('click', ()=>{
    tempPlayerPhoto=''; if($('#preview')) $('#preview').innerHTML='üë§'; if($('#npPhoto')) $('#npPhoto').value='';
  });
  $('#npPhoto')?.addEventListener('change', e=>{
    const f=e.target.files?.[0]; if(!f) return;
    if(!f.type.startsWith('image/')){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û'); e.target.value=''; return; }
    if(f.size>5*1024*1024){ alert('‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Å‡∏¥‡∏ô 5MB'); e.target.value=''; return; }
    const r=new FileReader();
    r.onload=ev=>{ tempPlayerPhoto=ev.target.result; if($('#preview')) $('#preview').innerHTML=`<img src="${tempPlayerPhoto}" class="w-full h-full object-cover">`; };
    r.readAsDataURL(f);
  });
  $('#npBirth')?.addEventListener('input', ()=>{
    const iso=$('#npBirth')?.value;
    const a=calcAgeFromISO(iso);
    if($('#npAge') && (a||a===0)) $('#npAge').value=a;
  });
}

// ‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏µ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
function applyRosterColor(team){
  const hex = team?.color || $('#teamColor')?.value || '#16a34a';
  const hdr = document.querySelector('#roster .team-header');
  if (hdr){
    hdr.style.background = hex;
    hdr.style.color = '#fff';
  }
}

// ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏•‡∏±‡∏ö‡∏ó‡∏µ‡∏°‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Roster ‡πÉ‡∏´‡πâ‡∏£‡∏µ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
function wireRosterTeamSwitcher(){
  const sel = document.getElementById('selRosterTeam');
  if (!sel) return;
  if (sel.dataset.bound === '1') return;

  sel.addEventListener('change', ()=>{
    renderRosterGrid?.();         // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ + ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡∏°
    renderRosterHooks?.();        // ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏¢‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    syncRosterColorFromTeam?.();  // ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏™‡∏µ‡∏ó‡∏µ‡∏°
    fillTeamsForNewPlayer?.();    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ dropdown ‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡∏£‡∏á‡∏î‡πâ‡∏ß‡∏¢
  });

  sel.dataset.bound = '1';
}
 

// ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ (#teamColor) ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ô roster
function syncRosterColorFromTeam(){
  const teamId = $('#selRosterTeam')?.value;
  const t = state.teams.find(x=>x.id===teamId);
  if ($('#teamColor')) $('#teamColor').value = t?.color || '#16a34a';
  applyRosterColor(t);
}

function labelPos(pos){
  return pos==='goalkeeper' ? '‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏õ‡∏£‡∏∞‡∏ï‡∏π'
       : pos==='defender'   ? '‡∏Å‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á'
       : pos==='midfielder' ? '‡∏Å‡∏≠‡∏á‡∏Å‡∏•‡∏≤‡∏á'
       : '‡∏Å‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤';
}
function clearNewPlayerForm() {
  ['npName','npPos','npNum','npBirth','npAge','npPhone'].forEach(id=>{
    const el = $('#'+id);
    if (el) el.value = '';
  });
  tempPlayerPhoto = '';
  if ($('#preview')) $('#preview').innerHTML = 'üë§';
  if ($('#npPhoto')) $('#npPhoto').value = '';
}
  
function renderPlayerCard(p, team) {
  const has = (v) => v !== undefined && v !== null && String(v).trim() !== '';
  const fmtDate = (iso) => {
    if (!has(iso)) return '';
    const [y,m,d] = iso.split('-');
    return `${d}/${m}/${y}`;
  };

  // ‡∏™‡∏µ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ó‡∏µ‡∏° (‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö badge ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏™‡∏∑‡πâ‡∏≠)
  const accent = team?.color || '#16a34a';

  // chips ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡∏¥‡∏°
  const chips = [];
  if (has(p.pos))   chips.push(`<span class="chip">${labelPos(p.pos)}</span>`);
  if (Number.isFinite(p.age) && p.age > 0) chips.push(`<span class="chip">‡∏≠‡∏≤‡∏¢‡∏∏ ${p.age}</span>`);
  if (has(p.birth)) chips.push(`<span class="chip">${fmtDate(p.birth)}</span>`);
  if (has(p.phone)) chips.push(`<span class="chip">üìû ${p.phone}</span>`);

  // ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏™‡∏∑‡πâ‡∏≠ ‚Äî ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ "‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô" ‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡∏°
  const numBadge = has(p.num)
    ? `<span class="num-badge-static"
         style="background:${accent};color:#fff;border-color:${accent}">
         #${String(p.num).trim()}
       </span>`
    : '';

  // ‡∏£‡∏π‡∏õ
  const photo = has(p.photo)
    ? `<img src="${esc(p.photo)}" alt="${esc(p.name||'‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤')}" class="player-avatar object-cover">`
    : `<div class="player-avatar grid place-items-center text-slate-400">üë§</div>`;

  const teamLogo = team?.logo
  ? `<div class="mt-2 flex justify-end">
       <img src="${esc(team.logo)}" class="team-logo" alt="">
     </div>`
  : '';

  return `
    <div class="player-card relative">
      <!-- ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô (‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡∏°) -->
      ${numBadge ? `<div class="absolute top-2 left-2 z-10">${numBadge}</div>` : ''}

      <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏°‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô -->
      <div class="absolute top-2 right-2 flex gap-2 z-10">
        <button class="icon-dot gray" data-act="edit-player" data-id="${p.id}" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç" aria-label="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç"></button>
        <button class="icon-dot red"  data-act="del-player"  data-id="${p.id}" title="‡∏•‡∏ö"   aria-label="‡∏•‡∏ö"></button>
      </div>

      <div class="relative">${photo}</div>

      <div class="min-w-0 flex-1 mt-1">
        <div class="font-bold whitespace-normal break-words leading-tight">
          ${esc(p.name || '(‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠)')}
        </div>

        ${chips.length ? `
          <div class="mt-1 flex flex-wrap items-center gap-2 text-xs text-slate-600">
            ${chips.join('')}
          </div>` : ''}

        ${teamLogo}
      </div>
    </div>
  `;
}


function renderRosterGrid(){
  let teamId = $('#selRosterTeam')?.value || '';
  if (!teamId && state.teams.length) {
    teamId = state.teams[0].id;
    if ($('#selRosterTeam')) $('#selRosterTeam').value = teamId;
  }
  const team = state.teams.find(t => t.id === teamId);
  if ($('#rosterTeamName')) $('#rosterTeamName').textContent = team?.name || '-';
  applyRosterColor(team);
  const grid = $('#rosterGrid'); if (!grid) return;
  const items = (team?.members || []).map(p => renderPlayerCard(p, team)).join('');
  grid.innerHTML = items || `<div class="text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</div>`;
}

  function renderRosterHooks(){
  const grid = $('#rosterGrid'); if (!grid) return;
  if (grid.dataset.bound === '1') return;

  grid.addEventListener('click', (e)=>{
    const btn = e.target.closest('[data-act]'); // ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î
    if (!btn) return;

    const act = btn.dataset.act;   // 'edit-player' | 'del-player'
    const pid = btn.dataset.id;    // playerId ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î
    const teamId = $('#selRosterTeam')?.value; // ‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏¢‡∏π‡πà

    if (act === 'edit-player') {
      // <<< ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏´‡∏•‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
      enterEditPlayer(teamId, pid);
      return;
    }

    if (act === 'del-player') {
      const team = state.teams.find(t=>t.id===teamId);
      const p = team?.members?.find(m=>m.id===pid);
      if (!team || !p) return;
      if (!confirm(`‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô "${p.name}" ?`)) return;
      team.members = team.members.filter(m=>m.id!==pid);
      save(); renderRosterGrid?.(); renderDashboard?.(); renderActivities?.(); 
    }
  });

  grid.dataset.bound = '1';
}


/* ---------- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤ (‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏¢‡∏£‡∏∏‡πâ‡∏á) ---------- */
function fillTeamsForNewPlayer() {
  const sel = $('#npTeam'); if (!sel) return;
  sel.innerHTML = state.teams.map(t => `<option value="${t.id}">${esc(t.name)}</option>`).join('');
  const current = $('#selRosterTeam')?.value || state.teams[0]?.id || '';
  if (current) sel.value = current;
}
function openAddPlayerForm() {
  const box = $('#addPlayerForm'); if (!box) return;
  fillTeamsForNewPlayer();
  clearNewPlayerForm?.();
  box.classList.remove('hidden');
  setTimeout(()=> $('#npName')?.focus(), 0);
  wireRosterPhotoPickers?.();
}
function closeAddPlayerForm() { $('#addPlayerForm')?.classList.add('hidden'); }
function wireRosterFormToggle() {
  $('#btnToggleAddPlayer')?.addEventListener('click', (e)=>{
    e.preventDefault();
    const box = $('#addPlayerForm');
    if (!box || box.classList.contains('hidden')) openAddPlayerForm();
    else closeAddPlayerForm();
  });
  $('#btnCancelNewPlayer')?.addEventListener('click', (e)=>{ e.preventDefault(); closeAddPlayerForm(); });
  $('#btnClearNewPlayer')?.addEventListener('click', (e)=>{ e.preventDefault(); clearNewPlayerForm?.(); });
  $('#selRosterTeam')?.addEventListener('change', ()=>{
    if (!$('#addPlayerForm')?.classList.contains('hidden')) fillTeamsForNewPlayer();
  });
}

/* ---------- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤ ---------- */
function wireAddPlayer(){
  const btn = $('#btnAddNewPlayer');
  if (!btn) { console.warn('btnAddNewPlayer not found'); return; }
  btn.type = 'button';
  if (!btn.dataset.mode) btn.dataset.mode = 'add';
  if (btn.dataset.bound === '1') return;

  btn.addEventListener('click', (e)=>{
    e.preventDefault();

    const formTeamId = $('#npTeam')?.value || $('#selRosterTeam')?.value || state.teams[0]?.id || '';
    const name  = $('#npName')?.value?.trim() || '';
    const pos   = $('#npPos')?.value || '';
    const num   = $('#npNum')?.value?.trim() || '';
    const birth = $('#npBirth')?.value || '';
    const ageIn = $('#npAge')?.value || '';
    const phone = $('#npPhone')?.value?.trim() || '';
    const age   = (Number.isFinite(+ageIn) && +ageIn >= 0) ? +ageIn : (calcAgeFromISO?.(birth) ?? '');
    if(!name){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤'); $('#npName')?.focus(); return; }

    // --- ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ---
    if (btn.dataset.mode === 'edit' && editingPlayer){
      const oldTeam = state.teams.find(t=>t.id===editingPlayer.teamId);
      const newTeam = state.teams.find(t=>t.id===formTeamId);
      if(!newTeam){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°'); return; }

      let p = oldTeam?.members?.find(m=>m.id===editingPlayer.playerId);
      if(!p){ alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏î‡∏¥‡∏°'); exitEditMode(); return; }

      // ‡∏ñ‡πâ‡∏≤‡∏¢‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡∏°
      if (oldTeam && newTeam && oldTeam.id !== newTeam.id){
        oldTeam.members = (oldTeam.members||[]).filter(m=>m.id!==p.id);
        p = { ...p };
        newTeam.members = newTeam.members || [];
        newTeam.members.push(p);
      }

      p.name  = name;  p.pos   = pos;  p.num   = num;
      p.birth = birth; p.age   = age;  p.phone = phone;
      p.photo = (typeof tempPlayerPhoto==='string' ? tempPlayerPhoto : '') || p.photo || '';

      save();
      renderRosterGrid?.(); renderDashboard?.();
      closeAddPlayerForm?.(); clearNewPlayerForm?.(); exitEditMode();
      return;
    }

    // --- ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà ---
    const team = state.teams.find(t=>t.id===formTeamId);
    if(!team){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡∏Å‡πà‡∏≠‡∏ô'); return; }

    const p = {
      id: nid('p'),
      name, pos, num, birth, age, phone,
      photo: (typeof tempPlayerPhoto==='string' ? tempPlayerPhoto : '') || ''
    };

    team.members = team.members || [];
    team.members.push(p);
    save();

    renderRosterGrid?.(); renderDashboard?.();
    closeAddPlayerForm?.(); clearNewPlayerForm?.(); exitEditMode();
    const selRoster = $('#selRosterTeam'); if(selRoster && !selRoster.value) selRoster.value = team.id;
  });

  // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å/‡∏•‡πâ‡∏≤‡∏á = ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏î‡πâ‡∏ß‡∏¢
  $('#btnCancelNewPlayer')?.addEventListener('click', ()=> exitEditMode());
  $('#btnClearNewPlayer')?.addEventListener('click', ()=> exitEditMode());

  btn.dataset.bound = '1';
}


  
// ==== Edit mode (‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô) ====
let editingPlayer = null; // { teamId, playerId }

function enterEditPlayer(teamId, playerId){
  const team = state.teams.find(t=>t.id===teamId);
  const p    = team?.members?.find(m=>m.id===playerId);
  if(!team || !p) return;

  // ‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏° + ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡πà‡∏≤
  openAddPlayerForm?.();

  $('#npTeam')  && ($('#npTeam').value  = teamId);
  $('#npName')  && ($('#npName').value  = p.name || '');
  $('#npPos')   && ($('#npPos').value   = p.pos  || '');
  $('#npNum')   && ($('#npNum').value   = p.num  || '');
  $('#npBirth') && ($('#npBirth').value = p.birth|| '');
  $('#npAge')   && ($('#npAge').value   = (p.age ?? ''));
  $('#npPhone') && ($('#npPhone').value = p.phone|| '');

  // ‡∏£‡∏π‡∏õ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
  tempPlayerPhoto = p.photo || '';
  if($('#preview')){
    $('#preview').innerHTML = p.photo
      ? `<img src="${esc(p.photo)}" class="w-full h-full object-cover">`
      : 'üë§';
  }

  // ‡∏™‡∏•‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏´‡∏°‡∏î "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç"
  const btn = $('#btnAddNewPlayer');
  if(btn){ btn.textContent = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç'; btn.dataset.mode = 'edit'; }

  editingPlayer = { teamId, playerId };
}

function exitEditMode(){
  editingPlayer = null;
  const btn = $('#btnAddNewPlayer');
  if(btn){ btn.textContent = '‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤'; btn.dataset.mode = 'add'; }
}

  function wireGlobalClearButton(){
  const btn = document.getElementById('btnClear');
  if (!btn || btn.dataset.bound === '1') return;
  btn.type = 'button';

  btn.addEventListener('click', ()=>{
    if (!confirm(
      '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?\n' +
      '‚Äî ‡∏ó‡∏µ‡∏°, ‡πÇ‡∏•‡πÇ‡∏Å‡πâ, ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô, ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô, ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô ‡πÅ‡∏•‡∏∞‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° ‚Äî'
    )) return;

    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï state ‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥
    state = { teams: [], matches: [], playersStats: [], playersEvents: [] };

    // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å localStorage
    try { localStorage.removeItem(STORAGE_KEY); } catch(e){}

    // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß/‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
    try {
      pendingLogoDataURL_Edit = '';
      tempPlayerPhoto = '';
      editingMatchId = null;
      editingPlayer  = null;

      [
        'inpTeamName','inpManagerName','inpManagerPhone',
        'npName','npNum','npAge','npBirth','npPhone'
      ].forEach(id => { const el = document.getElementById(id); if (el) el.value = ''; });

      const selEditTeam = document.getElementById('selEditTeam');
      if (selEditTeam) selEditTeam.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏° --</option>';
    } catch(e){}

    // ‡∏£‡∏µ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î‡∏Ç‡∏≠‡∏á UI
    renderTeamSelects?.();
    renderPlayerDropdowns?.();
    renderDashboard?.();
    renderTable?.();
    renderMatchLog?.();
    renderRosterGrid?.();
    renderTopStats?.();
    renderRosterHooks?.();
    renderStatsHistory?.();
    renderActivities?.();
    renderTeamContacts?.();

    // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•
    showPage?.('dashboard');
    alert('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ');
  });

  btn.dataset.bound = '1';
}


/* ---------- Boot ---------- */
document.addEventListener('DOMContentLoaded', ()=>{
  load?.();

  // ‡πÄ‡∏°‡∏ô‡∏π + ‡∏Æ‡∏∏‡∏Ñ‡∏ï‡πà‡∏≤‡∏á‡πÜ
  wireNavigation();
  wireRosterFormToggle?.();
  wireMatchControls?.();
  wireStatsButtons?.();
  wireClearStatsButton?.();
  wireTeamLogoPickers?.();
  wireTeamCRUD?.();
  wireRosterPhotoPickers?.();
  wireAddPlayer?.();
  wireRosterTeamSwitcher();  
  wireStatsHistoryActions();
  wireGlobalClearButton(); 
  
  // ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
  renderTeamSelects?.();
  renderPlayerDropdowns?.();
  renderTable?.();
  renderDashboard?.();
  renderMatchLog?.();
  renderRosterGrid?.();    // <= ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô sync ‡∏™‡∏µ
  renderTopStats?.();
  renderRosterHooks?.();
  renderStatsHistory();
  renderActivities();
  renderTeamContacts?.();
  
  // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ nav ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô submit
  $$('.nav-btn').forEach(btn => { if (btn.tagName === 'BUTTON') btn.type = 'button'; });

  // --- ‡∏™‡∏µ‡∏ó‡∏µ‡∏°: ‡∏ú‡∏π‡∏Å‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå + sync ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ---
  // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ó‡∏µ‡∏°
  $('#teamColor')?.addEventListener('input', (e)=>{
    const teamId = $('#selRosterTeam')?.value;
    const t = state.teams.find(x=>x.id===teamId);
    if (t) { t.color = e.target.value; save(); }
    applyRosterColor(t);
  });

  // ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏µ‡∏° ‡πÉ‡∏´‡πâ‡∏ã‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏µ‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡πÅ‡∏•‡∏∞‡πÅ‡∏ñ‡∏ö
  $('#selRosterTeam')?.addEventListener('change', syncRosterColorFromTeam);

  // ‡∏ã‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏µ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏´‡∏•‡∏±‡∏á render ‡πÄ‡∏™‡∏£‡πá‡∏à
  syncRosterColorFromTeam?.();

  // ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
  showPage('dashboard'); // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô 'roster' ‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
});

</script>

</body>
</html>
