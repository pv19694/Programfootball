<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡∏°‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏• (iOS/iPad Ready)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS ‡∏ê‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ */
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #f4f7fa;
        }
        @layer components {
            .input { @apply w-full rounded-xl border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500; }
            .lbl { @apply block mb-1 text-sm font-medium text-slate-700; }
            .btn { @apply inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-medium border transition shadow-sm hover:shadow-md active:scale-[.99]; }
            .nav-item { @apply px-4 py-2 text-center text-sm font-medium transition cursor-pointer; }
            .nav-item.active { @apply text-blue-600 border-b-2 border-blue-600; }
            .player-card { 
                @apply flex items-center p-3 mb-2 bg-white rounded-xl shadow-md transition transform duration-150; 
                border-left: 5px solid var(--team-color, #10b981); /* ‡πÅ‡∏ñ‡∏ö‡∏™‡∏µ‡∏ó‡∏µ‡∏° */
            }
            .player-avatar { @apply w-16 h-16 min-w-16 min-h-16 rounded-full bg-slate-200 overflow-hidden mr-3; }
            .player-avatar img { @apply w-full h-full object-cover; }

            /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô */
            .leaderboard-table { @apply w-full text-sm border-collapse; }
            .leaderboard-table th { @apply p-3 text-left font-semibold text-gray-700 bg-gray-100 border-b; }
            .leaderboard-table td { @apply p-3 border-b text-gray-600; }
            .leaderboard-table tr:hover { @apply bg-blue-50/50; }
        }
    </style>
</head>
<body class="p-0 m-0">
    <div class="max-w-4xl mx-auto bg-white min-h-screen shadow-lg">

        <header class="sticky top-0 bg-white border-b z-10">
            <h1 class="p-4 text-xl font-bold text-slate-800 text-center">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•</h1>
            <nav class="flex justify-around border-t">
                <div class="nav-item active" data-page="scoreboard">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                <div class="nav-item" data-page="matchlog">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•</div>
                <div class="nav-item" data-page="roster">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°</div>
            </nav>
        </header>

        <main class="p-4">
            
            <section id="scoreboard" class="page">
                <h2 class="text-2xl font-semibold mb-4 text-slate-700">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2>
                <div id="tableContainer" class="overflow-x-auto rounded-lg shadow-sm">
                    </div>
            </section>

            <section id="matchlog" class="page hidden">
                <h2 class="text-2xl font-semibold mb-4 text-slate-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</h2>
                <div class="bg-white p-5 rounded-xl shadow-md border-t-4 border-green-500">
                    <div class="mb-4">
                        <label for="selTeamA" class="lbl">‡∏ó‡∏µ‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô (A)</label>
                        <select id="selTeamA" class="input"></select>
                    </div>
                    <div class="mb-4">
                        <label for="selTeamB" class="lbl">‡∏ó‡∏µ‡∏°‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô (B)</label>
                        <select id="selTeamB" class="input"></select>
                    </div>
                    
                    <div class="flex items-center justify-center space-x-4 my-6">
                        <div class="text-center">
                            <label for="scoreA" class="lbl">‡∏õ‡∏£‡∏∞‡∏ï‡∏π (A)</label>
                            <input type="number" id="scoreA" min="0" value="0" class="input w-24 text-center text-xl font-bold">
                        </div>
                        <div class="text-2xl font-bold text-gray-500">-</div>
                        <div class="text-center">
                            <label for="scoreB" class="lbl">‡∏õ‡∏£‡∏∞‡∏ï‡∏π (B)</label>
                            <input type="number" id="scoreB" min="0" value="0" class="input w-24 text-center text-xl font-bold">
                        </div>
                    </div>
                    
                    <button id="btnSaveMatch" class="btn bg-green-600 text-white w-full hover:bg-green-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</button>
                </div>
                
                <h3 class="text-xl font-medium mt-8 mb-3 text-slate-700">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</h3>
                <div id="matchLogContainer" class="space-y-2">
                    </div>
            </section>

            <section id="roster" class="page hidden">
                <h2 class="text-2xl font-semibold mb-4 text-slate-700">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</h2>

                <div class="bg-white p-5 rounded-xl shadow-md mb-6 border-t-4 border-blue-500">
                    <h3 class="text-xl font-medium mb-3">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°</h3>
                    <div class="flex space-x-3 mb-3">
                        <input type="text" id="teamName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà..." class="input flex-1">
                        <input type="color" id="teamColor" value="#00AEEF" class="w-10 h-10 rounded-xl cursor-pointer">
                    </div>
                    <button id="btnAddTeam" class="btn bg-blue-600 text-white w-full hover:bg-blue-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà</button>
                    <div id="teamList" class="mt-4 space-y-2">
                        </div>
                </div>

                <div class="bg-white p-5 rounded-xl shadow-md border-t-4 border-indigo-500">
                    <h3 class="text-xl font-medium mb-3">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h3>
                    <div class="mb-4">
                        <label for="selRosterTeam" class="lbl">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°</label>
                        <select id="selRosterTeam" class="input"></select>
                    </div>

                    <div id="addPlayerForm" class="space-y-3">
                        <input type="text" id="playerName" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" class="input">
                        <input type="text" id="playerNum" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏™‡∏∑‡πâ‡∏≠" class="input w-1/3">
                        <div class="flex items-center space-x-3">
                            <div class="w-20 h-20 rounded-full bg-gray-200 grid place-items-center text-3xl overflow-hidden" id="photoPreview">üë§</div>
                            <input type="file" id="playerPhoto" accept="image/*" class="input flex-1" style="padding-top: 10px;">
                        </div>
                        <button id="btnAddPlayer" class="btn bg-indigo-600 text-white w-full hover:bg-indigo-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤</button>
                    </div>
                    
                    <h3 class="text-xl font-medium mt-8 mb-3 text-slate-700">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ (‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô)</h3>
                    <div id="rosterGrid" class="space-y-3">
                        </div>
                </div>
            </section>

        </main>
    </div>

    <script>
        // Global State & Helper Functions
        const $ = (s) => document.querySelector(s);
        const $$ = (s) => document.querySelectorAll(s);
        const nid = (prefix) => prefix + Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
        const has = (v) => v !== undefined && v !== null && String(v).trim() !== '';
        const esc = (s) => s?.replace(/[&<>"']/g, (m) => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m])) || '';

        let state = load() || { teams: [], players: [], matchLog: [] };
        let tempPlayerPhoto = ''; 
        let editingPlayerId = null;

        function save() {
            localStorage.setItem('jakhongAppState', JSON.stringify(state));
        }

        function load() {
            try {
                return JSON.parse(localStorage.getItem('jakhongAppState'));
            } catch (e) {
                return null;
            }
        }

        // --- Core Rendering Functions ---

        function renderTeamSelects() {
            const teamOptions = state.teams.map(t => 
                `<option value="${t.id}" style="color: ${t.color}">${t.name}</option>`
            ).join('');
            
            const defaultOption = '<option value="">--- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏° ---</option>';
            
            const selA = $('#selTeamA');
            const selB = $('#selTeamB');
            const selRoster = $('#selRosterTeam');
            
            if (selA) selA.innerHTML = defaultOption + teamOptions;
            if (selB) selB.innerHTML = defaultOption + teamOptions;
            if (selRoster) selRoster.innerHTML = defaultOption + teamOptions;
        }

        function renderTable() {
            const teamsWithStats = state.teams.map(t => {
                const teamStats = state.matchLog
                    .filter(m => m.teamAId === t.id || m.teamBId === t.id)
                    .reduce((stats, match) => {
                        let isA = match.teamAId === t.id;
                        let scoreFor = isA ? match.scoreA : match.scoreB;
                        let scoreAgainst = isA ? match.scoreB : match.scoreA;

                        stats.P++;
                        stats.GF += scoreFor;
                        stats.GA += scoreAgainst;
                        stats.GD = stats.GF - stats.GA;

                        if (scoreFor > scoreAgainst) {
                            stats.W++; stats.Pts += 3;
                        } else if (scoreFor < scoreAgainst) {
                            stats.L++;
                        } else {
                            stats.D++; stats.Pts += 1;
                        }
                        return stats;
                    }, { P: 0, W: 0, D: 0, L: 0, GF: 0, GA: 0, GD: 0, Pts: 0 });
                
                return { ...t, stats: teamStats };
            });

            // 1. ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö (Points > GoalDiff > GoalsFor)
            teamsWithStats.sort((a, b) => {
                if (b.stats.Pts !== a.stats.Pts) return b.stats.Pts - a.stats.Pts;
                if (b.stats.GD !== a.stats.GD) return b.stats.GD - a.stats.GD;
                return b.stats.GF - a.stats.GF; // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢
            });

            // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML
            const tableHTML = `
                <table class="leaderboard-table shadow-lg">
                    <thead>
                        <tr>
                            <th class="w-10 text-center">#</th>
                            <th>‡∏ó‡∏µ‡∏°</th>
                            <th class="w-12 text-center">P</th>
                            <th class="w-12 text-center hidden sm:table-cell">W</th>
                            <th class="w-12 text-center hidden sm:table-cell">D</th>
                            <th class="w-12 text-center hidden sm:table-cell">L</th>
                            <th class="w-12 text-center hidden lg:table-cell">GF</th>
                            <th class="w-12 text-center hidden lg:table-cell">GA</th>
                            <th class="w-12 text-center">GD</th>
                            <th class="w-16 text-center">Pts</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${teamsWithStats.map((t, i) => `
                            <tr style="border-left: 5px solid ${t.color || '#10b981'};">
                                <td class="text-center font-bold">${i + 1}</td>
                                <td class="font-medium">${t.name}</td>
                                <td class="text-center">${t.stats.P}</td>
                                <td class="text-center hidden sm:table-cell">${t.stats.W}</td>
                                <td class="text-center hidden sm:table-cell">${t.stats.D}</td>
                                <td class="text-center hidden sm:table-cell">${t.stats.L}</td>
                                <td class="text-center hidden lg:table-cell">${t.stats.GF}</td>
                                <td class="text-center hidden lg:table-cell">${t.stats.GA}</td>
                                <td class="text-center">${t.stats.GD > 0 ? '+' : ''}${t.stats.GD}</td>
                                <td class="text-center font-extrabold text-blue-700">${t.stats.Pts}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            $('#tableContainer').innerHTML = state.teams.length > 0 ? tableHTML : '<p class="text-center text-gray-500 p-8 bg-white rounded-xl">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏µ‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>';
        }

        function renderMatchLog() {
            const container = $('#matchLogContainer');
            if (!container) return;

            const logHTML = state.matchLog.slice().reverse().map(m => {
                const teamA = state.teams.find(t => t.id === m.teamAId) || { name: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ó‡∏µ‡∏°', color: '#ccc' };
                const teamB = state.teams.find(t => t.id === m.teamBId) || { name: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ó‡∏µ‡∏°', color: '#ccc' };
                const scoreColorA = m.scoreA > m.scoreB ? 'font-bold text-green-600' : (m.scoreA < m.scoreB ? 'text-red-500' : 'text-gray-600');
                const scoreColorB = m.scoreB > m.scoreA ? 'font-bold text-green-600' : (m.scoreB < m.scoreA ? 'text-red-500' : 'text-gray-600');

                return `
                    <div class="flex items-center justify-between p-3 bg-white rounded-xl shadow-sm border-l-4 border-gray-300">
                        <div class="flex-1 min-w-0">
                            <span class="text-sm font-medium" style="color: ${teamA.color}">${teamA.name}</span>
                            <span class="text-xs text-gray-500"> vs </span>
                            <span class="text-sm font-medium" style="color: ${teamB.color}">${teamB.name}</span>
                        </div>
                        <div class="flex space-x-1 items-center">
                            <span class="${scoreColorA} text-lg">${m.scoreA}</span>
                            <span class="text-gray-500">-</span>
                            <span class="${scoreColorB} text-lg">${m.scoreB}</span>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = logHTML || '<p class="text-center text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</p>';
        }

        function renderPlayerCard(p, team) {
            const teamInfo = state.teams.find(t => t.id === p.teamId) || { name: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏µ‡∏°', color: '#ccc' };
            
            // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡πÉ‡∏ä‡πâ Base64 ‡∏´‡∏£‡∏∑‡∏≠ Placeholder)
            const playerPhotoContent = has(p.photo) 
                ? `<img src="${esc(p.photo)}" alt="${esc(p.name||'‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤')}" class="w-full h-full object-cover">`
                : `<div class="w-full h-full grid place-items-center text-slate-400 text-3xl">üë§</div>`;

            const cardHtml = `
                <div class="player-card" data-player-id="${p.id}" style="--team-color: ${teamInfo.color || '#10b981'};">

                    <div class="player-avatar">
                        ${playerPhotoContent}
                    </div>
                    
                    <div class="flex-1 min-w-0">
                        <div class="text-xs text-gray-500">${teamInfo.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡∏°'}</div>
                        <div class="flex items-center gap-2 mt-0.5">
                            <span class="font-bold text-base">${p.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠'}</span>
                            ${has(p.num) ? `<span class="px-2 py-0.5 text-xs rounded-full text-white" style="background-color: ${teamInfo.color || '#10b981'};">${p.num}</span>` : ''}
                        </div>
                    </div>

                    <div class="flex space-x-2 shrink-0">
                        <button class="text-blue-500 hover:text-blue-700" data-act="edit" data-id="${p.id}">‚úèÔ∏è</button>
                        <button class="text-red-500 hover:text-red-700" data-act="del" data-id="${p.id}">‚úñÔ∏è</button>
                    </div>
                </div>
            `;
            return cardHtml;
        }

        function renderRosterGrid() {
            const container = $('#rosterGrid');
            if (!container) return;
            
            const teamId = $('#selRosterTeam')?.value;
            const playersToShow = teamId 
                ? state.players.filter(p => p.teamId === teamId) 
                : state.players;

            const gridHTML = playersToShow.map(p => renderPlayerCard(p)).join('');
            container.innerHTML = gridHTML || '<p class="text-center text-gray-500 p-4">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ</p>';
        }
        
        function renderTeamCards() {
            const container = $('#teamList');
            if (!container) return;

            const cards = state.teams.map(t => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-xl border-l-4" style="border-left-color: ${t.color || '#10b981'};">
                    <span class="font-medium text-slate-700">${t.name}</span>
                    <div class="space-x-2">
                        <button class="text-red-500 hover:text-red-700" data-act="del-team" data-id="${t.id}">‡∏•‡∏ö</button>
                    </div>
                </div>
            `).join('');
            container.innerHTML = cards || '<p class="text-center text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏µ‡∏°</p>';
        }


        // --- Core Wire Functions (Event Handlers) ---

        function wireNavigation() {
            $$('.nav-item').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const pageId = e.target.dataset.page;
                    $$('.nav-item').forEach(n => n.classList.remove('active'));
                    e.target.classList.add('active');
                    $$('.page').forEach(p => p.classList.add('hidden'));
                    $(`#${pageId}`).classList.remove('hidden');
                });
            });
        }

        function wireTeamCRUD() {
            $('#btnAddTeam')?.addEventListener('click', () => {
                const name = $('#teamName').value.trim();
                const color = $('#teamColor').value;
                if (!name) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°'); return; }

                const newTeam = {
                    id: nid('t'),
                    name,
                    color
                };
                state.teams.push(newTeam);
                save();
                
                $('#teamName').value = '';
                renderTeamSelects();
                renderTable();
                renderTeamCards();
            });

            $('#teamList')?.addEventListener('click', (e) => {
                const target = e.target;
                if (target.dataset.act === 'del-team') {
                    const teamId = target.dataset.id;
                    if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢')) {
                        state.teams = state.teams.filter(t => t.id !== teamId);
                        state.players = state.players.filter(p => p.teamId !== teamId); // ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏ô‡∏ó‡∏µ‡∏°
                        state.matchLog = state.matchLog.filter(m => m.teamAId !== teamId && m.teamBId !== teamId); // ‡∏•‡∏ö‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
                        save();
                        renderTeamSelects();
                        renderTable();
                        renderRosterGrid();
                        renderTeamCards();
                        renderMatchLog();
                    }
                }
            });
        }

        function wireAddPlayer() {
            // Logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏£‡∏π‡∏õ Base64 ‡∏à‡∏≤‡∏Å File Input
            $('#playerPhoto')?.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        tempPlayerPhoto = event.target.result; // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Base64 ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Global
                        if ($('#photoPreview')) {
                            $('#photoPreview').innerHTML = `<img src="${tempPlayerPhoto}" alt="Photo Preview">`;
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });

            $('#btnAddPlayer')?.addEventListener('click', () => {
                const teamId = $('#selRosterTeam').value;
                const name = $('#playerName').value.trim();
                const num = $('#playerNum').value.trim();

                if (!teamId || !name) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô'); return; }

                // ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
                const newPlayer = {
                    id: nid('p'),
                    teamId,
                    name,
                    num,
                    photo: tempPlayerPhoto || ''
                };

                state.players.push(newPlayer);
                save();
                
                // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
                $('#playerName').value = '';
                $('#playerNum').value = '';
                $('#playerPhoto').value = '';
                tempPlayerPhoto = '';
                if ($('#photoPreview')) $('#photoPreview').innerHTML = 'üë§';

                renderRosterGrid();
            });
            
            $('#rosterGrid')?.addEventListener('click', (e) => {
                const target = e.target;
                const playerId = target.dataset.id;
                
                if (target.dataset.act === 'del') {
                    if (confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                        state.players = state.players.filter(p => p.id !== playerId);
                        save();
                        renderRosterGrid();
                    }
                }
            });
        }
        
        function wireRosterTeamSwitcher() {
            $('#selRosterTeam')?.addEventListener('change', renderRosterGrid);
        }

        function wireMatchControls() {
            $('#btnSaveMatch')?.addEventListener('click', () => {
                const teamAId = $('#selTeamA').value;
                const teamBId = $('#selTeamB').value;
                const scoreA = parseInt($('#scoreA').value);
                const scoreB = parseInt($('#scoreB').value);

                if (!teamAId || !teamBId || teamAId === teamBId) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 2 ‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô');
                    return;
                }
                if (isNaN(scoreA) || isNaN(scoreB) || scoreA < 0 || scoreB < 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ö‡∏ß‡∏Å');
                    return;
                }

                const newMatch = {
                    id: nid('m'),
                    teamAId,
                    teamBId,
                    scoreA,
                    scoreB,
                    date: new Date().toISOString()
                };

                state.matchLog.push(newMatch);
                save();
                
                // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
                $('#scoreA').value = '0';
                $('#scoreB').value = '0';
                $('#selTeamA').value = '';
                $('#selTeamB').value = '';

                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
                renderTable();
                renderMatchLog();
            });
        }


        // --- Boot Sequence ---
        document.addEventListener('DOMContentLoaded', () => {
            load();
            
            // ‡∏ú‡∏π‡∏Å Event Listeners
            wireNavigation();
            wireTeamCRUD();
            wireAddPlayer();
            wireMatchControls();
            wireRosterTeamSwitcher();
            
            // Render ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            renderTeamCards();
            renderTeamSelects();
            renderTable();
            renderMatchLog();
            renderRosterGrid();
        });
    </script>
</body>
</html>
