

<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบจัดบอลสนาม Jakhong</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Kanit', sans-serif;
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .success-message, .error-message {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .success-message {
            background: #10b981;
            color: white;
        }
        
        .error-message {
            background: #ef4444;
            color: white;
        }
        
        .success-message.show, .error-message.show {
            transform: translateX(0);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .record-type-card {
            transition: all 0.3s ease;
        }
        
        .record-type-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        input[name="record-type"]:checked + .record-type-card {
            border-color: currentColor;
            background: rgba(59, 130, 246, 0.05);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-purple-50 min-h-full">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 rounded-full bg-white bg-opacity-20 flex items-center justify-center">
                        <i class="fas fa-futbol text-2xl text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">ระบบจัดบอลสนาม Jakhong</h1>
                        <p class="text-blue-100 text-sm">Football Management System</p>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-sm opacity-90" id="current-date"></div>
                    <div class="text-xs opacity-75" id="current-time"></div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="glass-effect shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4">
            <div class="flex overflow-x-auto">
                <button class="nav-item active flex items-center space-x-2 px-6 py-4 whitespace-nowrap transition-all" onclick="showSection('dashboard')">
                    <i class="fas fa-home"></i>
                    <span>หน้าหลัก</span>
                </button>
                <button class="nav-item flex items-center space-x-2 px-6 py-4 whitespace-nowrap transition-all hover:bg-gray-100" onclick="showSection('match-record')">
                    <i class="fas fa-edit"></i>
                    <span>บันทึกผล</span>
                </button>
                <button class="nav-item flex items-center space-x-2 px-6 py-4 whitespace-nowrap transition-all hover:bg-gray-100" onclick="showSection('player-records')">
                    <i class="fas fa-medal"></i>
                    <span>บันทึกสถิติผู้เล่น</span>
                </button>
                <button class="nav-item flex items-center space-x-2 px-6 py-4 whitespace-nowrap transition-all hover:bg-gray-100" onclick="showSection('leaderboard')">
                    <i class="fas fa-trophy"></i>
                    <span>ตารางคะแนน</span>
                </button>
                <button class="nav-item flex items-center space-x-2 px-6 py-4 whitespace-nowrap transition-all hover:bg-gray-100" onclick="showSection('team-management')">
                    <i class="fas fa-users"></i>
                    <span>จัดการทีม</span>
                </button>

                <button class="nav-item flex items-center space-x-2 px-6 py-4 whitespace-nowrap transition-all hover:bg-gray-100" onclick="showSection('player-list')">
                    <i class="fas fa-list"></i>
                    <span>รายชื่อนักกีฬา</span>
                </button>
                <button class="nav-item flex items-center space-x-2 px-6 py-4 whitespace-nowrap transition-all hover:bg-gray-100" onclick="showSection('next-matches')">
                    <i class="fas fa-calendar-plus"></i>
                    <span>แมทช์ต่อไป</span>
                </button>
                <button class="nav-item flex items-center space-x-2 px-6 py-4 whitespace-nowrap transition-all hover:bg-gray-100" onclick="showSection('daily-summary')">
                    <i class="fas fa-calendar-day"></i>
                    <span>สรุปตามวันที่</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Dashboard Section -->
        <div id="dashboard" class="section">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-gradient-to-br from-blue-500 to-blue-700 text-white rounded-xl shadow-lg p-6 card-hover transition-all">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-100 text-sm mb-1">ทีมทั้งหมด</p>
                            <p class="text-3xl font-bold" id="total-teams">0</p>
                            <p class="text-xs text-blue-200 mt-1">ทีมที่ลงทะเบียน</p>
                        </div>
                        <i class="fas fa-users text-3xl opacity-80"></i>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-green-500 to-green-700 text-white rounded-xl shadow-lg p-6 card-hover transition-all">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-sm mb-1">สมาชิกทั้งหมด</p>
                            <p class="text-3xl font-bold" id="total-players">0</p>
                            <p class="text-xs text-green-200 mt-1">นักกีฬาที่ลงทะเบียน</p>
                        </div>
                        <i class="fas fa-user-friends text-3xl opacity-80"></i>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-purple-500 to-purple-700 text-white rounded-xl shadow-lg p-6 card-hover transition-all">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-100 text-sm mb-1">แมทช์ทั้งหมด</p>
                            <p class="text-3xl font-bold" id="total-matches">0</p>
                            <p class="text-xs text-purple-200 mt-1">การแข่งขันที่จบแล้ว</p>
                        </div>
                        <i class="fas fa-futbol text-3xl opacity-80"></i>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-yellow-500 to-orange-600 text-white rounded-xl shadow-lg p-6 card-hover transition-all">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-yellow-100 text-sm mb-1">ผู้นำลีก</p>
                            <p class="text-lg font-bold" id="league-leader-name">-</p>
                            <p class="text-sm text-yellow-100" id="league-leader-points">0 คะแนน</p>
                        </div>
                        <i class="fas fa-crown text-3xl opacity-80"></i>
                    </div>
                </div>
            </div>

            <!-- Additional Stats Row -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="glass-effect rounded-xl shadow-lg p-6 card-hover transition-all">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm mb-1">แมทช์สัปดาห์นี้</p>
                            <p class="text-2xl font-bold text-indigo-600" id="matches-this-week">0</p>
                        </div>
                        <i class="fas fa-calendar-week text-2xl text-indigo-500"></i>
                    </div>
                </div>

                <div class="glass-effect rounded-xl shadow-lg p-6 card-hover transition-all">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm mb-1">ทีมยอดนิยมเดือนนี้</p>
                            <p class="text-lg font-bold text-pink-600" id="top-team-month">-</p>
                        </div>
                        <i class="fas fa-fire text-2xl text-pink-500"></i>
                    </div>
                </div>

                <div class="glass-effect rounded-xl shadow-lg p-6 card-hover transition-all">
                    <div id="goals-stats" class="flex justify-between">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-green-600">0</div>
                            <div class="text-sm text-gray-600">ประตูรวม</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-600">0</div>
                            <div class="text-sm text-gray-600">เฉลี่ย/แมทช์</div>
                        </div>
                    </div>
                </div>

                <div class="glass-effect rounded-xl shadow-lg p-6 card-hover transition-all">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm mb-1">สถิติผู้เล่น</p>
                            <p class="text-2xl font-bold text-teal-600" id="total-player-records">0</p>
                            <p class="text-xs text-gray-500 mt-1">บันทึกทั้งหมด</p>
                        </div>
                        <i class="fas fa-chart-bar text-2xl text-teal-500"></i>
                    </div>
                </div>
            </div>

            <!-- Team Managers Section -->
            <div class="glass-effect rounded-xl shadow-lg p-6 mb-8">
                <h3 class="text-xl font-bold mb-6 flex items-center">
                    <i class="fas fa-user-tie mr-3 text-purple-500"></i>
                    ผู้จัดการทีม
                </h3>
                <div id="team-managers-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Team managers will be populated by JavaScript -->
                </div>
            </div>

            <!-- Recent Matches -->
            <div class="glass-effect rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold mb-6 flex items-center">
                    <i class="fas fa-clock mr-3 text-blue-500"></i>
                    แมทช์ล่าสุด
                </h3>
                <div id="recent-matches-list" class="space-y-4">
                    <!-- Recent matches will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Match Record Section -->
        <div id="match-record" class="section hidden">
            <div class="glass-effect rounded-xl shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold mb-6 flex items-center">
                    <i class="fas fa-edit mr-3 text-blue-500"></i>
                    บันทึกผลการแข่งขัน
                </h2>
                <form class="space-y-6" onsubmit="handleMatchSubmit(event)">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">วันที่แข่งขัน *</label>
                        <input type="date" id="match-date" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ทีมเจ้าบ้าน *</label>
                            <select id="team-a" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">เลือกทีม</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ทีมเยือน *</label>
                            <select id="team-b" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">เลือกทีม</option>
                            </select>
                        </div>
                    </div>

                    <div class="bg-blue-50 rounded-lg p-6 border-2 border-blue-200">
                        <h3 class="font-bold text-lg mb-4 text-center text-blue-800">ผลการแข่งขัน</h3>
                        <div class="flex items-center justify-center space-x-8">
                            <div class="text-center">
                                <div class="mb-2 font-medium text-blue-700">ทีมเจ้าบ้าน</div>
                                <input type="number" id="score-a" min="0" max="99" class="w-20 h-16 text-center text-2xl font-bold border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white shadow-md" required>
                            </div>
                            <div class="text-3xl font-bold text-blue-600">VS</div>
                            <div class="text-center">
                                <div class="mb-2 font-medium text-blue-700">ทีมเยือน</div>
                                <input type="number" id="score-b" min="0" max="99" class="w-20 h-16 text-center text-2xl font-bold border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white shadow-md" required>
                            </div>
                        </div>
                    </div>

                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 bg-gradient-to-r from-blue-600 to-blue-800 text-white py-3 px-6 rounded-lg hover:from-blue-700 hover:to-blue-900 transition-all font-medium">
                            <i class="fas fa-save mr-2"></i>
                            บันทึกผลการแข่งขัน
                        </button>
                        <button type="button" onclick="clearMatchForm()" class="bg-gray-300 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-400 transition-colors">
                            <i class="fas fa-eraser mr-2"></i>
                            ล้างฟอร์ม
                        </button>
                    </div>
                </form>
            </div>

            <!-- Match History -->
            <div class="glass-effect rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold mb-6">ประวัติการแข่งขัน</h3>
                <div class="space-y-4" id="match-history-list">
                    <!-- Match history will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Leaderboard Section -->
        <div id="leaderboard" class="section hidden">
            <div class="glass-effect rounded-xl shadow-lg p-6">
                <div class="mb-8">
                    <div class="bg-gradient-to-r from-blue-800 to-purple-800 text-white px-8 py-6 rounded-xl text-center">
                        <h2 class="text-3xl font-bold flex items-center justify-center mb-2">
                            <i class="fas fa-trophy mr-3 text-yellow-300"></i>
                            ตารางคะแนน JAKHONG LEAGUE
                        </h2>

                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full" id="leaderboard-table">
                        <thead>
                            <tr class="bg-gradient-to-r from-blue-600 to-purple-800 text-white">
                                <th class="px-4 py-3 text-center font-bold rounded-tl-lg">อันดับ</th>
                                <th class="px-4 py-3 text-left font-bold">ทีม</th>
                                <th class="px-4 py-3 text-center font-bold">แข่ง</th>
                                <th class="px-4 py-3 text-center font-bold">ชนะ</th>
                                <th class="px-4 py-3 text-center font-bold">เสมอ</th>
                                <th class="px-4 py-3 text-center font-bold">แพ้</th>
                                <th class="px-4 py-3 text-center font-bold">ได้</th>
                                <th class="px-4 py-3 text-center font-bold">เสีย</th>
                                <th class="px-4 py-3 text-center font-bold">+/-</th>
                                <th class="px-4 py-3 text-center font-bold">คะแนน</th>
                                <th class="px-4 py-3 text-center font-bold rounded-tr-lg">ฟอร์ม</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Leaderboard will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Team Management Section -->
        <div id="team-management" class="section hidden">
            <div class="glass-effect rounded-xl shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold mb-6 flex items-center">
                    <i class="fas fa-users mr-3 text-blue-500"></i>
                    เพิ่มทีมใหม่
                </h2>
                
                <form class="space-y-6" onsubmit="handleTeamSubmit(event)">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ชื่อทีม *</label>
                        <input type="text" id="team-name" placeholder="กรอกชื่อทีม เช่น ทีมสิงห์, ทีมเสือ" 
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">โลโก้ทีม</label>
                        <div class="flex items-center space-x-4 mb-4">
                            <div class="relative">
                                <input type="file" id="team-logo" accept="image/*" class="sr-only" onchange="handleLogoUpload(event)">
                                <label for="team-logo" class="cursor-pointer flex items-center justify-center w-20 h-20 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 transition-colors">
                                    <div id="logo-preview" class="w-full h-full rounded-lg bg-gray-100 flex items-center justify-center">
                                        <i class="fas fa-camera text-gray-400 text-xl"></i>
                                    </div>
                                </label>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm text-gray-600 mb-1">อัพโหลดโลโก้ทีม (ไม่บังคับ)</p>
                                <p class="text-xs text-gray-500">รองรับไฟล์ JPG, PNG ขนาดไม่เกิน 2MB</p>
                                <button type="button" id="remove-logo" onclick="removeLogo()" class="text-red-600 text-xs mt-1 hidden">ลบโลโก้</button>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">สีประจำทีม *</label>
                        <div class="grid grid-cols-8 gap-3">
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="red" class="sr-only" required>
                                <div class="w-12 h-12 rounded-full bg-red-500 border-4 border-transparent hover:border-red-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="blue" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-blue-500 border-4 border-transparent hover:border-blue-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="green" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-green-500 border-4 border-transparent hover:border-green-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="yellow" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-yellow-400 border-4 border-transparent hover:border-yellow-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-black opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="purple" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-purple-500 border-4 border-transparent hover:border-purple-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="orange" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-orange-500 border-4 border-transparent hover:border-orange-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="pink" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-pink-500 border-4 border-transparent hover:border-pink-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="indigo" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-indigo-500 border-4 border-transparent hover:border-indigo-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="teal" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-teal-500 border-4 border-transparent hover:border-teal-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="cyan" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-cyan-500 border-4 border-transparent hover:border-cyan-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="lime" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-lime-500 border-4 border-transparent hover:border-lime-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-black opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="rose" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-rose-500 border-4 border-transparent hover:border-rose-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="amber" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-amber-500 border-4 border-transparent hover:border-amber-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-black opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="emerald" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-emerald-500 border-4 border-transparent hover:border-emerald-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="violet" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-violet-500 border-4 border-transparent hover:border-violet-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="fuchsia" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-fuchsia-500 border-4 border-transparent hover:border-fuchsia-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="white" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-white border-4 border-gray-300 hover:border-gray-400 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-black opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="black" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-black border-4 border-transparent hover:border-gray-600 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="gray" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-gray-500 border-4 border-transparent hover:border-gray-400 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="slate" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-slate-600 border-4 border-transparent hover:border-slate-400 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="zinc" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-zinc-600 border-4 border-transparent hover:border-zinc-400 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="neutral" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-neutral-600 border-4 border-transparent hover:border-neutral-400 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="stone" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-stone-600 border-4 border-transparent hover:border-stone-400 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="team-color" value="sky" class="sr-only">
                                <div class="w-12 h-12 rounded-full bg-sky-500 border-4 border-transparent hover:border-sky-300 transition-all shadow-md flex items-center justify-center">
                                    <i class="fas fa-check text-white opacity-0 team-color-check"></i>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 bg-gradient-to-r from-blue-600 to-blue-800 text-white py-3 px-6 rounded-lg hover:from-blue-700 hover:to-blue-900 transition-all font-medium">
                            <i class="fas fa-plus mr-2"></i>
                            เพิ่มทีม
                        </button>
                        <button type="button" onclick="clearTeamForm()" class="bg-gray-300 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-400 transition-colors">
                            <i class="fas fa-eraser mr-2"></i>
                            ล้างฟอร์ม
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Teams List -->
            <div class="glass-effect rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold mb-6 flex items-center">
                    <i class="fas fa-list mr-3 text-green-500"></i>
                    รายการทีม
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="teams-list">
                    <!-- Teams will be populated by JavaScript -->
                </div>
            </div>
        </div>



        <!-- Player List Section -->
        <div id="player-list" class="section hidden">
            <div class="glass-effect rounded-xl shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold mb-6 flex items-center">
                    <i class="fas fa-user-plus mr-3 text-indigo-500"></i>
                    เพิ่มนักกีฬาใหม่
                </h2>
                
                <form class="space-y-6" onsubmit="handlePlayerSubmit(event)">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ชื่อผู้เล่น *</label>
                            <input type="text" id="player-name" placeholder="กรอกชื่อ-นามสกุล" 
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">วันเกิด</label>
                            <input type="date" id="player-birthdate" 
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   onchange="calculateAge()">
                            <p class="text-xs text-gray-500 mt-1" id="player-age-display">อายุจะแสดงเมื่อเลือกวันเกิด</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">รูปโปรไฟล์</label>
                            <div class="flex items-center space-x-4 mb-4">
                                <div class="relative">
                                    <input type="file" id="player-photo" accept="image/*" class="sr-only" onchange="handlePlayerPhotoUpload(event)">
                                    <label for="player-photo" class="cursor-pointer flex items-center justify-center w-20 h-20 border-2 border-dashed border-gray-300 rounded-full hover:border-blue-500 transition-colors">
                                        <div id="player-photo-preview" class="w-full h-full rounded-full bg-gray-100 flex items-center justify-center">
                                            <i class="fas fa-user text-gray-400 text-xl"></i>
                                        </div>
                                    </label>
                                </div>
                                <div class="flex-1">
                                    <p class="text-sm text-gray-600 mb-1">อัพโหลดรูปโปรไฟล์ (ไม่บังคับ)</p>
                                    <p class="text-xs text-gray-500">รองรับไฟล์ JPG, PNG ขนาดไม่เกิน 2MB</p>
                                    <button type="button" id="remove-player-photo" onclick="removePlayerPhoto()" class="text-red-600 text-xs mt-1 hidden">ลบรูป</button>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ทีม</label>
                            <select id="player-team" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">เลือกทีม</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">เบอร์เสื้อ</label>
                            <input type="number" id="player-jersey" min="1" max="99" placeholder="1-99" 
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">เบอร์โทร</label>
                            <input type="tel" id="player-phone" placeholder="08X-XXX-XXXX" 
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    
                    <!-- Team Manager Section -->
                    <div class="bg-gradient-to-r from-purple-50 to-indigo-50 border border-purple-200 rounded-lg p-4">
                        <div class="flex items-center space-x-3 mb-3">
                            <i class="fas fa-user-tie text-purple-600 text-lg"></i>
                            <h3 class="text-lg font-bold text-purple-800">ผู้จัดการทีม</h3>
                        </div>
                        <div class="flex items-center space-x-3">
                            <input type="checkbox" id="is-team-manager" class="w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500">
                            <label for="is-team-manager" class="text-sm font-medium text-gray-700">
                                กำหนดเป็นผู้จัดการทีม
                            </label>
                        </div>
                        <p class="text-xs text-gray-600 mt-2">
                            <i class="fas fa-info-circle mr-1"></i>
                            ผู้จัดการทีมจะแสดงในหน้าหลักพร้อมข้อมูลติดต่อ และสามารถมีได้หลายคนต่อทีม
                        </p>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 bg-gradient-to-r from-indigo-600 to-indigo-800 text-white py-3 px-6 rounded-lg hover:from-indigo-700 hover:to-indigo-900 transition-all font-medium">
                            <i class="fas fa-user-plus mr-2"></i>
                            เพิ่มผู้เล่น
                        </button>
                        <button type="button" onclick="clearPlayerForm()" class="bg-gray-300 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-400 transition-colors">
                            <i class="fas fa-eraser mr-2"></i>
                            ล้างฟอร์ม
                        </button>
                    </div>
                </form>
            </div>
            
            <div class="glass-effect rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold flex items-center">
                        <i class="fas fa-users mr-3 text-green-500"></i>
                        รายชื่อนักกีฬา
                    </h3>
                    
                    <!-- Player Filters -->
                    <div class="flex space-x-3">
                        <select id="filter-player-team" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="filterPlayers()">
                            <option value="">ทุกทีม</option>
                        </select>
                        <select id="filter-player-role" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="filterPlayers()">
                            <option value="">ทุกตำแหน่ง</option>
                            <option value="manager">ผู้จัดการทีม</option>
                            <option value="player">นักกีฬา</option>
                        </select>
                    </div>
                </div>
                
                <!-- Team Banner (shown when team is filtered) -->
                <div id="team-banner" class="hidden mb-6">
                    <!-- Team banner will be populated by JavaScript -->
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="players-list">
                    <!-- Players will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Player Records Section -->
        <div id="player-records" class="section hidden">
            <div class="glass-effect rounded-xl shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold mb-6 flex items-center">
                    <i class="fas fa-medal mr-3 text-yellow-500"></i>
                    บันทึกสถิติผู้เล่น
                </h2>
                
                <form class="space-y-6" onsubmit="handlePlayerRecordSubmit(event)">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">วันที่ *</label>
                            <input type="date" id="record-date" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">เวลา</label>
                            <input type="time" id="record-time" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ทีม *</label>
                            <select id="record-team" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required onchange="updatePlayersByTeam()">
                                <option value="">เลือกทีม</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ผู้เล่น *</label>
                            <select id="record-player" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <option value="">เลือกผู้เล่น</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">ประเภทสถิติ *</label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <label class="cursor-pointer">
                                <input type="radio" name="record-type" value="goal" class="sr-only" required>
                                <div class="record-type-card border-2 border-gray-300 rounded-lg p-4 text-center hover:border-green-500 transition-all">
                                    <i class="fas fa-futbol text-3xl text-green-500 mb-2"></i>
                                    <div class="font-medium">ยิงประตู</div>
                                    <div class="text-xs text-gray-500">ดาวซัลโว</div>
                                </div>
                            </label>
                            
                            <label class="cursor-pointer">
                                <input type="radio" name="record-type" value="save" class="sr-only">
                                <div class="record-type-card border-2 border-gray-300 rounded-lg p-4 text-center hover:border-blue-500 transition-all">
                                    <i class="fas fa-hand-paper text-3xl text-blue-500 mb-2"></i>
                                    <div class="font-medium">เซฟ</div>
                                    <div class="text-xs text-gray-500">ประตูยอดเยี่ยม</div>
                                </div>
                            </label>
                            
                            <label class="cursor-pointer">
                                <input type="radio" name="record-type" value="yellow" class="sr-only">
                                <div class="record-type-card border-2 border-gray-300 rounded-lg p-4 text-center hover:border-yellow-500 transition-all">
                                    <i class="fas fa-square text-3xl text-yellow-500 mb-2"></i>
                                    <div class="font-medium">ใบเหลือง</div>
                                    <div class="text-xs text-gray-500">คำเตือน</div>
                                </div>
                            </label>
                            
                            <label class="cursor-pointer">
                                <input type="radio" name="record-type" value="red" class="sr-only">
                                <div class="record-type-card border-2 border-gray-300 rounded-lg p-4 text-center hover:border-red-500 transition-all">
                                    <i class="fas fa-square text-3xl text-red-500 mb-2"></i>
                                    <div class="font-medium">ใบแดง</div>
                                    <div class="text-xs text-gray-500">ไล่ออก</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">จำนวน *</label>
                        <div class="flex items-center justify-center space-x-4 bg-gray-50 rounded-lg p-4">
                            <button type="button" onclick="decreaseCount()" class="w-12 h-12 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center font-bold text-xl transition-colors shadow-md hover:shadow-lg">
                                <i class="fas fa-minus"></i>
                            </button>
                            
                            <div class="flex flex-col items-center">
                                <div id="record-count-display" class="text-4xl font-bold text-gray-800 mb-1">1</div>
                                <div class="text-sm text-gray-600 font-medium">จำนวน</div>
                            </div>
                            
                            <button type="button" onclick="increaseCount()" class="w-12 h-12 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center font-bold text-xl transition-colors shadow-md hover:shadow-lg">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <input type="hidden" id="record-count" value="1" required>
                        <p class="text-xs text-gray-500 mt-2 text-center">สำหรับประตู/เซฟ สามารถเพิ่มจำนวนได้ (สูงสุด 10)</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">หมายเหตุ</label>
                        <textarea id="record-note" rows="3" placeholder="เช่น ประตูชัยชนะ, เซฟสุดยอด, ฟาวล์หนัก..." class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 bg-gradient-to-r from-yellow-600 to-yellow-800 text-white py-3 px-6 rounded-lg hover:from-yellow-700 hover:to-yellow-900 transition-all font-medium">
                            <i class="fas fa-save mr-2"></i>
                            บันทึกสถิติ
                        </button>
                        <button type="button" onclick="clearRecordForm()" class="bg-gray-300 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-400 transition-colors">
                            <i class="fas fa-eraser mr-2"></i>
                            ล้างฟอร์ม
                        </button>
                    </div>
                </form>
            </div>

            <!-- Top Players Stats -->
            <div class="mb-8">
                <div class="text-center mb-6">
                    <div class="bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 px-6 py-4 rounded-xl shadow-lg border border-yellow-300">
                        <h2 class="text-2xl font-bold text-white mb-1 drop-shadow-md">
                            🏆 อันดับสถิติผู้เล่น
                        </h2>
                        <p class="text-yellow-100 text-sm drop-shadow-sm">ผู้เล่นยอดเยี่ยมแห่งสนาม JAKHONG</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- Top Scorers -->
                    <div class="bg-green-50 border border-green-200 rounded-xl shadow-sm p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-2">
                                <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-futbol text-green-600 text-sm"></i>
                                </div>
                                <h4 class="font-semibold text-green-800 text-sm">ดาวซัลโว</h4>
                            </div>
                            <span class="bg-green-100 text-green-700 px-2 py-1 rounded-md text-xs font-medium">⚽</span>
                        </div>
                        <div id="top-scorers" class="space-y-2">
                            <!-- Top scorers will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Top Keepers -->
                    <div class="bg-blue-50 border border-blue-200 rounded-xl shadow-sm p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-2">
                                <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-hand-paper text-blue-600 text-sm"></i>
                                </div>
                                <h4 class="font-semibold text-blue-800 text-sm">ประตูยอดเยี่ยม</h4>
                            </div>
                            <span class="bg-blue-100 text-blue-700 px-2 py-1 rounded-md text-xs font-medium">🥅</span>
                        </div>
                        <div id="top-keepers" class="space-y-2">
                            <!-- Top keepers will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Most Yellow Cards -->
                    <div class="bg-yellow-50 border border-yellow-200 rounded-xl shadow-sm p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-2">
                                <div class="w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-square text-yellow-600 text-sm"></i>
                                </div>
                                <h4 class="font-semibold text-yellow-800 text-sm">ใบเหลืองมากสุด</h4>
                            </div>
                            <span class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded-md text-xs font-medium">⚠️</span>
                        </div>
                        <div id="most-yellow-cards" class="space-y-2">
                            <!-- Most yellow cards will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Most Red Cards -->
                    <div class="bg-red-50 border border-red-200 rounded-xl shadow-sm p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-2">
                                <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-square text-red-600 text-sm"></i>
                                </div>
                                <h4 class="font-semibold text-red-800 text-sm">ใบแดงมากสุด</h4>
                            </div>
                            <span class="bg-red-100 text-red-700 px-2 py-1 rounded-md text-xs font-medium">🚫</span>
                        </div>
                        <div id="most-red-cards" class="space-y-2">
                            <!-- Most red cards will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Records List -->
            <div class="glass-effect rounded-xl shadow-lg p-6 mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold flex items-center">
                        <i class="fas fa-list mr-3 text-purple-500"></i>
                        ประวัติสถิติผู้เล่น
                    </h3>
                    <div class="flex space-x-2">
                        <select id="filter-record-type" class="border border-gray-300 rounded-lg px-3 py-2 text-sm" onchange="filterPlayerRecords()">
                            <option value="">ทุกประเภท</option>
                            <option value="goal">ยิงประตู</option>
                            <option value="save">เซฟ</option>
                            <option value="yellow">ใบเหลือง</option>
                            <option value="red">ใบแดง</option>
                        </select>
                        <input type="date" id="filter-record-date" class="border border-gray-300 rounded-lg px-3 py-2 text-sm" onchange="filterPlayerRecords()">
                    </div>
                </div>
                <div id="player-records-list" class="space-y-4">
                    <!-- Player records will be populated by JavaScript -->
                </div>
            </div>

            <!-- Player Statistics Dashboard -->
            <div class="glass-effect rounded-xl shadow-lg p-6 mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold flex items-center">
                        <i class="fas fa-chart-bar mr-3 text-indigo-500"></i>
                        Dashboard สถิติผู้เล่น
                    </h3>
                    <div class="flex space-x-3">
                        <select id="stats-team-filter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="filterPlayerStats()">
                            <option value="">ทุกทีม</option>
                        </select>
                        <select id="stats-type-filter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="filterPlayerStats()">
                            <option value="">ทุกประเภท</option>
                            <option value="goal">ประตู</option>
                            <option value="save">เซฟ</option>
                            <option value="yellow">ใบเหลือง</option>
                            <option value="red">ใบแดง</option>
                        </select>
                    </div>
                </div>
                
                <div id="player-stats-dashboard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Player stats will be populated by JavaScript -->
                </div>
            </div>


        </div>

        <!-- Next Matches Section -->
        <div id="next-matches" class="section hidden">
            <div class="glass-effect rounded-xl shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold mb-6 flex items-center">
                    <i class="fas fa-calendar-plus mr-3 text-green-500"></i>
                    จัดแมทช์ต่อไป
                </h2>
                
                <form class="space-y-6" onsubmit="handleNextMatchSubmit(event)">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">วันที่แข่งขัน *</label>
                            <input type="date" id="next-match-date" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">เวลาแข่งขัน *</label>
                            <input type="time" id="next-match-time" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" required>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ทีมเจ้าบ้าน *</label>
                            <select id="next-team-a" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" required>
                                <option value="">เลือกทีม</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ทีมเยือน *</label>
                            <select id="next-team-b" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" required>
                                <option value="">เลือกทีม</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">สถานที่แข่งขัน</label>
                        <input type="text" id="next-match-venue" placeholder="เช่น สนาม Jakhong, สนามหลัก..." class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">หมายเหตุ</label>
                        <textarea id="next-match-note" rows="3" placeholder="เช่น แมทช์สำคัญ, เกมชิงชนะเลิศ..." class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"></textarea>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 bg-gradient-to-r from-green-600 to-green-800 text-white py-3 px-6 rounded-lg hover:from-green-700 hover:to-green-900 transition-all font-medium">
                            <i class="fas fa-plus mr-2"></i>
                            จัดแมทช์ต่อไป
                        </button>
                        <button type="button" onclick="clearNextMatchForm()" class="bg-gray-300 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-400 transition-colors">
                            <i class="fas fa-eraser mr-2"></i>
                            ล้างฟอร์ม
                        </button>
                    </div>
                </form>
            </div>

            <!-- Upcoming Matches List -->
            <div class="glass-effect rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold flex items-center">
                        <i class="fas fa-clock mr-3 text-blue-500"></i>
                        แมทช์ที่กำลังจะมาถึง
                    </h3>
                    <div class="text-sm text-gray-600">
                        <i class="fas fa-info-circle mr-1"></i>
                        เรียงตามวันที่ใกล้ที่สุด
                    </div>
                </div>
                <div id="upcoming-matches-list" class="space-y-4">
                    <!-- Upcoming matches will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Daily Summary Section -->
        <div id="daily-summary" class="section hidden">
            <div class="glass-effect rounded-xl shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold mb-6 flex items-center">
                    <i class="fas fa-calendar-day mr-3 text-indigo-500"></i>
                    สรุปตามวันที่
                </h2>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">เลือกวันที่</label>
                    <input type="date" id="summary-date" class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="updateDailySummary()">
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-blue-500 to-blue-700 text-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-100 text-sm mb-1">แมทช์ในวันนี้</p>
                                <p class="text-3xl font-bold" id="daily-matches">0</p>
                            </div>
                            <i class="fas fa-futbol text-3xl opacity-80"></i>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-green-500 to-green-700 text-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-100 text-sm mb-1">ประตูรวม</p>
                                <p class="text-3xl font-bold" id="daily-goals">0</p>
                            </div>
                            <i class="fas fa-bullseye text-3xl opacity-80"></i>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-purple-500 to-purple-700 text-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-purple-100 text-sm mb-1">ทีมที่เล่น</p>
                                <p class="text-3xl font-bold" id="daily-teams">0</p>
                            </div>
                            <i class="fas fa-users text-3xl opacity-80"></i>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg p-6 shadow-md mb-8">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fas fa-list mr-2 text-blue-500"></i>
                        รายการแมทช์ในวันที่เลือก
                    </h3>
                    <div id="daily-matches-list" class="space-y-4">
                        <!-- Daily matches will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Daily Player Records -->
                <div class="bg-white rounded-lg p-6 shadow-md">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <i class="fas fa-medal mr-2 text-purple-500"></i>
                        สถิติผู้เล่นในวันที่เลือก
                    </h3>
                    <div id="daily-player-records" class="space-y-4">
                        <!-- Daily player records will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Success/Error Messages -->
    <div id="success-message" class="success-message">
        <i class="fas fa-check-circle mr-2"></i>
        <span id="success-text">บันทึกสำเร็จ!</span>
    </div>

    <div id="error-message" class="error-message">
        <i class="fas fa-exclamation-circle mr-2"></i>
        <span id="error-text">เกิดข้อผิดพลาด!</span>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full mx-4 transform transition-all">
            <div class="p-6">
                <div class="flex items-center justify-center w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full">
                    <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
                </div>
                
                <h3 class="text-xl font-bold text-center text-gray-900 mb-2">ยืนยันการลบ</h3>
                <p class="text-gray-600 text-center mb-6" id="delete-message">คุณแน่ใจหรือไม่ที่จะลบรายการนี้?</p>
                
                <div id="delete-details" class="bg-gray-50 rounded-lg p-4 mb-6 text-sm">
                    <!-- Delete details will be populated here -->
                </div>
                
                <div class="flex space-x-3">
                    <button id="cancel-delete" class="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors font-medium">
                        ยกเลิก
                    </button>
                    <button id="confirm-delete" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium">
                        ลบแน่นอน
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global Data Storage
        let teams = [];
        let players = [];
        let matches = [];
        let playerRecords = [];
        let nextMatches = [];
        let editingTeam = null;
        let editingPlayer = null;
        let editingMatch = null;
        let editingPlayerRecord = null;
        let editingNextMatch = null;
        let deleteCallback = null;

        // Auto-save functions
        function saveToDatabase() {
            try {
                const data = {
                    teams: teams,
                    players: players,
                    matches: matches,
                    playerRecords: playerRecords,
                    nextMatches: nextMatches,
                    lastSaved: new Date().toISOString()
                };
                localStorage.setItem('jakhong_football_data', JSON.stringify(data));
                console.log('✅ ข้อมูลถูกบันทึกอัตโนมัติแล้ว');
            } catch (error) {
                console.error('❌ เกิดข้อผิดพลาดในการบันทึกข้อมูล:', error);
            }
        }

        function loadFromDatabase() {
            try {
                const savedData = localStorage.getItem('jakhong_football_data');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    teams = data.teams || [];
                    players = data.players || [];
                    matches = data.matches || [];
                    playerRecords = data.playerRecords || [];
                    nextMatches = data.nextMatches || [];
                    console.log('✅ โหลดข้อมูลจากฐานข้อมูลสำเร็จ:', {
                        teams: teams.length,
                        players: players.length,
                        matches: matches.length,
                        playerRecords: playerRecords.length,
                        nextMatches: nextMatches.length,
                        lastSaved: data.lastSaved
                    });
                    return true;
                }
            } catch (error) {
                console.error('❌ เกิดข้อผิดพลาดในการโหลดข้อมูล:', error);
            }
            return false;
        }

       // ต้องแทนที่ document.addEventListener('DOMContentLoaded', function() { ... }) เดิมทั้งหมด
document.addEventListener('DOMContentLoaded', async function() { // *** ต้องมี async ***
    
    // ดึงรายชื่อโครงสร้างข้อมูลทั้งหมดที่คุณต้องการโหลด
    const dataStructuresToLoad = Object.keys(DATA_STRUCTURES); 

    try {
        console.log('📊 กำลังโหลดข้อมูลจาก Cloud...');
        
        // *** ใช้ AWAIT เพื่อรอการโหลดข้อมูลจาก Cloud ทั้งหมดให้เสร็จก่อนรันต่อ ***
        await Promise.all(dataStructuresToLoad.map(loadFromFirestore));
        
        console.log('✅ โหลดข้อมูลเสร็จสิ้น');

        // ตรรกะตรวจสอบข้อมูลเริ่มต้น
        if (teams.length === 0) { // สมมติว่าใช้ teams เป็นตัวแทนการตรวจสอบ
            console.log('📊 ไม่พบข้อมูลเดิม กำลังสร้างข้อมูลตัวอย่าง...');
            addSampleData(); 
            // บันทึกข้อมูลตัวอย่างขึ้น Cloud ทันที
            await saveToFirestore('teams'); // หรือเรียกฟังก์ชัน saveAllDataToCloud() ถ้าคุณสร้างไว้
            console.log('✅ สร้างและบันทึกข้อมูลตัวอย่างเสร็จสิ้น');
        }

    } catch (error) {
        console.error('❌ เกิดข้อผิดพลาดในการโหลดข้อมูลเริ่มต้น:', error);
    }
    
    // โค้ดอัปเดต UI ทั้งหมดของคุณจะมาต่อตรงนี้ (โดยไม่ต้องมี setTimeout)
    console.log('🔄 กำลังอัปเดต UI ทันที...');
    updateDashboardStats();
    updateTeamDropdowns();
    // ... (ฟังก์ชัน UI อื่นๆ ทั้งหมด) ...
});
            
            updateCurrentDateTime();
            setInterval(updateCurrentDateTime, 1000);
            
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('match-date').value = today;
            document.getElementById('summary-date').value = today;
            document.getElementById('record-date').value = today;
            
            // Add event listeners for team color selection
            document.querySelectorAll('input[name="team-color"]').forEach(radio => {
                radio.addEventListener('change', updateTeamColorPreview);
            });

            // Force immediate UI update with data
            console.log('🔄 กำลังอัปเดต UI ทันที...');
            
            // Update all components immediately with the loaded data
            setTimeout(() => {
                updateDashboardStats();
                updateTeamDropdowns();
                updatePlayerFilters();
                updateTeamManagersList();
                updateTeamsList();
                updatePlayersList();
                updateMatchHistory();
                updateLeaderboard();
                updatePlayerRecordsList();
                updateTopPlayersStats();
                updateDailySummary();
                updateRecordTeamDropdown();
                updateStatsTeamFilter();
                updateNextMatchDropdowns();
                updateUpcomingMatchesList();
                
                console.log('✅ อัปเดต UI เสร็จสิ้น');
                showSuccessMessage('ระบบพร้อมใช้งาน! ข้อมูลโหลดเรียบร้อยแล้ว 🎉');
            }, 100);
            
            // Setup delete modal event listeners
            setupDeleteModal();
        });

        // Add comprehensive sample data for demonstration
        function addSampleData() {
            // Sample teams with diverse colors and characteristics
            teams = [
                { id: 1, name: 'ทีมสิงห์ทอง', primaryColor: 'yellow', logo: null, createdAt: new Date('2024-01-01') },
                { id: 2, name: 'ทีมเสือน้ำเงิน', primaryColor: 'blue', logo: null, createdAt: new Date('2024-01-02') },
                { id: 3, name: 'ทีมมังกรแดง', primaryColor: 'red', logo: null, createdAt: new Date('2024-01-03') },
                { id: 4, name: 'ทีมนกอินทรี', primaryColor: 'green', logo: null, createdAt: new Date('2024-01-04') },
                { id: 5, name: 'ทีมช้างขาว', primaryColor: 'white', logo: null, createdAt: new Date('2024-01-05') },
                { id: 6, name: 'ทีมหมาป่า', primaryColor: 'gray', logo: null, createdAt: new Date('2024-01-06') },
                { id: 7, name: 'ทีมเสือดาว', primaryColor: 'purple', logo: null, createdAt: new Date('2024-01-07') },
                { id: 8, name: 'ทีมนกเงือก', primaryColor: 'teal', logo: null, createdAt: new Date('2024-01-08') }
            ];

            // Comprehensive player data with varied roles and details
            players = [
                // ทีมสิงห์ทอง (Team 1)
                { id: 1, name: 'สมชาย ใจดี', jersey: 10, teamId: 1, phone: '081-234-5678', photo: null, birthdate: '1995-03-15', isManager: true, createdAt: new Date('2024-01-10') },
                { id: 2, name: 'สมศักดิ์ วิ่งเร็ว', jersey: 7, teamId: 1, phone: '082-345-6789', photo: null, birthdate: '1998-07-22', isManager: false, createdAt: new Date('2024-01-11') },
                { id: 3, name: 'ประเสริฐ ยิงแรง', jersey: 9, teamId: 1, phone: '083-111-2222', photo: null, birthdate: '1997-05-10', isManager: false, createdAt: new Date('2024-01-12') },
                { id: 4, name: 'วีระ ป้องกันแกร่ง', jersey: 4, teamId: 1, phone: '084-333-4444', photo: null, birthdate: '1996-12-08', isManager: false, createdAt: new Date('2024-01-13') },
                
                // ทีมเสือน้ำเงิน (Team 2)
                { id: 5, name: 'วิชัย ยิงแม่น', jersey: 9, teamId: 2, phone: '083-456-7890', photo: null, birthdate: '1996-11-08', isManager: true, createdAt: new Date('2024-01-14') },
                { id: 6, name: 'ประยุทธ์ ป้องกันดี', jersey: 4, teamId: 2, phone: '084-567-8901', photo: null, birthdate: '1997-01-30', isManager: false, createdAt: new Date('2024-01-15') },
                { id: 7, name: 'สุรชัย ส่งบอลเก่ง', jersey: 8, teamId: 2, phone: '085-555-6666', photo: null, birthdate: '1995-09-18', isManager: false, createdAt: new Date('2024-01-16') },
                { id: 8, name: 'ธีรพงษ์ เซฟดี', jersey: 1, teamId: 2, phone: '086-777-8888', photo: null, birthdate: '1994-04-25', isManager: false, createdAt: new Date('2024-01-17') },
                
                // ทีมมังกรแดง (Team 3)
                { id: 9, name: 'อนุชา เซฟเก่ง', jersey: 1, teamId: 3, phone: '085-678-9012', photo: null, birthdate: '1994-09-12', isManager: true, createdAt: new Date('2024-01-18') },
                { id: 10, name: 'ธนากร ส่งบอลดี', jersey: 8, teamId: 3, phone: '086-789-0123', photo: null, birthdate: '1999-05-18', isManager: false, createdAt: new Date('2024-01-19') },
                { id: 11, name: 'สมพงษ์ ยิงไกล', jersey: 11, teamId: 3, phone: '087-999-0000', photo: null, birthdate: '1993-08-14', isManager: false, createdAt: new Date('2024-01-20') },
                { id: 12, name: 'วิทยา ตัดบอลเก่ง', jersey: 6, teamId: 3, phone: '088-111-3333', photo: null, birthdate: '1998-02-28', isManager: false, createdAt: new Date('2024-01-21') },
                
                // ทีมนกอินทรี (Team 4)
                { id: 13, name: 'รัชพล วิ่งไม่เหนื่อย', jersey: 6, teamId: 4, phone: '087-890-1234', photo: null, birthdate: '1993-12-03', isManager: false, createdAt: new Date('2024-01-22') },
                { id: 14, name: 'กิตติ์ ยิงไกล', jersey: 11, teamId: 4, phone: '088-901-2345', photo: null, birthdate: '1996-04-25', isManager: true, createdAt: new Date('2024-01-23') },
                { id: 15, name: 'ชัยวัฒน์ ครองประตู', jersey: 1, teamId: 4, phone: '089-222-4444', photo: null, birthdate: '1995-11-12', isManager: false, createdAt: new Date('2024-01-24') },
                { id: 16, name: 'อดิศักดิ์ ผ่านบอลแม่น', jersey: 10, teamId: 4, phone: '090-333-5555', photo: null, birthdate: '1997-06-30', isManager: false, createdAt: new Date('2024-01-25') },
                
                // ทีมช้างขาว (Team 5)
                { id: 17, name: 'สุทธิพงษ์ หัวหน้าทีม', jersey: 5, teamId: 5, phone: '091-444-6666', photo: null, birthdate: '1992-10-15', isManager: true, createdAt: new Date('2024-01-26') },
                { id: 18, name: 'ณัฐพล ดาวซัลโว', jersey: 9, teamId: 5, phone: '092-555-7777', photo: null, birthdate: '1996-03-22', isManager: false, createdAt: new Date('2024-01-27') },
                { id: 19, name: 'ปิยะ ประตูเหล็ก', jersey: 1, teamId: 5, phone: '093-666-8888', photo: null, birthdate: '1994-07-08', isManager: false, createdAt: new Date('2024-01-28') },
                { id: 20, name: 'วรากร วิ่งปีก', jersey: 7, teamId: 5, phone: '094-777-9999', photo: null, birthdate: '1998-12-01', isManager: false, createdAt: new Date('2024-01-29') },
                
                // ทีมหมาป่า (Team 6)
                { id: 21, name: 'ธนพล ผู้จัดการ', jersey: 2, teamId: 6, phone: '095-888-0000', photo: null, birthdate: '1991-01-20', isManager: true, createdAt: new Date('2024-01-30') },
                { id: 22, name: 'สิทธิชัย นักสู้', jersey: 3, teamId: 6, phone: '096-999-1111', photo: null, birthdate: '1997-09-05', isManager: false, createdAt: new Date('2024-01-31') },
                { id: 23, name: 'ชาญชัย ตัวรุก', jersey: 10, teamId: 6, phone: '097-000-2222', photo: null, birthdate: '1995-04-18', isManager: false, createdAt: new Date('2024-02-01') },
                { id: 24, name: 'อภิชาติ ผู้รักษาประตู', jersey: 1, teamId: 6, phone: '098-111-3333', photo: null, birthdate: '1993-08-27', isManager: false, createdAt: new Date('2024-02-02') },
                
                // ทีมเสือดาว (Team 7)
                { id: 25, name: 'ธีรศักดิ์ กัปตัน', jersey: 4, teamId: 7, phone: '099-222-4444', photo: null, birthdate: '1990-05-12', isManager: true, createdAt: new Date('2024-02-03') },
                { id: 26, name: 'พิพัฒน์ เครื่องยิง', jersey: 9, teamId: 7, phone: '080-333-5555', photo: null, birthdate: '1996-11-30', isManager: false, createdAt: new Date('2024-02-04') },
                { id: 27, name: 'ศุภชัย กองหลัง', jersey: 5, teamId: 7, phone: '081-444-6666', photo: null, birthdate: '1994-02-14', isManager: false, createdAt: new Date('2024-02-05') },
                
                // ทีมนกเงือก (Team 8)
                { id: 28, name: 'วิษณุ หัวหน้า', jersey: 6, teamId: 8, phone: '082-555-7777', photo: null, birthdate: '1989-12-25', isManager: true, createdAt: new Date('2024-02-06') },
                { id: 29, name: 'ภาคิน ดาวรุ่ง', jersey: 11, teamId: 8, phone: '083-666-8888', photo: null, birthdate: '1999-07-16', isManager: false, createdAt: new Date('2024-02-07') },
                { id: 30, name: 'อรรถพล มือทอง', jersey: 1, teamId: 8, phone: '084-777-9999', photo: null, birthdate: '1992-03-09', isManager: false, createdAt: new Date('2024-02-08') }
            ];

            // Extensive match data covering multiple months
            const dates = [
                // January 2024
                '2024-01-15', '2024-01-18', '2024-01-22', '2024-01-25', '2024-01-28',
                // February 2024
                '2024-02-01', '2024-02-05', '2024-02-08', '2024-02-12', '2024-02-15', '2024-02-18', '2024-02-22', '2024-02-25', '2024-02-28',
                // March 2024
                '2024-03-03', '2024-03-07', '2024-03-10', '2024-03-14', '2024-03-17', '2024-03-21', '2024-03-24', '2024-03-28', '2024-03-31',
                // April 2024
                '2024-04-04', '2024-04-07', '2024-04-11', '2024-04-14', '2024-04-18', '2024-04-21', '2024-04-25', '2024-04-28',
                // Recent matches (this week)
                '2024-12-16', '2024-12-17', '2024-12-18'
            ];

            matches = [
                // Round 1
                { id: 1, teamA: 1, teamB: 2, scoreA: 3, scoreB: 1, date: dates[0], createdAt: new Date('2024-01-15') },
                { id: 2, teamA: 3, teamB: 4, scoreA: 2, scoreB: 2, date: dates[1], createdAt: new Date('2024-01-18') },
                { id: 3, teamA: 5, teamB: 6, scoreA: 1, scoreB: 4, date: dates[2], createdAt: new Date('2024-01-22') },
                { id: 4, teamA: 7, teamB: 8, scoreA: 0, scoreB: 1, date: dates[3], createdAt: new Date('2024-01-25') },
                
                // Round 2
                { id: 5, teamA: 1, teamB: 3, scoreA: 2, scoreB: 0, date: dates[4], createdAt: new Date('2024-01-28') },
                { id: 6, teamA: 2, teamB: 4, scoreA: 1, scoreB: 3, date: dates[5], createdAt: new Date('2024-02-01') },
                { id: 7, teamA: 5, teamB: 7, scoreA: 2, scoreB: 2, date: dates[6], createdAt: new Date('2024-02-05') },
                { id: 8, teamA: 6, teamB: 8, scoreA: 3, scoreB: 1, date: dates[7], createdAt: new Date('2024-02-08') },
                
                // Round 3
                { id: 9, teamA: 1, teamB: 4, scoreA: 4, scoreB: 2, date: dates[8], createdAt: new Date('2024-02-12') },
                { id: 10, teamA: 2, teamB: 3, scoreA: 1, scoreB: 1, date: dates[9], createdAt: new Date('2024-02-15') },
                { id: 11, teamA: 5, teamB: 8, scoreA: 0, scoreB: 2, date: dates[10], createdAt: new Date('2024-02-18') },
                { id: 12, teamA: 6, teamB: 7, scoreA: 2, scoreB: 1, date: dates[11], createdAt: new Date('2024-02-22') },
                
                // Round 4
                { id: 13, teamA: 1, teamB: 5, scoreA: 3, scoreB: 0, date: dates[12], createdAt: new Date('2024-02-25') },
                { id: 14, teamA: 2, teamB: 6, scoreA: 2, scoreB: 3, date: dates[13], createdAt: new Date('2024-02-28') },
                { id: 15, teamA: 3, teamB: 7, scoreA: 1, scoreB: 0, date: dates[14], createdAt: new Date('2024-03-03') },
                { id: 16, teamA: 4, teamB: 8, scoreA: 2, scoreB: 2, date: dates[15], createdAt: new Date('2024-03-07') },
                
                // Round 5
                { id: 17, teamA: 1, teamB: 6, scoreA: 1, scoreB: 1, date: dates[16], createdAt: new Date('2024-03-10') },
                { id: 18, teamA: 2, teamB: 7, scoreA: 4, scoreB: 1, date: dates[17], createdAt: new Date('2024-03-14') },
                { id: 19, teamA: 3, teamB: 8, scoreA: 3, scoreB: 2, date: dates[18], createdAt: new Date('2024-03-17') },
                { id: 20, teamA: 4, teamB: 5, scoreA: 0, scoreB: 1, date: dates[19], createdAt: new Date('2024-03-21') },
                
                // Round 6
                { id: 21, teamA: 1, teamB: 7, scoreA: 2, scoreB: 3, date: dates[20], createdAt: new Date('2024-03-24') },
                { id: 22, teamA: 2, teamB: 8, scoreA: 1, scoreB: 0, date: dates[21], createdAt: new Date('2024-03-28') },
                { id: 23, teamA: 3, teamB: 5, scoreA: 2, scoreB: 1, date: dates[22], createdAt: new Date('2024-03-31') },
                { id: 24, teamA: 4, teamB: 6, scoreA: 1, scoreB: 2, date: dates[23], createdAt: new Date('2024-04-04') },
                
                // Round 7
                { id: 25, teamA: 1, teamB: 8, scoreA: 5, scoreB: 0, date: dates[24], createdAt: new Date('2024-04-07') },
                { id: 26, teamA: 2, teamB: 5, scoreA: 2, scoreB: 2, date: dates[25], createdAt: new Date('2024-04-11') },
                { id: 27, teamA: 3, teamB: 6, scoreA: 1, scoreB: 3, date: dates[26], createdAt: new Date('2024-04-14') },
                { id: 28, teamA: 4, teamB: 7, scoreA: 2, scoreB: 1, date: dates[27], createdAt: new Date('2024-04-18') },
                
                // Recent matches (this week)
                { id: 29, teamA: 5, teamB: 1, scoreA: 0, scoreB: 3, date: dates[28], createdAt: new Date('2024-12-16') },
                { id: 30, teamA: 6, teamB: 2, scoreA: 1, scoreB: 4, date: dates[29], createdAt: new Date('2024-12-17') },
                { id: 31, teamA: 7, teamB: 3, scoreA: 2, scoreB: 0, date: dates[30], createdAt: new Date('2024-12-18') }
            ];

            // Comprehensive player records with varied statistics
            playerRecords = [
                // Goals - Multiple players across different matches
                { id: 1, playerId: 1, teamId: 1, type: 'goal', count: 2, date: dates[0], time: '15:30', note: 'ประตูสวยงาม', createdAt: new Date('2024-01-15') },
                { id: 2, playerId: 5, teamId: 2, type: 'goal', count: 1, date: dates[0], time: '15:45', note: null, createdAt: new Date('2024-01-15') },
                { id: 3, playerId: 11, teamId: 3, type: 'goal', count: 2, date: dates[1], time: '16:20', note: 'ดับเบิ้ลแฮตทริก', createdAt: new Date('2024-01-18') },
                { id: 4, playerId: 14, teamId: 4, type: 'goal', count: 2, date: dates[1], time: '16:35', note: 'ประตูเสมอ', createdAt: new Date('2024-01-18') },
                { id: 5, playerId: 22, teamId: 6, type: 'goal', count: 3, date: dates[2], time: '14:15', note: 'แฮตทริก!', createdAt: new Date('2024-01-22') },
                { id: 6, playerId: 29, teamId: 8, type: 'goal', count: 1, date: dates[3], time: '15:50', note: 'ประตูชัยชนะ', createdAt: new Date('2024-01-25') },
                { id: 7, playerId: 3, teamId: 1, type: 'goal', count: 1, date: dates[4], time: '16:10', note: null, createdAt: new Date('2024-01-28') },
                { id: 8, playerId: 1, teamId: 1, type: 'goal', count: 1, date: dates[4], time: '16:25', note: 'ประตูปิดเกม', createdAt: new Date('2024-01-28') },
                { id: 9, playerId: 14, teamId: 4, type: 'goal', count: 2, date: dates[5], time: '15:20', note: 'ดับเบิ้ล', createdAt: new Date('2024-02-01') },
                { id: 10, playerId: 16, teamId: 4, type: 'goal', count: 1, date: dates[5], time: '15:40', note: null, createdAt: new Date('2024-02-01') },
                { id: 11, playerId: 18, teamId: 5, type: 'goal', count: 1, date: dates[6], time: '14:30', note: null, createdAt: new Date('2024-02-05') },
                { id: 12, playerId: 26, teamId: 7, type: 'goal', count: 2, date: dates[6], time: '14:50', note: 'ยิงสวยมาก', createdAt: new Date('2024-02-05') },
                { id: 13, playerId: 23, teamId: 6, type: 'goal', count: 2, date: dates[7], time: '16:00', note: null, createdAt: new Date('2024-02-08') },
                { id: 14, playerId: 29, teamId: 8, type: 'goal', count: 1, date: dates[7], time: '16:15', note: null, createdAt: new Date('2024-02-08') },
                { id: 15, playerId: 1, teamId: 1, type: 'goal', count: 3, date: dates[8], time: '15:10', note: 'แฮตทริกสุดยอด!', createdAt: new Date('2024-02-12') },
                { id: 16, playerId: 16, teamId: 4, type: 'goal', count: 2, date: dates[8], time: '15:30', note: null, createdAt: new Date('2024-02-12') },
                { id: 17, playerId: 18, teamId: 5, type: 'goal', count: 2, date: dates[28], time: '14:20', note: null, createdAt: new Date('2024-12-16') },
                { id: 18, playerId: 1, teamId: 1, type: 'goal', count: 1, date: dates[28], time: '14:45', note: 'ประตูชัยชนะ', createdAt: new Date('2024-12-16') },
                
                // Saves - Goalkeepers
                { id: 19, playerId: 9, teamId: 3, type: 'save', count: 5, date: dates[1], time: '16:20', note: 'เซฟสุดยอด', createdAt: new Date('2024-01-18') },
                { id: 20, playerId: 8, teamId: 2, type: 'save', count: 3, date: dates[0], time: '15:50', note: 'ป้องกันดี', createdAt: new Date('2024-01-15') },
                { id: 21, playerId: 19, teamId: 5, type: 'save', count: 4, date: dates[2], time: '14:30', note: 'เซฟติดต่อกัน', createdAt: new Date('2024-01-22') },
                { id: 22, playerId: 15, teamId: 4, type: 'save', count: 6, date: dates[5], time: '15:10', note: 'เซฟระดับโลก', createdAt: new Date('2024-02-01') },
                { id: 23, playerId: 30, teamId: 8, type: 'save', count: 3, date: dates[7], time: '16:00', note: null, createdAt: new Date('2024-02-08') },
                { id: 24, playerId: 24, teamId: 6, type: 'save', count: 2, date: dates[11], time: '15:20', note: null, createdAt: new Date('2024-02-22') },
                { id: 25, playerId: 9, teamId: 3, type: 'save', count: 4, date: dates[18], time: '16:30', note: 'เซฟสำคัญ', createdAt: new Date('2024-03-17') },
                
                // Yellow Cards
                { id: 26, playerId: 13, teamId: 4, type: 'yellow', count: 1, date: dates[1], time: '16:35', note: 'ฟาวล์หนัก', createdAt: new Date('2024-01-18') },
                { id: 27, playerId: 6, teamId: 2, type: 'yellow', count: 1, date: dates[5], time: '15:55', note: 'ประท้วงผู้ตัดสิน', createdAt: new Date('2024-02-01') },
                { id: 28, playerId: 22, teamId: 6, type: 'yellow', count: 1, date: dates[7], time: '16:20', note: 'เล่นหยาบ', createdAt: new Date('2024-02-08') },
                { id: 29, playerId: 27, teamId: 7, type: 'yellow', count: 1, date: dates[11], time: '15:40', note: 'ดีเลย์เกม', createdAt: new Date('2024-02-22') },
                { id: 30, playerId: 4, teamId: 1, type: 'yellow', count: 1, date: dates[16], time: '14:50', note: null, createdAt: new Date('2024-03-10') },
                { id: 31, playerId: 12, teamId: 3, type: 'yellow', count: 1, date: dates[18], time: '16:40', note: 'ฟาวล์ยุทธวิธี', createdAt: new Date('2024-03-17') },
                { id: 32, playerId: 20, teamId: 5, type: 'yellow', count: 1, date: dates[25], time: '15:30', note: null, createdAt: new Date('2024-04-11') },
                { id: 33, playerId: 13, teamId: 4, type: 'yellow', count: 1, date: dates[27], time: '16:10', note: 'ใบเหลืองที่ 2', createdAt: new Date('2024-04-18') },
                
                // Red Cards
                { id: 34, playerId: 22, teamId: 6, type: 'red', count: 1, date: dates[13], time: '16:45', note: 'ใบเหลือง 2 ใบ', createdAt: new Date('2024-02-28') },
                { id: 35, playerId: 27, teamId: 7, type: 'red', count: 1, date: dates[20], time: '15:20', note: 'ฟาวล์รุนแรง', createdAt: new Date('2024-03-24') },
                { id: 36, playerId: 13, teamId: 4, type: 'red', count: 1, date: dates[27], time: '16:15', note: 'ใบเหลือง 2 ใบ', createdAt: new Date('2024-04-18') },
                
                // More recent records
                { id: 37, playerId: 5, teamId: 2, type: 'goal', count: 2, date: dates[29], time: '15:20', note: 'ดับเบิ้ลสวย', createdAt: new Date('2024-12-17') },
                { id: 38, playerId: 7, teamId: 2, type: 'goal', count: 1, date: dates[29], time: '15:35', note: null, createdAt: new Date('2024-12-17') },
                { id: 39, playerId: 26, teamId: 7, type: 'goal', count: 1, date: dates[30], time: '14:40', note: null, createdAt: new Date('2024-12-18') },
                { id: 40, playerId: 25, teamId: 7, type: 'goal', count: 1, date: dates[30], time: '14:55', note: 'ประตูชัยชนะ', createdAt: new Date('2024-12-18') },
                
                // Additional saves for variety
                { id: 41, playerId: 8, teamId: 2, type: 'save', count: 7, date: dates[29], time: '15:00', note: 'เซฟมากที่สุดในเกม', createdAt: new Date('2024-12-17') },
                { id: 42, playerId: 9, teamId: 3, type: 'save', count: 3, date: dates[30], time: '14:30', note: null, createdAt: new Date('2024-12-18') }
            ];
        }

        // Utility Functions
        function updateCurrentDateTime() {
            const now = new Date();
            document.getElementById('current-date').textContent = now.toLocaleDateString('th-TH');
            document.getElementById('current-time').textContent = now.toLocaleTimeString('th-TH');
        }

        function calculateAge() {
            const birthdate = document.getElementById('player-birthdate').value;
            const ageDisplay = document.getElementById('player-age-display');
            
            if (!birthdate) {
                ageDisplay.textContent = 'อายุจะแสดงเมื่อเลือกวันเกิด';
                ageDisplay.className = 'text-xs text-gray-500 mt-1';
                return;
            }
            
            const today = new Date();
            const birth = new Date(birthdate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            
            ageDisplay.textContent = `อายุ ${age} ปี`;
            ageDisplay.className = 'text-xs text-blue-600 font-medium mt-1';
        }

        function getAge(birthdate) {
            if (!birthdate) return null;
            
            const today = new Date();
            const birth = new Date(birthdate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            
            return age;
        }

        function showMessage(message, type = 'success') {
            const messageElement = document.getElementById(`${type}-message`);
            const textElement = document.getElementById(`${type}-text`);
            textElement.textContent = message;
            messageElement.classList.add('show');
            
            setTimeout(() => {
                messageElement.classList.remove('show');
            }, 3000);
        }

        function showSuccessMessage(message) {
            showMessage(message, 'success');
        }

        function showErrorMessage(message) {
            showMessage(message, 'error');
        }

        // Delete Modal Functions
        function setupDeleteModal() {
            const modal = document.getElementById('delete-modal');
            const cancelBtn = document.getElementById('cancel-delete');
            const confirmBtn = document.getElementById('confirm-delete');
            
            cancelBtn.addEventListener('click', hideDeleteModal);
            confirmBtn.addEventListener('click', executeDelete);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    hideDeleteModal();
                }
            });
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                    hideDeleteModal();
                }
            });
        }

        function showDeleteModal(message, details, callback) {
            const modal = document.getElementById('delete-modal');
            const messageEl = document.getElementById('delete-message');
            const detailsEl = document.getElementById('delete-details');
            
            messageEl.textContent = message;
            detailsEl.innerHTML = details;
            deleteCallback = callback;
            
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function hideDeleteModal() {
            const modal = document.getElementById('delete-modal');
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
            deleteCallback = null;
        }

        function executeDelete() {
            if (deleteCallback) {
                deleteCallback();
                hideDeleteModal();
            }
        }

        function getTeamById(id) {
            return teams.find(team => team.id == id);
        }

        function getColorClass(color) {
            const colorMap = {
                'red': 'bg-red-500',
                'blue': 'bg-blue-500',
                'green': 'bg-green-500',
                'yellow': 'bg-yellow-400',
                'purple': 'bg-purple-500',
                'orange': 'bg-orange-500',
                'pink': 'bg-pink-500',
                'indigo': 'bg-indigo-500',
                'teal': 'bg-teal-500',
                'cyan': 'bg-cyan-500',
                'lime': 'bg-lime-500',
                'rose': 'bg-rose-500',
                'amber': 'bg-amber-500',
                'emerald': 'bg-emerald-500',
                'violet': 'bg-violet-500',
                'fuchsia': 'bg-fuchsia-500',
                'white': 'bg-white border border-gray-300',
                'black': 'bg-black',
                'gray': 'bg-gray-500',
                'slate': 'bg-slate-600',
                'zinc': 'bg-zinc-600',
                'neutral': 'bg-neutral-600',
                'stone': 'bg-stone-600',
                'sky': 'bg-sky-500'
            };
            return colorMap[color] || 'bg-gray-500';
        }

        // Navigation Functions
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Find the clicked nav item and make it active
            const clickedNavItem = Array.from(document.querySelectorAll('.nav-item')).find(item => {
                const onclick = item.getAttribute('onclick');
                return onclick && onclick.includes(sectionId);
            });
            if (clickedNavItem) {
                clickedNavItem.classList.add('active');
            }

            // Update data when switching to certain sections
            if (sectionId === 'leaderboard') {
                updateLeaderboard();
            } else if (sectionId === 'dashboard') {
                updateDashboardStats();
                updateTeamManagersList();
                updateRecentMatches();
            } else if (sectionId === 'team-management') {
                updateTeamsList();
            } else if (sectionId === 'match-record') {
                updateMatchHistory();
            } else if (sectionId === 'player-list') {
                updatePlayerFilters();
                updatePlayersList();
            } else if (sectionId === 'player-records') {
                updateRecordTeamDropdown();
                updateStatsTeamFilter();
                updatePlayerRecordsList();
                updateTopPlayersStats();
            } else if (sectionId === 'next-matches') {
                updateNextMatchDropdowns();
                updateUpcomingMatchesList();
            } else if (sectionId === 'daily-summary') {
                updateDailySummary();
            }
            
            // Update upcoming matches in dashboard when switching sections
            if (sectionId === 'dashboard') {
                updateUpcomingMatchesDashboard();
            }
        }

        // Dashboard Functions
        function updateDashboardStats() {
            document.getElementById('total-teams').textContent = teams.length;
            document.getElementById('total-players').textContent = players.length;
            document.getElementById('total-matches').textContent = matches.length;
            document.getElementById('total-player-records').textContent = playerRecords.length;
            
            updateLeagueLeader();
            updateRecentMatches();
            updateUpcomingMatchesDashboard();
            updateDashboardCharts();
        }

        function updateDashboardCharts() {
            updateGoalsChart();
            updateMatchesThisWeek();
            updateTopTeamsThisMonth();
        }

        function updateGoalsChart() {
            const totalGoals = matches.reduce((sum, match) => sum + match.scoreA + match.scoreB, 0);
            const avgGoalsPerMatch = matches.length > 0 ? (totalGoals / matches.length).toFixed(1) : 0;
            
            // Update goals statistics
            const goalsStatsContainer = document.getElementById('goals-stats');
            if (goalsStatsContainer) {
                goalsStatsContainer.innerHTML = `
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-600">${totalGoals}</div>
                        <div class="text-sm text-gray-600">ประตูรวม</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-blue-600">${avgGoalsPerMatch}</div>
                        <div class="text-sm text-gray-600">เฉลี่ย/แมทช์</div>
                    </div>
                `;
            }
        }

        function updateMatchesThisWeek() {
            const today = new Date();
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            
            const thisWeekMatches = matches.filter(match => {
                const matchDate = new Date(match.date);
                return matchDate >= weekAgo && matchDate <= today;
            });
            
            const container = document.getElementById('matches-this-week');
            if (container) {
                container.textContent = thisWeekMatches.length;
            }
        }

        function updateTopTeamsThisMonth() {
            const today = new Date();
            const monthAgo = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());
            
            const thisMonthMatches = matches.filter(match => {
                const matchDate = new Date(match.date);
                return matchDate >= monthAgo && matchDate <= today;
            });
            
            const teamWins = {};
            thisMonthMatches.forEach(match => {
                if (match.scoreA > match.scoreB) {
                    teamWins[match.teamA] = (teamWins[match.teamA] || 0) + 1;
                } else if (match.scoreB > match.scoreA) {
                    teamWins[match.teamB] = (teamWins[match.teamB] || 0) + 1;
                }
            });
            
            const topTeam = Object.entries(teamWins).sort((a, b) => b[1] - a[1])[0];
            const container = document.getElementById('top-team-month');
            if (container && topTeam) {
                const team = getTeamById(parseInt(topTeam[0]));
                container.textContent = team ? team.name : '-';
            } else if (container) {
                container.textContent = '-';
            }
        }

        function updateLeagueLeader() {
            const teamStats = {};
            
            // Initialize team stats
            teams.forEach(team => {
                teamStats[team.id] = {
                    team: team,
                    points: 0,
                    goalsFor: 0
                };
            });
            
            // Calculate stats from matches
            matches.forEach(match => {
                const teamAStats = teamStats[match.teamA];
                const teamBStats = teamStats[match.teamB];
                
                if (teamAStats && teamBStats) {
                    teamAStats.goalsFor += match.scoreA;
                    teamBStats.goalsFor += match.scoreB;
                    
                    if (match.scoreA > match.scoreB) {
                        teamAStats.points += 3;
                    } else if (match.scoreB > match.scoreA) {
                        teamBStats.points += 3;
                    } else {
                        teamAStats.points += 1;
                        teamBStats.points += 1;
                    }
                }
            });
            
            // Find leader
            const sortedTeams = Object.values(teamStats).sort((a, b) => {
                if (b.points !== a.points) return b.points - a.points;
                return b.goalsFor - a.goalsFor;
            });
            
            const leader = sortedTeams[0];
            document.getElementById('league-leader-name').textContent = leader && leader.team ? leader.team.name : '-';
            document.getElementById('league-leader-points').textContent = leader && leader.team ? `${leader.points} คะแนน` : '0 คะแนน';
        }

        function updateRecentMatches() {
            const container = document.getElementById('recent-matches-list');
            
            if (matches.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-futbol text-4xl mb-4 text-gray-300"></i>
                        <p class="text-lg font-medium mb-2">ยังไม่มีแมทช์</p>
                        <p class="text-sm">เริ่มต้นด้วยการบันทึกผลการแข่งขันแรก</p>
                    </div>
                `;
                return;
            }
            
            const recentMatches = [...matches]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            container.innerHTML = recentMatches.map(match => {
                const teamA = getTeamById(match.teamA);
                const teamB = getTeamById(match.teamB);
                const date = new Date(match.date).toLocaleDateString('th-TH');
                
                let resultClass = 'bg-gray-100';
                let resultText = 'เสมอ';
                
                if (match.scoreA > match.scoreB) {
                    resultClass = 'bg-green-100 border-l-4 border-green-500';
                    resultText = `${teamA.name} ชนะ`;
                } else if (match.scoreB > match.scoreA) {
                    resultClass = 'bg-blue-100 border-l-4 border-blue-500';
                    resultText = `${teamB.name} ชนะ`;
                } else {
                    resultClass = 'bg-yellow-100 border-l-4 border-yellow-500';
                }
                
                const teamALogo = teamA.logo 
                    ? `<img src="${teamA.logo}" alt="${teamA.name}" class="w-8 h-8 rounded-full object-cover">`
                    : `<div class="w-8 h-8 rounded-full ${getColorClass(teamA.primaryColor)} flex items-center justify-center text-white font-bold text-sm">
                        ${teamA.name.charAt(0)}
                       </div>`;
                
                const teamBLogo = teamB.logo 
                    ? `<img src="${teamB.logo}" alt="${teamB.name}" class="w-8 h-8 rounded-full object-cover">`
                    : `<div class="w-8 h-8 rounded-full ${getColorClass(teamB.primaryColor)} flex items-center justify-center text-white font-bold text-sm">
                        ${teamB.name.charAt(0)}
                       </div>`;
                
                return `
                    <div class="flex items-center justify-between p-4 ${resultClass} rounded-lg">
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-2">
                                ${teamALogo}
                                <span class="font-medium">${teamA.name}</span>
                            </div>
                            
                            <div class="text-xl font-bold text-gray-700 px-3">
                                ${match.scoreA} - ${match.scoreB}
                            </div>
                            
                            <div class="flex items-center space-x-2">
                                <span class="font-medium">${teamB.name}</span>
                                ${teamBLogo}
                            </div>
                        </div>
                        
                        <div class="text-right">
                            <div class="text-sm font-medium text-gray-700">${resultText}</div>
                            <div class="text-xs text-gray-500">${date}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Add upcoming matches section to dashboard
        function updateUpcomingMatchesDashboard() {
            // Check if upcoming matches section exists in dashboard
            let upcomingSection = document.getElementById('upcoming-matches-dashboard');
            
            if (!upcomingSection) {
                // Create upcoming matches section in dashboard
                const recentMatchesSection = document.getElementById('recent-matches-list').closest('.glass-effect');
                const upcomingHTML = `
                    <!-- Upcoming Matches -->
                    <div class="glass-effect rounded-xl shadow-lg p-6 mt-8">
                        <h3 class="text-xl font-bold mb-6 flex items-center">
                            <i class="fas fa-calendar-alt mr-3 text-green-500"></i>
                            แมทช์ต่อไป
                        </h3>
                        <div id="upcoming-matches-dashboard">
                            <!-- Upcoming matches will be populated by JavaScript -->
                        </div>
                    </div>
                `;
                recentMatchesSection.insertAdjacentHTML('afterend', upcomingHTML);
                upcomingSection = document.getElementById('upcoming-matches-dashboard');
            }
            
            // Filter upcoming matches (future matches only)
            const now = new Date();
            const upcomingMatches = nextMatches
                .filter(match => {
                    const matchDateTime = new Date(match.date + 'T' + match.time);
                    return matchDateTime > now;
                })
                .sort((a, b) => {
                    const dateA = new Date(a.date + 'T' + a.time);
                    const dateB = new Date(b.date + 'T' + b.time);
                    return dateA - dateB;
                })
                .slice(0, 3); // Show only next 3 matches
            
            if (upcomingMatches.length === 0) {
                upcomingSection.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-calendar-plus text-4xl mb-4 text-gray-300"></i>
                        <p class="text-lg font-medium mb-2">ไม่มีแมทช์ที่กำลังจะมาถึง</p>
                        <p class="text-sm">ไปที่หน้า "แมทช์ต่อไป" เพื่อจัดแมทช์ใหม่</p>
                    </div>
                `;
                return;
            }
            
            // Create compact overview display
            upcomingSection.innerHTML = `
                <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6 border border-green-200">
                    <div class="grid gap-4">
                        ${upcomingMatches.map((match, index) => {
                            const teamA = getTeamById(match.teamA);
                            const teamB = getTeamById(match.teamB);
                            const matchDateTime = new Date(match.date + 'T' + match.time);
                            const formattedDate = matchDateTime.toLocaleDateString('th-TH', { 
                                weekday: 'short', 
                                day: 'numeric', 
                                month: 'short' 
                            });
                            const formattedTime = matchDateTime.toLocaleTimeString('th-TH', { 
                                hour: '2-digit', 
                                minute: '2-digit' 
                            });
                            
                            // Calculate time until match
                            const timeUntil = matchDateTime - now;
                            const daysUntil = Math.floor(timeUntil / (1000 * 60 * 60 * 24));
                            const hoursUntil = Math.floor((timeUntil % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                            
                            let timeUntilText = '';
                            let urgencyColor = 'text-gray-600';
                            
                            if (daysUntil > 3) {
                                timeUntilText = `อีก ${daysUntil} วัน`;
                                urgencyColor = 'text-blue-600';
                            } else if (daysUntil > 1) {
                                timeUntilText = `อีก ${daysUntil} วัน`;
                                urgencyColor = 'text-yellow-600';
                            } else if (daysUntil === 1) {
                                timeUntilText = 'พรุ่งนี้';
                                urgencyColor = 'text-orange-600';
                            } else if (hoursUntil > 0) {
                                timeUntilText = `อีก ${hoursUntil} ชม.`;
                                urgencyColor = 'text-red-600';
                            } else {
                                timeUntilText = 'ใกล้เริ่ม!';
                                urgencyColor = 'text-red-700';
                            }
                            
                            const teamALogo = teamA.logo 
                                ? `<img src="${teamA.logo}" alt="${teamA.name}" class="w-8 h-8 rounded-full object-cover">`
                                : `<div class="w-8 h-8 rounded-full ${getColorClass(teamA.primaryColor)} flex items-center justify-center text-white font-bold text-sm">
                                    ${teamA.name.charAt(0)}
                                   </div>`;
                            
                            const teamBLogo = teamB.logo 
                                ? `<img src="${teamB.logo}" alt="${teamB.name}" class="w-8 h-8 rounded-full object-cover">`
                                : `<div class="w-8 h-8 rounded-full ${getColorClass(teamB.primaryColor)} flex items-center justify-center text-white font-bold text-sm">
                                    ${teamB.name.charAt(0)}
                                   </div>`;
                            
                            return `
                                <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100 hover:shadow-md transition-all">
                                    <div class="flex items-center justify-between">
                                        <!-- Teams -->
                                        <div class="flex items-center space-x-3 flex-1">
                                            <div class="flex items-center space-x-2">
                                                ${teamALogo}
                                                <span class="font-medium text-gray-800">${teamA.name}</span>
                                            </div>
                                            
                                            <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-3 py-1 rounded-full text-sm font-bold">
                                                VS
                                            </div>
                                            
                                            <div class="flex items-center space-x-2">
                                                <span class="font-medium text-gray-800">${teamB.name}</span>
                                                ${teamBLogo}
                                            </div>
                                        </div>
                                        
                                        <!-- Date & Time -->
                                        <div class="text-right ml-4">
                                            <div class="text-sm font-bold text-gray-700">${formattedDate} ${formattedTime}</div>
                                            <div class="text-xs font-bold ${urgencyColor}">${timeUntilText}</div>
                                            ${match.venue ? `<div class="text-xs text-gray-500">📍 ${match.venue}</div>` : ''}
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <!-- Summary footer -->
                    <div class="mt-4 pt-4 border-t border-green-200 flex items-center justify-between text-sm">
                        <div class="flex items-center space-x-4 text-gray-600">
                            <span><i class="fas fa-calendar-check mr-1 text-green-500"></i>แมทช์ต่อไป: <strong>${upcomingMatches.length}</strong> แมทช์</span>
                            ${nextMatches.length > upcomingMatches.length ? `
                                <span><i class="fas fa-clock mr-1 text-blue-500"></i>รวมทั้งหมด: <strong>${nextMatches.length}</strong> แมทช์</span>
                            ` : ''}
                        </div>
                        <a href="#" onclick="showSection('next-matches')" class="text-green-600 hover:text-green-800 font-medium">
                            ดูทั้งหมด <i class="fas fa-arrow-right ml-1"></i>
                        </a>
                    </div>
                </div>
            `;
        }

        // Team Management Functions
        function updateTeamColorPreview() {
            document.querySelectorAll('.team-color-check').forEach(check => {
                check.style.opacity = '0';
            });
            
            const selectedColor = document.querySelector('input[name="team-color"]:checked');
            if (selectedColor) {
                const selectedCheck = selectedColor.parentNode.querySelector('.team-color-check');
                if (selectedCheck) selectedCheck.style.opacity = '1';
            }
        }

        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Check file size (2MB limit)
            if (file.size > 2 * 1024 * 1024) {
                showErrorMessage('ไฟล์โลโก้ต้องมีขนาดไม่เกิน 2MB');
                event.target.value = '';
                return;
            }
            
            // Check file type
            if (!file.type.startsWith('image/')) {
                showErrorMessage('กรุณาเลือกไฟล์รูปภาพเท่านั้น');
                event.target.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
    const img = new Image();
    img.onload = function() {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        
        // กำหนดขนาด Canvas ให้เท่ากับรูปภาพเดิม
        canvas.width = img.width;
        canvas.height = img.height;
        
        // วาดรูปภาพลงใน Canvas
        ctx.drawImage(img, 0, 0);
        
        // *** บีบอัด: ลดคุณภาพเหลือ 70% และแปลงเป็น JPEG ***
        const compressedBase64 = canvas.toDataURL('image/jpeg', 0.7); 
        
        // บันทึก Base64 ที่ถูกบีบอัดแล้วลงใน Global Variable
        // (ผมสันนิษฐานว่าคุณใช้ตัวแปร global สำหรับเก็บโลโก้ชั่วคราว)
        window.tempTeamLogo = compressedBase64; 
        
        // แสดงโลโก้ใน UI (ถ้ามี)
        document.getElementById('team-logo-preview').src = compressedBase64; 
        document.getElementById('team-logo-preview').classList.remove('hidden');
    };
    img.src = e.target.result; // ใช้ Base64 ชั่วคราวเพื่อโหลดรูปภาพ
};
reader.readAsDataURL(file);
        }

        function removeLogo() {
            document.getElementById('team-logo').value = '';
            document.getElementById('logo-preview').innerHTML = '<i class="fas fa-camera text-gray-400 text-xl"></i>';
            document.getElementById('remove-logo').classList.add('hidden');
        }

        function handlePlayerPhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Check file size (2MB limit)
            if (file.size > 2 * 1024 * 1024) {
                showErrorMessage('ไฟล์รูปต้องมีขนาดไม่เกิน 2MB');
                event.target.value = '';
                return;
            }
            
            // Check file type
            if (!file.type.startsWith('image/')) {
                showErrorMessage('กรุณาเลือกไฟล์รูปภาพเท่านั้น');
                event.target.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const photoPreview = document.getElementById('player-photo-preview');
                photoPreview.innerHTML = `<img src="${e.target.result}" alt="Player Photo" class="w-full h-full object-cover rounded-full">`;
                document.getElementById('remove-player-photo').classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }

        function removePlayerPhoto() {
            document.getElementById('player-photo').value = '';
            document.getElementById('player-photo-preview').innerHTML = '<i class="fas fa-user text-gray-400 text-xl"></i>';
            document.getElementById('remove-player-photo').classList.add('hidden');
        }

       function handleTeamSubmit(event) {
    event.preventDefault();
    
    const name = document.getElementById('team-name').value.trim();
    const selectedColor = document.querySelector('input[name="team-color"]:checked')?.value;
    const logoFile = document.getElementById('team-logo').files[0];
    
    if (!name) {
        showErrorMessage('กรุณากรอกชื่อทีม');
        return;
    }
    
    if (!selectedColor) {
        showErrorMessage('กรุณาเลือกสีประจำทีม');
        return;
    }
    
    // Check for duplicate team name (exclude current editing team)
    if (teams.some(team => team.name.toLowerCase() === name.toLowerCase() && team.id !== editingTeam?.id)) {
        showErrorMessage('ชื่อทีมนี้มีอยู่แล้ว กรุณาเลือกชื่ออื่น');
        return;
    }
    
    // A. EDIT EXISTING TEAM (แก้ไขทีมเดิม)
    if (editingTeam) {
        const teamIndex = teams.findIndex(team => team.id === editingTeam.id);
        if (teamIndex !== -1) {
            teams[teamIndex].name = name;
            teams[teamIndex].primaryColor = selectedColor;
            
            // Handle logo if uploaded (with compression)
            if (logoFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);
                        
                        // บีบอัด: ลดคุณภาพเหลือ 70% และแปลงเป็น JPEG
                        const compressedBase64 = canvas.toDataURL('image/jpeg', 0.7); 
                        
                        // บันทึก Base64 ที่บีบอัดแล้ว และจบการแก้ไข
                        teams[teamIndex].logo = compressedBase64; 
                        finishTeamEdit(name);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(logoFile);
            } else {
                // ถ้าไม่มีไฟล์โลโก้ใหม่ถูกเลือก ให้จบการแก้ไข
                finishTeamEdit(name);
            }
        }
    } 
    // B. ADD NEW TEAM (เพิ่มทีมใหม่)
    else {
        const newTeam = {
            id: Date.now(),
            name: name,
            primaryColor: selectedColor,
            logo: null,
            createdAt: new Date()
        };
        
        // Handle logo if uploaded (with compression)
        if (logoFile) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    
                    // บีบอัด: ลดคุณภาพเหลือ 70% และแปลงเป็น JPEG
                    const compressedBase64 = canvas.toDataURL('image/jpeg', 0.7); 
                    
                    newTeam.logo = compressedBase64; 
                    teams.push(newTeam);
                    
                    // เรียกฟังก์ชัน UI 
                    updateTeamsList();
                    updateTeamDropdowns();
                    updatePlayerFilters();
                    clearTeamForm();
                    showSuccessMessage(`เพิ่มทีม "${name}" พร้อมโลโก้สำเร็จ!`);
                    updateDashboardStats();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(logoFile);
            
        } else {
            // Add new team without logo
            teams.push(newTeam);
            saveToDatabase(); 
            updateTeamsList();
            updateTeamDropdowns();
            updatePlayerFilters();
            clearTeamForm();
            showSuccessMessage(`เพิ่มทีม "${name}" สำเร็จ!`);
            updateDashboardStats();
        }
    }
}
        
        function finishTeamEdit(name) {
            saveToDatabase();
            updateTeamsList();
            updateTeamDropdowns();
            updatePlayerFilters();
            updatePlayersList();
            updateTeamManagersList();
            clearTeamForm();
            editingTeam = null;
            showSuccessMessage(`แก้ไขทีม "${name}" สำเร็จ!`);
            updateDashboardStats();
        }

        function editTeam(teamId) {
            const team = getTeamById(teamId);
            if (!team) return;
            
            editingTeam = team;
            
            // Fill form with team data
            document.getElementById('team-name').value = team.name;
            
            // Set color
            const colorRadio = document.querySelector(`input[name="team-color"][value="${team.primaryColor}"]`);
            if (colorRadio) {
                colorRadio.checked = true;
                updateTeamColorPreview();
            }
            
            // Set logo if exists
            if (team.logo) {
                document.getElementById('logo-preview').innerHTML = `<img src="${team.logo}" alt="Team Logo" class="w-full h-full object-cover rounded-lg">`;
                document.getElementById('remove-logo').classList.remove('hidden');
            }
            
            // Change button text
            const submitButton = document.querySelector('#team-management form button[type="submit"]');
            submitButton.innerHTML = '<i class="fas fa-save mr-2"></i>บันทึกการแก้ไข';
            
            // Scroll to form
            document.getElementById('team-management').scrollIntoView({ behavior: 'smooth' });
        }

        function clearTeamForm() {
            document.getElementById('team-name').value = '';
            document.querySelectorAll('input[name="team-color"]').forEach(input => input.checked = false);
            removeLogo();
            updateTeamColorPreview();
            editingTeam = null;
            
            // Reset button text
            const submitButton = document.querySelector('#team-management form button[type="submit"]');
            submitButton.innerHTML = '<i class="fas fa-plus mr-2"></i>เพิ่มทีม';
        }

        function updateTeamsList() {
            const container = document.getElementById('teams-list');
            console.log('🔍 updateTeamsList called, teams:', teams.length);
            
            if (teams.length === 0) {
                console.log('⚠️ No teams found');
                container.innerHTML = `
                    <div class="col-span-full text-center py-8 text-gray-500">
                        <i class="fas fa-users text-4xl mb-4 text-gray-300"></i>
                        <p class="text-lg font-medium">ยังไม่มีทีม</p>
                        <p class="text-sm">เริ่มต้นด้วยการเพิ่มทีมแรก</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = teams.map(team => {
                const playerCount = players.filter(player => player.teamId === team.id).length;
                const matchCount = matches.filter(match => match.teamA === team.id || match.teamB === team.id).length;
                
                const logoDisplay = team.logo 
                    ? `<img src="${team.logo}" alt="${team.name} Logo" class="w-12 h-12 rounded-full object-cover border-2 border-white shadow-md">`
                    : `<div class="w-12 h-12 rounded-full ${getColorClass(team.primaryColor)} flex items-center justify-center text-white font-bold shadow-md">
                        ${team.name.charAt(0)}
                       </div>`;
                
                return `
                    <div class="border border-gray-200 rounded-lg p-4 card-hover transition-all">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                ${logoDisplay}
                                <div>
                                    <h4 class="font-bold text-lg">${team.name}</h4>
                                    <p class="text-sm text-gray-600">${playerCount} สมาชิก • ${matchCount} แมทช์</p>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="editTeam(${team.id})" class="text-blue-600 hover:text-blue-800 p-2" title="แก้ไขทีม">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteTeam(${team.id})" class="text-red-600 hover:text-red-800 p-2" title="ลบทีม">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteTeam(teamId) {
            const team = getTeamById(teamId);
            if (!team) {
                showErrorMessage('ไม่พบข้อมูลทีม');
                return;
            }
            
            const playerCount = players.filter(player => player.teamId === teamId).length;
            const matchCount = matches.filter(match => match.teamA === teamId || match.teamB === teamId).length;
            const recordCount = playerRecords.filter(record => record.teamId === teamId).length;
            
            const message = `คุณต้องการลบทีม "${team.name}" หรือไม่?`;
            
            let details = `
                <div class="space-y-3">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full ${getColorClass(team.primaryColor)} flex items-center justify-center text-white font-bold">
                            ${team.name.charAt(0)}
                        </div>
                        <div>
                            <div class="font-bold text-lg">${team.name}</div>
                            <div class="text-gray-600 text-sm">ทีมที่จะถูกลบ</div>
                        </div>
                    </div>
                    
                    <div class="border-t pt-3 space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">👥 สมาชิกในทีม:</span>
                            <span class="font-bold ${playerCount > 0 ? 'text-orange-600' : 'text-gray-500'}">${playerCount} คน</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">⚽ ประวัติแมทช์:</span>
                            <span class="font-bold ${matchCount > 0 ? 'text-red-600' : 'text-gray-500'}">${matchCount} แมทช์</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">📊 สถิติผู้เล่น:</span>
                            <span class="font-bold ${recordCount > 0 ? 'text-red-600' : 'text-gray-500'}">${recordCount} รายการ</span>
                        </div>
                    </div>
                    
                    ${(playerCount > 0 || matchCount > 0 || recordCount > 0) ? `
                        <div class="bg-red-50 border border-red-200 rounded-lg p-3 mt-3">
                            <div class="flex items-start space-x-2">
                                <i class="fas fa-exclamation-triangle text-red-500 mt-0.5"></i>
                                <div class="text-red-700 text-sm">
                                    <div class="font-bold mb-1">ข้อมูลที่จะถูกลบ:</div>
                                    ${playerCount > 0 ? `<div>• สมาชิก ${playerCount} คนจะถูกย้ายออกจากทีม</div>` : ''}
                                    ${matchCount > 0 ? `<div>• ประวัติแมทช์ ${matchCount} แมทช์จะถูกลบถาวร</div>` : ''}
                                    ${recordCount > 0 ? `<div>• สถิติผู้เล่น ${recordCount} รายการจะถูกลบถาวร</div>` : ''}
                                    <div class="mt-2 font-bold">⚠️ การลบจะไม่สามารถกู้คืนได้</div>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            showDeleteModal(message, details, () => {
                // Execute delete
                players.forEach(player => {
                    if (player.teamId === teamId) {
                        player.teamId = null;
                    }
                });
                
                matches = matches.filter(match => match.teamA !== teamId && match.teamB !== teamId);
                playerRecords = playerRecords.filter(record => record.teamId !== teamId);
                teams = teams.filter(t => t.id !== teamId);
                
                saveToDatabase();
                
                // Update all related UI
                updateTeamsList();
                updateTeamDropdowns();
                updatePlayersList();
                updateLeaderboard();
                updateMatchHistory();
                updatePlayerRecordsList();
                updateTopPlayersStats();
                updateDashboardStats();
                
                showSuccessMessage(`ลบทีม "${team.name}" และข้อมูลที่เกี่ยวข้องสำเร็จ!`);
            });
        }

        function updateTeamDropdowns() {
            const teamASelect = document.getElementById('team-a');
            const teamBSelect = document.getElementById('team-b');
            const playerTeamSelect = document.getElementById('player-team');
            
            // Clear existing options except the first one
            [teamASelect, teamBSelect, playerTeamSelect].forEach(select => {
                while (select.children.length > 1) {
                    select.removeChild(select.lastChild);
                }
            });
            
            teams.forEach(team => {
                [teamASelect, teamBSelect, playerTeamSelect].forEach(select => {
                    const option = document.createElement('option');
                    option.value = team.id;
                    option.textContent = team.name;
                    select.appendChild(option);
                });
            });
        }

      // Player Management Functions
function handlePlayerSubmit(event) {
    event.preventDefault();
    
    const name = document.getElementById('player-name').value.trim();
    const birthdate = document.getElementById('player-birthdate').value;
    const jersey = document.getElementById('player-jersey').value;
    const teamId = document.getElementById('player-team').value;
    const phone = document.getElementById('player-phone').value.trim();
    const isManager = document.getElementById('is-team-manager').checked;
    const photoFile = document.getElementById('player-photo').files[0];
    
    if (!name) {
        showErrorMessage('กรุณากรอกชื่อผู้เล่น');
        return;
    }
    
    // Check for duplicate jersey number in the same team (exclude current editing player)
    if (jersey && teamId) {
        const duplicateJersey = players.find(player => 
            player.teamId == teamId && 
            player.jersey == jersey &&
            player.id !== editingPlayer?.id
        );
        if (duplicateJersey) {
            showErrorMessage(`เบอร์เสื้อ ${jersey} มีผู้ใช้แล้วในทีมนี้`);
            return;
        }
    }
    
    // ----------------------------------------------------------------
    // A. EDIT EXISTING PLAYER (แก้ไขผู้เล่นเดิม)
    // ----------------------------------------------------------------
    if (editingPlayer) {
        const playerIndex = players.findIndex(player => player.id === editingPlayer.id);
        if (playerIndex !== -1) {
            // อัปเดตข้อมูลพื้นฐาน
            players[playerIndex].name = name;
            players[playerIndex].birthdate = birthdate || null;
            players[playerIndex].jersey = jersey ? parseInt(jersey) : null;
            players[playerIndex].teamId = teamId ? parseInt(teamId) : null;
            players[playerIndex].phone = phone || null;
            players[playerIndex].isManager = isManager;
            
            // *** START OF ASYNCHRONOUS COMPRESSION AND SAVE (Edit) ***
            if (photoFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);
                        
                        const compressedBase64 = canvas.toDataURL('image/jpeg', 0.7); 
                        
                        players[playerIndex].photo = compressedBase64; 
                        
                        // *** บันทึกและจบการแก้ไข (ภายใน img.onload) ***
                        saveToDatabase(); 
                        finishPlayerEdit(name);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(photoFile);
            } else {
                // ถ้าไม่มีไฟล์ใหม่ถูกเลือก (บันทึกข้อมูลพื้นฐาน Synchronous)
                saveToDatabase(); 
                finishPlayerEdit(name);
            }
            // *** END OF ASYNCHRONOUS COMPRESSION AND SAVE (Edit) ***
        }
    } 
    // ----------------------------------------------------------------
    // B. ADD NEW PLAYER (เพิ่มผู้เล่นใหม่)
    // ----------------------------------------------------------------
    else {
        const newPlayer = {
            id: Date.now(),
            name: name,
            birthdate: birthdate || null,
            jersey: jersey ? parseInt(jersey) : null,
            teamId: teamId ? parseInt(teamId) : null,
            phone: phone || null,
            isManager: isManager,
            photo: null,
            createdAt: new Date()
        };
        
        // *** START OF ASYNCHRONOUS COMPRESSION AND SAVE (Add New) ***
        if (photoFile) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    
                    const compressedBase64 = canvas.toDataURL('image/jpeg', 0.7); 
                    
                    newPlayer.photo = compressedBase64; 
                    players.push(newPlayer); // (1) เพิ่มผู้เล่นใหม่
                    
                    // *** บันทึกและอัปเดต UI (ภายใน img.onload) ***
                    saveToDatabase(); 
                    updatePlayersList();
                    updateDashboardStats();
                    updateTeamManagersList();
                    updatePlayerFilters();
                    clearPlayerForm();
                    showSuccessMessage(`เพิ่มผู้เล่น "${name}" พร้อมรูปโปรไฟล์สำเร็จ!`);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(photoFile);
        } else {
            // Add new player without photo (Synchronous save is fine here)
            players.push(newPlayer);
            saveToDatabase();
            updatePlayersList();
            updateDashboardStats();
            updateTeamManagersList();
            updatePlayerFilters();
            clearPlayerForm();
            showSuccessMessage(`เพิ่มผู้เล่น "${name}" สำเร็จ!`);
        }
        // *** END OF ASYNCHRONOUS COMPRESSION AND SAVE (Add New) ***
    }
}
        
        function finishPlayerEdit(name) {
            saveToDatabase();
            updatePlayersList();
            updateDashboardStats();
            clearPlayerForm();
            editingPlayer = null;
            showSuccessMessage(`แก้ไขผู้เล่น "${name}" สำเร็จ!`);
        }

        function editPlayer(playerId) {
            const player = players.find(p => p.id === playerId);
            if (!player) return;
            
            editingPlayer = player;
            
            // Fill form with player data
            document.getElementById('player-name').value = player.name;
            document.getElementById('player-birthdate').value = player.birthdate || '';
            document.getElementById('player-jersey').value = player.jersey || '';
            document.getElementById('player-team').value = player.teamId || '';
            document.getElementById('player-phone').value = player.phone || '';
            document.getElementById('is-team-manager').checked = player.isManager || false;
            
            // Update age display
            calculateAge();
            
            // Set photo if exists
            if (player.photo) {
                document.getElementById('player-photo-preview').innerHTML = `<img src="${player.photo}" alt="Player Photo" class="w-full h-full object-cover rounded-full">`;
                document.getElementById('remove-player-photo').classList.remove('hidden');
            }
            
            // Change button text
            const submitButton = document.querySelector('#player-list form button[type="submit"]');
            submitButton.innerHTML = '<i class="fas fa-save mr-2"></i>บันทึกการแก้ไข';
            
            // Scroll to form
            document.getElementById('player-list').scrollIntoView({ behavior: 'smooth' });
        }

        function clearPlayerForm() {
            document.getElementById('player-name').value = '';
            document.getElementById('player-birthdate').value = '';
            document.getElementById('player-jersey').value = '';
            document.getElementById('player-team').value = '';
            document.getElementById('player-phone').value = '';
            document.getElementById('is-team-manager').checked = false;
            document.getElementById('player-age-display').textContent = 'อายุจะแสดงเมื่อเลือกวันเกิด';
            document.getElementById('player-age-display').className = 'text-xs text-gray-500 mt-1';
            removePlayerPhoto();
            editingPlayer = null;
            
            // Reset button text
            const submitButton = document.querySelector('#player-list form button[type="submit"]');
            submitButton.innerHTML = '<i class="fas fa-user-plus mr-2"></i>เพิ่มผู้เล่น';
        }

        function updatePlayersList() {
            const container = document.getElementById('players-list');
            console.log('🔍 updatePlayersList called, players:', players.length);
            
            // Get filtered players
            let filteredPlayers = getFilteredPlayers();
            console.log('🔍 Filtered players:', filteredPlayers.length);
            
            if (filteredPlayers.length === 0) {
                const hasFilters = document.getElementById('filter-player-team').value || document.getElementById('filter-player-role').value;
                container.innerHTML = `
                    <div class="col-span-full text-center py-8 text-gray-500">
                        <i class="fas fa-users text-4xl mb-4 text-gray-300"></i>
                        <p class="text-lg font-medium">${hasFilters ? 'ไม่พบผู้เล่นตามเงื่อนไขที่เลือก' : 'ยังไม่มีผู้เล่น'}</p>
                        <p class="text-sm">${hasFilters ? 'ลองเปลี่ยนตัวกรองหรือเพิ่มผู้เล่นใหม่' : 'เริ่มต้นด้วยการเพิ่มผู้เล่นแรก'}</p>
                    </div>
                `;
                return;
            }
            
            // Sort players by team name, then by name
            filteredPlayers.sort((a, b) => {
                const teamA = getTeamById(a.teamId);
                const teamB = getTeamById(b.teamId);
                
                // Players without team go to the end
                if (!a.teamId && b.teamId) return 1;
                if (a.teamId && !b.teamId) return -1;
                if (!a.teamId && !b.teamId) return a.name.localeCompare(b.name, 'th');
                
                // Sort by team name first, then by player name
                const teamComparison = teamA.name.localeCompare(teamB.name, 'th');
                if (teamComparison !== 0) return teamComparison;
                return a.name.localeCompare(b.name, 'th');
            });
            
            // Create player cards with centered large avatar
            const html = filteredPlayers.map(player => {
                const team = getTeamById(player.teamId);
                const age = getAge(player.birthdate);
                
                const playerAvatar = player.photo 
                    ? `<img src="${player.photo}" alt="${player.name}" class="w-20 h-20 rounded-full object-cover border-4 border-white shadow-lg">`
                    : `<div class="w-20 h-20 rounded-full ${team ? getColorClass(team.primaryColor) : 'bg-gray-500'} flex items-center justify-center text-white font-bold text-2xl shadow-lg border-4 border-white">
                        ${player.name.charAt(0)}
                       </div>`;
                
                return `
                    <div class="bg-white rounded-xl shadow-md border border-gray-200 p-6 card-hover transition-all hover:shadow-lg cursor-pointer relative" onclick="togglePlayerActions(${player.id})">
                        <!-- Team Color Strip -->
                        <div class="absolute top-0 left-0 right-0 h-2 ${team ? getColorClass(team.primaryColor) : 'bg-gray-400'} rounded-t-xl"></div>
                        
                        <!-- Player Avatar - Centered at Top -->
                        <div class="flex justify-center mb-4 mt-2">
                            <div class="relative">
                                ${playerAvatar}
                                ${player.isManager ? `
                                    <div class="absolute -top-2 -right-2 w-8 h-8 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-full flex items-center justify-center shadow-lg border-2 border-white">
                                        <i class="fas fa-crown text-white text-sm"></i>
                                    </div>
                                ` : ''}
                                ${player.jersey ? `
                                    <div class="absolute -bottom-2 -right-2 w-8 h-8 ${team ? getColorClass(team.primaryColor) : 'bg-gray-500'} rounded-full flex items-center justify-center text-white font-bold text-sm shadow-lg border-2 border-white">
                                        ${player.jersey}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- Player Info - Centered -->
                        <div class="text-center">
                            <h4 class="text-xl font-bold text-gray-800 mb-2">${player.name}</h4>
                            
                            <!-- Team and Age Info -->
                            <div class="flex items-center justify-center space-x-3 text-sm text-gray-600 mb-3">
                                <span class="flex items-center">
                                    <i class="fas fa-users mr-1 text-xs"></i>
                                    ${team ? team.name : 'ไม่มีทีม'}
                                </span>
                                ${age ? `
                                    <span class="flex items-center">
                                        <i class="fas fa-birthday-cake mr-1 text-xs"></i>
                                        ${age} ปี
                                    </span>
                                ` : ''}
                            </div>
                            
                            <!-- Status Badges -->
                            <div class="flex flex-col items-center space-y-2 mb-4">
                                ${player.isManager ? `
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gradient-to-r from-yellow-100 to-yellow-200 text-yellow-800 border border-yellow-300">
                                        <i class="fas fa-crown mr-2"></i>
                                        ผู้จัดการทีม
                                    </span>
                                ` : `
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gradient-to-r from-blue-100 to-blue-200 text-blue-800 border border-blue-300">
                                        <i class="fas fa-running mr-2"></i>
                                        นักกีฬา
                                    </span>
                                `}
                                
                                ${player.phone ? `
                                    <a href="tel:${player.phone}" class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800 hover:bg-green-200 transition-colors" onclick="event.stopPropagation()">
                                        <i class="fas fa-phone mr-2"></i>
                                        ${player.phone}
                                    </a>
                                ` : ''}
                            </div>
                            
                            <!-- Action Buttons (Hidden by default) -->
                            <div id="player-actions-${player.id}" class="hidden pt-4 border-t border-gray-200">
                                <div class="flex space-x-3">
                                    <button onclick="editPlayer(${player.id}); event.stopPropagation();" class="flex-1 flex items-center justify-center py-2 px-4 bg-blue-100 hover:bg-blue-200 text-blue-600 rounded-lg transition-colors font-medium text-sm" title="แก้ไขผู้เล่น">
                                        <i class="fas fa-edit mr-2"></i>
                                        แก้ไข
                                    </button>
                                    <button onclick="deletePlayer(${player.id}); event.stopPropagation();" class="flex-1 flex items-center justify-center py-2 px-4 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg transition-colors font-medium text-sm" title="ลบผู้เล่น">
                                        <i class="fas fa-trash mr-2"></i>
                                        ลบ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
        }

        function deletePlayer(playerId) {
            const player = players.find(p => p.id === playerId);
            if (!player) {
                showErrorMessage('ไม่พบข้อมูลผู้เล่น');
                return;
            }
            
            const team = getTeamById(player.teamId);
            const recordCount = playerRecords.filter(record => record.playerId === playerId).length;
            
            const message = `คุณต้องการลบผู้เล่น "${player.name}" หรือไม่?`;
            
            const playerAvatar = player.photo 
                ? `<img src="${player.photo}" alt="${player.name}" class="w-12 h-12 rounded-full object-cover border-2 border-white shadow-md">`
                : `<div class="w-12 h-12 rounded-full ${team ? getColorClass(team.primaryColor) : 'bg-gray-500'} flex items-center justify-center text-white font-bold shadow-md">
                    ${player.name.charAt(0)}
                   </div>`;
            
            let details = `
                <div class="space-y-3">
                    <div class="flex items-center space-x-3">
                        ${playerAvatar}
                        <div>
                            <div class="font-bold text-lg">${player.name}</div>
                            <div class="text-gray-600 text-sm">ผู้เล่นที่จะถูกลบ</div>
                        </div>
                    </div>
                    
                    <div class="border-t pt-3 space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">⚽ ทีม:</span>
                            <span class="font-bold">${team ? team.name : 'ไม่มีทีม'}</span>
                        </div>
                        ${player.jersey ? `
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">👕 เบอร์เสื้อ:</span>
                                <span class="font-bold text-blue-600">#${player.jersey}</span>
                            </div>
                        ` : ''}
                        ${player.phone ? `
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">📱 เบอร์โทร:</span>
                                <span class="font-bold">${player.phone}</span>
                            </div>
                        ` : ''}
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">📊 สถิติ:</span>
                            <span class="font-bold ${recordCount > 0 ? 'text-red-600' : 'text-gray-500'}">${recordCount} รายการ</span>
                        </div>
                    </div>
                    
                    ${recordCount > 0 ? `
                        <div class="bg-red-50 border border-red-200 rounded-lg p-3 mt-3">
                            <div class="flex items-start space-x-2">
                                <i class="fas fa-exclamation-triangle text-red-500 mt-0.5"></i>
                                <div class="text-red-700 text-sm">
                                    <div class="font-bold mb-1">ข้อมูลที่จะถูกลบ:</div>
                                    <div>• สถิติผู้เล่น ${recordCount} รายการจะถูกลบถาวร</div>
                                    <div>• อันดับดาวซัลโวและสถิติต่างๆ จะถูกอัปเดต</div>
                                    <div class="mt-2 font-bold">⚠️ การลบจะไม่สามารถกู้คืนได้</div>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            showDeleteModal(message, details, () => {
                // Execute delete
                playerRecords = playerRecords.filter(record => record.playerId !== playerId);
                players = players.filter(p => p.id !== playerId);
                
                saveToDatabase();
                
                // Update all related UI
                updatePlayersList();
                updatePlayerRecordsList();
                updateTopPlayersStats();
                updateDashboardStats();
                
                showSuccessMessage(`ลบผู้เล่น "${player.name}" และสถิติที่เกี่ยวข้องสำเร็จ!`);
            });
        }

        function updatePlayerDropdowns() {
            // This function is called when teams are updated
        }

        function getFilteredPlayers() {
            const teamFilter = document.getElementById('filter-player-team')?.value;
            const roleFilter = document.getElementById('filter-player-role')?.value;
            
            let filtered = [...players];
            
            if (teamFilter) {
                filtered = filtered.filter(player => player.teamId == teamFilter);
            }
            
            if (roleFilter) {
                if (roleFilter === 'manager') {
                    filtered = filtered.filter(player => player.isManager);
                } else if (roleFilter === 'player') {
                    filtered = filtered.filter(player => !player.isManager);
                }
            }
            
            return filtered;
        }

        function filterPlayers() {
            updatePlayersList();
            updateTeamBanner();
        }

        function updateTeamBanner() {
            const teamFilter = document.getElementById('filter-player-team')?.value;
            const bannerContainer = document.getElementById('team-banner');
            
            if (!bannerContainer) return;
            
            if (!teamFilter) {
                bannerContainer.classList.add('hidden');
                return;
            }
            
            const selectedTeam = getTeamById(parseInt(teamFilter));
            if (!selectedTeam) {
                bannerContainer.classList.add('hidden');
                return;
            }
            
            // Count players in this team
            const teamPlayers = players.filter(player => player.teamId == teamFilter);
            const managers = teamPlayers.filter(player => player.isManager);
            const regularPlayers = teamPlayers.filter(player => !player.isManager);
            
            // Get team stats
            const teamMatches = matches.filter(match => match.teamA == teamFilter || match.teamB == teamFilter);
            let wins = 0, draws = 0, losses = 0;
            
            teamMatches.forEach(match => {
                if (match.teamA == teamFilter) {
                    if (match.scoreA > match.scoreB) wins++;
                    else if (match.scoreA === match.scoreB) draws++;
                    else losses++;
                } else {
                    if (match.scoreB > match.scoreA) wins++;
                    else if (match.scoreA === match.scoreB) draws++;
                    else losses++;
                }
            });
            
            const points = wins * 3 + draws;
            
            const teamLogo = selectedTeam.logo 
                ? `<img src="${selectedTeam.logo}" alt="${selectedTeam.name}" class="w-20 h-20 rounded-full object-cover border-4 border-white shadow-xl">`
                : `<div class="w-20 h-20 rounded-full ${getColorClass(selectedTeam.primaryColor)} flex items-center justify-center text-white font-bold text-3xl shadow-xl border-4 border-white">
                    ${selectedTeam.name.charAt(0)}
                   </div>`;
            
            // Get team colors and determine text color
            const teamColorClass = getColorClass(selectedTeam.primaryColor);
            const isDarkColor = ['black', 'gray', 'slate', 'zinc', 'neutral', 'stone'].includes(selectedTeam.primaryColor);
            const isLightColor = ['white', 'yellow', 'lime', 'amber'].includes(selectedTeam.primaryColor);
            
            let textColor = 'text-white';
            let subTextColor = 'text-white text-opacity-80';
            let statsBgColor = 'bg-white bg-opacity-20';
            let statsTextColor = 'text-white';
            
            if (isLightColor) {
                textColor = 'text-gray-800';
                subTextColor = 'text-gray-700';
                statsBgColor = 'bg-black bg-opacity-20';
                statsTextColor = 'text-gray-800';
            }
            
            // Create gradient based on team color
            let gradientClass = '';
            switch (selectedTeam.primaryColor) {
                case 'red':
                    gradientClass = 'bg-gradient-to-r from-red-600 via-red-700 to-red-800';
                    break;
                case 'blue':
                    gradientClass = 'bg-gradient-to-r from-blue-600 via-blue-700 to-blue-800';
                    break;
                case 'green':
                    gradientClass = 'bg-gradient-to-r from-green-600 via-green-700 to-green-800';
                    break;
                case 'yellow':
                    gradientClass = 'bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600';
                    break;
                case 'purple':
                    gradientClass = 'bg-gradient-to-r from-purple-600 via-purple-700 to-purple-800';
                    break;
                case 'orange':
                    gradientClass = 'bg-gradient-to-r from-orange-600 via-orange-700 to-orange-800';
                    break;
                case 'pink':
                    gradientClass = 'bg-gradient-to-r from-pink-600 via-pink-700 to-pink-800';
                    break;
                case 'indigo':
                    gradientClass = 'bg-gradient-to-r from-indigo-600 via-indigo-700 to-indigo-800';
                    break;
                case 'teal':
                    gradientClass = 'bg-gradient-to-r from-teal-600 via-teal-700 to-teal-800';
                    break;
                case 'cyan':
                    gradientClass = 'bg-gradient-to-r from-cyan-600 via-cyan-700 to-cyan-800';
                    break;
                case 'lime':
                    gradientClass = 'bg-gradient-to-r from-lime-400 via-lime-500 to-lime-600';
                    break;
                case 'rose':
                    gradientClass = 'bg-gradient-to-r from-rose-600 via-rose-700 to-rose-800';
                    break;
                case 'amber':
                    gradientClass = 'bg-gradient-to-r from-amber-400 via-amber-500 to-amber-600';
                    break;
                case 'emerald':
                    gradientClass = 'bg-gradient-to-r from-emerald-600 via-emerald-700 to-emerald-800';
                    break;
                case 'violet':
                    gradientClass = 'bg-gradient-to-r from-violet-600 via-violet-700 to-violet-800';
                    break;
                case 'fuchsia':
                    gradientClass = 'bg-gradient-to-r from-fuchsia-600 via-fuchsia-700 to-fuchsia-800';
                    break;
                case 'white':
                    gradientClass = 'bg-gradient-to-r from-gray-100 via-white to-gray-100 border-2 border-gray-300';
                    break;
                case 'black':
                    gradientClass = 'bg-gradient-to-r from-gray-900 via-black to-gray-900';
                    break;
                case 'gray':
                    gradientClass = 'bg-gradient-to-r from-gray-600 via-gray-700 to-gray-800';
                    break;
                case 'slate':
                    gradientClass = 'bg-gradient-to-r from-slate-600 via-slate-700 to-slate-800';
                    break;
                case 'zinc':
                    gradientClass = 'bg-gradient-to-r from-zinc-600 via-zinc-700 to-zinc-800';
                    break;
                case 'neutral':
                    gradientClass = 'bg-gradient-to-r from-neutral-600 via-neutral-700 to-neutral-800';
                    break;
                case 'stone':
                    gradientClass = 'bg-gradient-to-r from-stone-600 via-stone-700 to-stone-800';
                    break;
                case 'sky':
                    gradientClass = 'bg-gradient-to-r from-sky-600 via-sky-700 to-sky-800';
                    break;
                default:
                    gradientClass = 'bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-700';
            }

            bannerContainer.innerHTML = `
                <div class="${gradientClass} ${textColor} rounded-2xl p-8 shadow-2xl">
                    <div class="flex items-center justify-between">
                        <!-- Team Info -->
                        <div class="flex items-center space-x-6">
                            ${teamLogo}
                            <div>
                                <h2 class="text-4xl font-bold mb-2 drop-shadow-lg">${selectedTeam.name}</h2>
                                <div class="flex items-center space-x-4 ${subTextColor}">
                                    <span class="flex items-center">
                                        <i class="fas fa-users mr-2"></i>
                                        ${teamPlayers.length} สมาชิก
                                    </span>
                                    <span class="flex items-center">
                                        <i class="fas fa-user-tie mr-2"></i>
                                        ${managers.length} ผู้จัดการ
                                    </span>
                                    <span class="flex items-center">
                                        <i class="fas fa-running mr-2"></i>
                                        ${regularPlayers.length} นักกีฬา
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Team Stats -->
                        <div class="text-right">
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div class="${statsBgColor} rounded-lg p-3 text-center backdrop-blur-sm">
                                    <div class="text-2xl font-bold ${statsTextColor}">${points}</div>
                                    <div class="text-sm ${subTextColor}">คะแนน</div>
                                </div>
                                <div class="${statsBgColor} rounded-lg p-3 text-center backdrop-blur-sm">
                                    <div class="text-2xl font-bold ${statsTextColor}">${teamMatches.length}</div>
                                    <div class="text-sm ${subTextColor}">แมทช์</div>
                                </div>
                            </div>
                            <div class="flex space-x-2 justify-end">
                                <div class="bg-green-500 bg-opacity-90 rounded-lg px-3 py-1 text-sm font-bold text-white shadow-md">
                                    ชนะ ${wins}
                                </div>
                                <div class="bg-yellow-500 bg-opacity-90 rounded-lg px-3 py-1 text-sm font-bold text-white shadow-md">
                                    เสมอ ${draws}
                                </div>
                                <div class="bg-red-500 bg-opacity-90 rounded-lg px-3 py-1 text-sm font-bold text-white shadow-md">
                                    แพ้ ${losses}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            bannerContainer.classList.remove('hidden');
        }

        function updatePlayerFilters() {
            const teamFilter = document.getElementById('filter-player-team');
            if (!teamFilter) return;
            
            // Clear existing options except the first one
            while (teamFilter.children.length > 1) {
                teamFilter.removeChild(teamFilter.lastChild);
            }
            
            teams.forEach(team => {
                const option = document.createElement('option');
                option.value = team.id;
                option.textContent = team.name;
                teamFilter.appendChild(option);
            });
        }

        function updateTeamManagersList() {
            const container = document.getElementById('team-managers-list');
            if (!container) return;
            
            const managers = players.filter(player => player.isManager && player.teamId);
            
            if (managers.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-8 text-gray-500">
                        <i class="fas fa-user-tie text-4xl mb-4 text-gray-300"></i>
                        <p class="text-lg font-medium">ยังไม่มีผู้จัดการทีม</p>
                        <p class="text-sm">เพิ่มผู้เล่นและกำหนดเป็นผู้จัดการทีม</p>
                    </div>
                `;
                return;
            }
            
            // Group managers by team
            const managersByTeam = {};
            managers.forEach(manager => {
                const team = getTeamById(manager.teamId);
                if (team) {
                    if (!managersByTeam[team.id]) {
                        managersByTeam[team.id] = {
                            team: team,
                            managers: []
                        };
                    }
                    managersByTeam[team.id].managers.push(manager);
                }
            });
            
            container.innerHTML = Object.values(managersByTeam).map(teamData => {
                const team = teamData.team;
                const teamManagers = teamData.managers;
                
                return `
                    <div class="border border-gray-200 rounded-lg p-4 card-hover transition-all">
                        <div class="flex items-center space-x-3 mb-3">
                            ${team.logo 
                                ? `<img src="${team.logo}" alt="${team.name}" class="w-10 h-10 rounded-full object-cover">`
                                : `<div class="w-10 h-10 rounded-full ${getColorClass(team.primaryColor)} flex items-center justify-center text-white font-bold text-sm">
                                    ${team.name.charAt(0)}
                                   </div>`
                            }
                            <div>
                                <h4 class="font-bold text-lg">${team.name}</h4>
                                <p class="text-sm text-gray-600">${teamManagers.length} ผู้จัดการ</p>
                            </div>
                        </div>
                        
                        <div class="space-y-2">
                            ${teamManagers.map(manager => `
                                <div class="flex items-center justify-between bg-purple-50 rounded-lg p-2">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-user-tie text-purple-600"></i>
                                        <span class="font-medium">${manager.name}</span>
                                    </div>
                                    ${manager.phone ? `
                                        <a href="tel:${manager.phone}" class="text-blue-600 hover:text-blue-800 text-sm">
                                            <i class="fas fa-phone mr-1"></i>
                                            ${manager.phone}
                                        </a>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }



        // Daily Summary Functions
        function updateDailySummary() {
            const selectedDate = document.getElementById('summary-date').value;
            if (!selectedDate) return;
            
            const dailyMatches = matches.filter(match => match.date === selectedDate);
            const dailyRecords = playerRecords.filter(record => record.date === selectedDate);
            const totalGoals = dailyMatches.reduce((sum, match) => sum + match.scoreA + match.scoreB, 0);
            const teamsPlayed = new Set();
            
            dailyMatches.forEach(match => {
                teamsPlayed.add(match.teamA);
                teamsPlayed.add(match.teamB);
            });
            
            document.getElementById('daily-matches').textContent = dailyMatches.length;
            document.getElementById('daily-goals').textContent = totalGoals;
            document.getElementById('daily-teams').textContent = teamsPlayed.size;
            
            updateDailyMatchesList(dailyMatches);
            updateDailyPlayerRecords(dailyRecords);
        }

        function updateDailyMatchesList(dailyMatches) {
            const container = document.getElementById('daily-matches-list');
            
            if (dailyMatches.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">ไม่มีแมทช์ในวันที่เลือก</div>';
                return;
            }
            
            // Calculate summary stats
            const totalGoals = dailyMatches.reduce((sum, match) => sum + match.scoreA + match.scoreB, 0);
            const wins = dailyMatches.filter(match => match.scoreA !== match.scoreB).length;
            const draws = dailyMatches.filter(match => match.scoreA === match.scoreB).length;
            const avgGoals = (totalGoals / dailyMatches.length).toFixed(1);
            
            // Create overview layout
            container.innerHTML = `
                <!-- Header Summary -->
                <div class="bg-gradient-to-r from-indigo-600 to-purple-700 text-white rounded-xl p-6 mb-6 shadow-xl">
                    <div class="text-center mb-4">
                        <h3 class="text-2xl font-bold mb-2">📊 สรุปแมทช์ประจำวัน</h3>
                        <p class="text-indigo-100">${new Date(dailyMatches[0].date).toLocaleDateString('th-TH')}</p>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold">${dailyMatches.length}</div>
                            <div class="text-sm text-indigo-100">แมทช์ทั้งหมด</div>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold">${totalGoals}</div>
                            <div class="text-sm text-indigo-100">ประตูรวม</div>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold">${avgGoals}</div>
                            <div class="text-sm text-indigo-100">เฉลี่ย/แมทช์</div>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold">${wins}/${draws}</div>
                            <div class="text-sm text-indigo-100">ชนะ/เสมอ</div>
                        </div>
                    </div>
                </div>
                
                <!-- Matches Overview Table -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ทีมเจ้าบ้าน</th>
                                    <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ผลการแข่งขัน</th>
                                    <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ทีมเยือน</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-100">
                                ${dailyMatches.map((match, index) => {
                                    const teamA = getTeamById(match.teamA);
                                    const teamB = getTeamById(match.teamB);
                                    
                                    let rowClass = '';
                                    
                                    if (match.scoreA > match.scoreB) {
                                        rowClass = 'bg-green-50 hover:bg-green-100';
                                    } else if (match.scoreB > match.scoreA) {
                                        rowClass = 'bg-blue-50 hover:bg-blue-100';
                                    } else {
                                        rowClass = 'bg-yellow-50 hover:bg-yellow-100';
                                    }
                                    
                                    const teamALogo = teamA.logo 
                                        ? `<img src="${teamA.logo}" alt="${teamA.name}" class="w-10 h-10 rounded-full object-cover border-2 border-white shadow-sm">`
                                        : `<div class="w-10 h-10 rounded-full ${getColorClass(teamA.primaryColor)} flex items-center justify-center text-white font-bold text-lg border-2 border-white shadow-sm">
                                            ${teamA.name.charAt(0)}
                                           </div>`;
                                    
                                    const teamBLogo = teamB.logo 
                                        ? `<img src="${teamB.logo}" alt="${teamB.name}" class="w-10 h-10 rounded-full object-cover border-2 border-white shadow-sm">`
                                        : `<div class="w-10 h-10 rounded-full ${getColorClass(teamB.primaryColor)} flex items-center justify-center text-white font-bold text-lg border-2 border-white shadow-sm">
                                            ${teamB.name.charAt(0)}
                                           </div>`;
                                    
                                    return `
                                        <tr class="${rowClass} transition-colors">
                                            <td class="px-4 py-3 whitespace-nowrap text-center">
                                                <div class="flex items-center justify-center space-x-3">
                                                    ${teamALogo}
                                                    <div>
                                                        <div class="text-base font-bold text-gray-900">${teamA.name}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            
                                            <td class="px-4 py-3 whitespace-nowrap text-center">
                                                <div class="bg-white rounded-lg px-4 py-2 shadow-md border border-gray-200">
                                                    <span class="text-2xl font-black text-gray-800">${match.scoreA}</span>
                                                    <span class="text-xl font-bold text-gray-400 mx-2">-</span>
                                                    <span class="text-2xl font-black text-gray-800">${match.scoreB}</span>
                                                </div>
                                            </td>
                                            
                                            <td class="px-4 py-3 whitespace-nowrap text-center">
                                                <div class="flex items-center justify-center space-x-3">
                                                    <div>
                                                        <div class="text-base font-bold text-gray-900">${teamB.name}</div>
                                                    </div>
                                                    ${teamBLogo}
                                                </div>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Footer Summary -->
                    <div class="bg-gray-50 px-6 py-4 border-t border-gray-200">
                        <div class="flex items-center justify-between text-sm text-gray-600">
                            <div class="flex items-center space-x-4">
                                <span><i class="fas fa-futbol text-green-500 mr-1"></i>ประตูรวม: <strong>${totalGoals}</strong></span>
                                <span><i class="fas fa-chart-line text-blue-500 mr-1"></i>เฉลี่ย: <strong>${avgGoals}</strong> ประตู/แมทช์</span>
                            </div>
                            <div class="flex items-center space-x-4">
                                <span><i class="fas fa-trophy text-yellow-500 mr-1"></i>มีผู้ชนะ: <strong>${wins}</strong> แมทช์</span>
                                <span><i class="fas fa-handshake text-gray-500 mr-1"></i>เสมอ: <strong>${draws}</strong> แมทช์</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateDailyPlayerRecords(dailyRecords) {
            const container = document.getElementById('daily-player-records');
            
            if (dailyRecords.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">ไม่มีสถิติผู้เล่นในวันที่เลือก</div>';
                return;
            }
            
            // Group records by type
            const recordsByType = {
                goal: [],
                save: [],
                yellow: [],
                red: []
            };
            
            dailyRecords.forEach(record => {
                if (recordsByType[record.type]) {
                    recordsByType[record.type].push(record);
                }
            });
            
            // Sort each type by count (descending)
            Object.keys(recordsByType).forEach(type => {
                recordsByType[type].sort((a, b) => b.count - a.count);
            });
            
            const typeConfig = {
                goal: { 
                    icon: 'fas fa-futbol', 
                    color: 'text-green-600', 
                    bg: 'bg-green-50', 
                    border: 'border-green-200', 
                    name: 'ประตู',
                    emoji: '⚽'
                },
                save: { 
                    icon: 'fas fa-hand-paper', 
                    color: 'text-blue-600', 
                    bg: 'bg-blue-50', 
                    border: 'border-blue-200', 
                    name: 'เซฟ',
                    emoji: '🥅'
                },
                yellow: { 
                    icon: 'fas fa-square', 
                    color: 'text-yellow-600', 
                    bg: 'bg-yellow-50', 
                    border: 'border-yellow-200', 
                    name: 'ใบเหลือง',
                    emoji: '🟨'
                },
                red: { 
                    icon: 'fas fa-square', 
                    color: 'text-red-600', 
                    bg: 'bg-red-50', 
                    border: 'border-red-200', 
                    name: 'ใบแดง',
                    emoji: '🟥'
                }
            };
            
            let html = '';
            
            // Generate sections for each record type
            Object.keys(typeConfig).forEach(type => {
                const records = recordsByType[type];
                if (records.length === 0) return;
                
                const config = typeConfig[type];
                const totalCount = records.reduce((sum, record) => sum + record.count, 0);
                
                html += `
                    <div class="border ${config.border} rounded-lg ${config.bg} p-4 mb-4">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-bold ${config.color} flex items-center">
                                <span class="text-2xl mr-2">${config.emoji}</span>
                                ${config.name}
                            </h4>
                            <div class="text-right">
                                <div class="text-2xl font-bold ${config.color}">${totalCount}</div>
                                <div class="text-xs text-gray-600">รวม</div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                            ${records.map(record => {
                                const player = players.find(p => p.id === record.playerId);
                                const team = getTeamById(record.teamId);
                                
                                if (!player) return '';
                                
                                const playerAvatar = player.photo 
                                    ? `<img src="${player.photo}" alt="${player.name}" class="w-10 h-10 rounded-full object-cover border-2 border-white shadow-md">`
                                    : `<div class="w-10 h-10 rounded-full ${team ? getColorClass(team.primaryColor) : 'bg-gray-500'} flex items-center justify-center text-white font-bold text-sm shadow-md border-2 border-white">
                                        ${player.name.charAt(0)}
                                       </div>`;
                                
                                return `
                                    <div class="bg-white rounded-lg p-3 shadow-sm border border-gray-100 hover:shadow-md transition-all">
                                        <div class="flex items-center space-x-3">
                                            ${playerAvatar}
                                            <div class="flex-1">
                                                <div class="font-bold text-sm text-gray-800">${player.name}</div>
                                                <div class="text-xs text-gray-500">${team ? team.name : 'ไม่มีทีม'}${player.jersey ? ` • #${player.jersey}` : ''}</div>
                                                ${record.time ? `<div class="text-xs text-gray-400">⏰ ${record.time}</div>` : ''}
                                            </div>
                                            <div class="text-right">
                                                <div class="text-xl font-bold ${config.color}">${record.count}</div>
                                                <div class="text-xs text-gray-500">${config.name}</div>
                                            </div>
                                        </div>
                                        ${record.note ? `
                                            <div class="mt-2 p-2 bg-gray-50 rounded text-xs text-gray-600">
                                                <i class="fas fa-sticky-note mr-1"></i>
                                                ${record.note}
                                            </div>
                                        ` : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            });
            
            if (html === '') {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">ไม่มีสถิติผู้เล่นในวันที่เลือก</div>';
            } else {
                // Add summary stats at the top
                const summaryStats = `
                    <div class="bg-gradient-to-r from-purple-100 to-indigo-100 rounded-lg p-4 mb-6 border border-purple-200">
                        <h4 class="font-bold text-purple-800 mb-3 flex items-center">
                            <i class="fas fa-chart-pie mr-2"></i>
                            สรุปสถิติประจำวัน
                        </h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            ${Object.keys(typeConfig).map(type => {
                                const records = recordsByType[type];
                                const totalCount = records.reduce((sum, record) => sum + record.count, 0);
                                const config = typeConfig[type];
                                
                                return `
                                    <div class="text-center bg-white rounded-lg p-3 shadow-sm">
                                        <div class="text-2xl mb-1">${config.emoji}</div>
                                        <div class="text-2xl font-bold ${config.color}">${totalCount}</div>
                                        <div class="text-xs text-gray-600">${config.name}</div>
                                        <div class="text-xs text-gray-500">${records.length} คน</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
                
                container.innerHTML = summaryStats + html;
            }
        }

        function updateDailyMatchesList(dailyMatches) {
            const container = document.getElementById('daily-matches-list');
            
            if (dailyMatches.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">ไม่มีแมทช์ในวันที่เลือก</div>';
                return;
            }
            
            // Calculate summary stats
            const totalGoals = dailyMatches.reduce((sum, match) => sum + match.scoreA + match.scoreB, 0);
            const wins = dailyMatches.filter(match => match.scoreA !== match.scoreB).length;
            const draws = dailyMatches.filter(match => match.scoreA === match.scoreB).length;
            const avgGoals = (totalGoals / dailyMatches.length).toFixed(1);
            
            // Create overview layout
            container.innerHTML = `
                <!-- Header Summary -->
                <div class="bg-gradient-to-r from-indigo-600 to-purple-700 text-white rounded-xl p-6 mb-6 shadow-xl">
                    <div class="text-center mb-4">
                        <h3 class="text-2xl font-bold mb-2">📊 สรุปแมทช์ประจำวัน</h3>
                        <p class="text-indigo-100">${new Date(dailyMatches[0].date).toLocaleDateString('th-TH')}</p>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold">${dailyMatches.length}</div>
                            <div class="text-sm text-indigo-100">แมทช์ทั้งหมด</div>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold">${totalGoals}</div>
                            <div class="text-sm text-indigo-100">ประตูรวม</div>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold">${avgGoals}</div>
                            <div class="text-sm text-indigo-100">เฉลี่ย/แมทช์</div>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center">
                            <div class="text-3xl font-bold">${wins}/${draws}</div>
                            <div class="text-sm text-indigo-100">ชนะ/เสมอ</div>
                        </div>
                    </div>
                </div>
                
                <!-- Matches Overview Table -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ทีมเจ้าบ้าน</th>
                                    <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ผลการแข่งขัน</th>
                                    <th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ทีมเยือน</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-100">
                                ${dailyMatches.map((match, index) => {
                                    const teamA = getTeamById(match.teamA);
                                    const teamB = getTeamById(match.teamB);
                                    
                                    let rowClass = '';
                                    
                                    if (match.scoreA > match.scoreB) {
                                        rowClass = 'bg-green-50 hover:bg-green-100';
                                    } else if (match.scoreB > match.scoreA) {
                                        rowClass = 'bg-blue-50 hover:bg-blue-100';
                                    } else {
                                        rowClass = 'bg-yellow-50 hover:bg-yellow-100';
                                    }
                                    
                                    const teamALogo = teamA.logo 
                                        ? `<img src="${teamA.logo}" alt="${teamA.name}" class="w-10 h-10 rounded-full object-cover border-2 border-white shadow-sm">`
                                        : `<div class="w-10 h-10 rounded-full ${getColorClass(teamA.primaryColor)} flex items-center justify-center text-white font-bold text-lg border-2 border-white shadow-sm">
                                            ${teamA.name.charAt(0)}
                                           </div>`;
                                    
                                    const teamBLogo = teamB.logo 
                                        ? `<img src="${teamB.logo}" alt="${teamB.name}" class="w-10 h-10 rounded-full object-cover border-2 border-white shadow-sm">`
                                        : `<div class="w-10 h-10 rounded-full ${getColorClass(teamB.primaryColor)} flex items-center justify-center text-white font-bold text-lg border-2 border-white shadow-sm">
                                            ${teamB.name.charAt(0)}
                                           </div>`;
                                    
                                    return `
                                        <tr class="${rowClass} transition-colors">
                                            <td class="px-4 py-3 whitespace-nowrap text-center">
                                                <div class="flex items-center justify-center space-x-3">
                                                    ${teamALogo}
                                                    <div>
                                                        <div class="text-base font-bold text-gray-900">${teamA.name}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            
                                            <td class="px-4 py-3 whitespace-nowrap text-center">
                                                <div class="bg-white rounded-lg px-4 py-2 shadow-md border border-gray-200">
                                                    <span class="text-2xl font-black text-gray-800">${match.scoreA}</span>
                                                    <span class="text-xl font-bold text-gray-400 mx-2">-</span>
                                                    <span class="text-2xl font-black text-gray-800">${match.scoreB}</span>
                                                </div>
                                            </td>
                                            
                                            <td class="px-4 py-3 whitespace-nowrap text-center">
                                                <div class="flex items-center justify-center space-x-3">
                                                    <div>
                                                        <div class="text-base font-bold text-gray-900">${teamB.name}</div>
                                                    </div>
                                                    ${teamBLogo}
                                                </div>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Footer Summary -->
                    <div class="bg-gray-50 px-6 py-4 border-t border-gray-200">
                        <div class="flex items-center justify-between text-sm text-gray-600">
                            <div class="flex items-center space-x-4">
                                <span><i class="fas fa-futbol text-green-500 mr-1"></i>ประตูรวม: <strong>${totalGoals}</strong></span>
                                <span><i class="fas fa-chart-line text-blue-500 mr-1"></i>เฉลี่ย: <strong>${avgGoals}</strong> ประตู/แมทช์</span>
                            </div>
                            <div class="flex items-center space-x-4">
                                <span><i class="fas fa-trophy text-yellow-500 mr-1"></i>มีผู้ชนะ: <strong>${wins}</strong> แมทช์</span>
                                <span><i class="fas fa-handshake text-gray-500 mr-1"></i>เสมอ: <strong>${draws}</strong> แมทช์</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Match Management Functions
        function handleMatchSubmit(event) {
            event.preventDefault();
            
            const teamA = document.getElementById('team-a').value;
            const teamB = document.getElementById('team-b').value;
            const scoreA = parseInt(document.getElementById('score-a').value);
            const scoreB = parseInt(document.getElementById('score-b').value);
            const matchDate = document.getElementById('match-date').value;
            
            if (!teamA || !teamB) {
                showErrorMessage('กรุณาเลือกทีมทั้งสอง');
                return;
            }
            
            if (teamA === teamB) {
                showErrorMessage('ไม่สามารถเลือกทีมเดียวกันได้');
                return;
            }
            
            if (!matchDate) {
                showErrorMessage('กรุณาเลือกวันที่แข่งขัน');
                return;
            }
            
            if (editingMatch) {
                // Edit existing match
                const matchIndex = matches.findIndex(match => match.id === editingMatch.id);
                if (matchIndex !== -1) {
                    matches[matchIndex].teamA = parseInt(teamA);
                    matches[matchIndex].teamB = parseInt(teamB);
                    matches[matchIndex].scoreA = scoreA;
                    matches[matchIndex].scoreB = scoreB;
                    matches[matchIndex].date = matchDate;
                    
                    saveToDatabase();
                    updateMatchHistory();
                    updateLeaderboard();
                    updateDashboardStats();
                    clearMatchForm();
                    editingMatch = null;
                    
                    const teamAName = getTeamById(parseInt(teamA)).name;
                    const teamBName = getTeamById(parseInt(teamB)).name;
                    showSuccessMessage(`แก้ไขผลการแข่งขัน ${teamAName} ${scoreA}-${scoreB} ${teamBName} สำเร็จ!`);
                }
            } else {
                // Add new match
                const newMatch = {
                    id: Date.now(),
                    teamA: parseInt(teamA),
                    teamB: parseInt(teamB),
                    scoreA: scoreA,
                    scoreB: scoreB,
                    date: matchDate,
                    createdAt: new Date()
                };
                
                matches.push(newMatch);
                saveToDatabase();
                updateMatchHistory();
                updateLeaderboard();
                updateDashboardStats();
                clearMatchForm();
                
                const teamAName = getTeamById(parseInt(teamA)).name;
                const teamBName = getTeamById(parseInt(teamB)).name;
                showSuccessMessage(`บันทึกผลการแข่งขัน ${teamAName} ${scoreA}-${scoreB} ${teamBName} สำเร็จ!`);
            }
        }

        function editMatch(matchId) {
            const match = matches.find(m => m.id === matchId);
            if (!match) return;
            
            editingMatch = match;
            
            // Fill form with match data
            document.getElementById('team-a').value = match.teamA;
            document.getElementById('team-b').value = match.teamB;
            document.getElementById('score-a').value = match.scoreA;
            document.getElementById('score-b').value = match.scoreB;
            document.getElementById('match-date').value = match.date;
            
            // Change button text
            const submitButton = document.querySelector('#match-record form button[type="submit"]');
            submitButton.innerHTML = '<i class="fas fa-save mr-2"></i>บันทึกการแก้ไข';
            
            // Scroll to form
            document.getElementById('match-record').scrollIntoView({ behavior: 'smooth' });
        }

        function clearMatchForm() {
            document.getElementById('team-a').value = '';
            document.getElementById('team-b').value = '';
            document.getElementById('score-a').value = '';
            document.getElementById('score-b').value = '';
            editingMatch = null;
            
            // Reset button text
            const submitButton = document.querySelector('#match-record form button[type="submit"]');
            submitButton.innerHTML = '<i class="fas fa-save mr-2"></i>บันทึกผลการแข่งขัน';
        }

        function updateMatchHistory() {
            const container = document.getElementById('match-history-list');
            console.log('🔍 updateMatchHistory called, matches:', matches.length);
            
            if (matches.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">ยังไม่มีประวัติการแข่งขัน</div>';
                return;
            }
            
            const sortedMatches = [...matches].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            container.innerHTML = sortedMatches.map(match => {
                const teamA = getTeamById(match.teamA);
                const teamB = getTeamById(match.teamB);
                const date = new Date(match.date).toLocaleDateString('th-TH');
                
                let resultClass = 'bg-gray-100';
                let resultText = 'เสมอ';
                
                if (match.scoreA > match.scoreB) {
                    resultClass = 'bg-green-100 border-l-4 border-green-500';
                    resultText = `${teamA.name} ชนะ`;
                } else if (match.scoreB > match.scoreA) {
                    resultClass = 'bg-blue-100 border-l-4 border-blue-500';
                    resultText = `${teamB.name} ชนะ`;
                } else {
                    resultClass = 'bg-yellow-100 border-l-4 border-yellow-500';
                }
                
                const teamALogo = teamA.logo 
                    ? `<img src="${teamA.logo}" alt="${teamA.name}" class="w-8 h-8 rounded-full object-cover">`
                    : `<div class="w-8 h-8 rounded-full ${getColorClass(teamA.primaryColor)} flex items-center justify-center text-white font-bold text-sm">
                        ${teamA.name.charAt(0)}
                       </div>`;
                
                const teamBLogo = teamB.logo 
                    ? `<img src="${teamB.logo}" alt="${teamB.name}" class="w-8 h-8 rounded-full object-cover">`
                    : `<div class="w-8 h-8 rounded-full ${getColorClass(teamB.primaryColor)} flex items-center justify-center text-white font-bold text-sm">
                        ${teamB.name.charAt(0)}
                       </div>`;
                
                return `
                    <div class="border rounded-lg p-4 ${resultClass}">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <div class="flex items-center space-x-2">
                                    ${teamALogo}
                                    <span class="font-medium">${teamA.name}</span>
                                </div>
                                
                                <div class="text-2xl font-bold text-gray-700 px-3">
                                    ${match.scoreA} - ${match.scoreB}
                                </div>
                                
                                <div class="flex items-center space-x-2">
                                    <span class="font-medium">${teamB.name}</span>
                                    ${teamBLogo}
                                </div>
                            </div>
                            
                            <div class="flex items-center space-x-4">
                                <div class="text-right">
                                    <div class="text-sm font-medium text-gray-700">${resultText}</div>
                                    <div class="text-xs text-gray-500">${date}</div>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="editMatch(${match.id})" class="text-blue-600 hover:text-blue-800 p-2" title="แก้ไข">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="deleteMatch(${match.id})" class="text-red-600 hover:text-red-800 p-2" title="ลบ">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteMatch(matchId) {
            const match = matches.find(m => m.id === matchId);
            if (!match) {
                showErrorMessage('ไม่พบข้อมูลแมทช์');
                return;
            }
            
            const teamA = getTeamById(match.teamA);
            const teamB = getTeamById(match.teamB);
            
            if (!teamA || !teamB) {
                showErrorMessage('ไม่พบข้อมูลทีม');
                return;
            }
            
            const matchDate = new Date(match.date).toLocaleDateString('th-TH');
            const matchInfo = `${teamA.name} ${match.scoreA}-${match.scoreB} ${teamB.name}`;
            
            const message = `คุณต้องการลบผลการแข่งขันนี้หรือไม่?`;
            
            let resultClass = 'bg-gray-100';
            let resultText = 'เสมอ';
            let resultIcon = 'fas fa-handshake';
            
            if (match.scoreA > match.scoreB) {
                resultClass = 'bg-green-100 border-green-500';
                resultText = `${teamA.name} ชนะ`;
                resultIcon = 'fas fa-trophy';
            } else if (match.scoreB > match.scoreA) {
                resultClass = 'bg-blue-100 border-blue-500';
                resultText = `${teamB.name} ชนะ`;
                resultIcon = 'fas fa-trophy';
            }
            
            const teamALogo = teamA.logo 
                ? `<img src="${teamA.logo}" alt="${teamA.name}" class="w-10 h-10 rounded-full object-cover">`
                : `<div class="w-10 h-10 rounded-full ${getColorClass(teamA.primaryColor)} flex items-center justify-center text-white font-bold text-sm">
                    ${teamA.name.charAt(0)}
                   </div>`;
            
            const teamBLogo = teamB.logo 
                ? `<img src="${teamB.logo}" alt="${teamB.name}" class="w-10 h-10 rounded-full object-cover">`
                : `<div class="w-10 h-10 rounded-full ${getColorClass(teamB.primaryColor)} flex items-center justify-center text-white font-bold text-sm">
                    ${teamB.name.charAt(0)}
                   </div>`;
            
            let details = `
                <div class="space-y-3">
                    <div class="border-2 ${resultClass} rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                ${teamALogo}
                                <div>
                                    <div class="font-bold">${teamA.name}</div>
                                    <div class="text-sm text-gray-600">ทีมเจ้าบ้าน</div>
                                </div>
                            </div>
                            
                            <div class="text-center">
                                <div class="text-3xl font-bold text-gray-700">${match.scoreA} - ${match.scoreB}</div>
                                <div class="text-sm text-gray-600">ผลการแข่งขัน</div>
                            </div>
                            
                            <div class="flex items-center space-x-3">
                                <div class="text-right">
                                    <div class="font-bold">${teamB.name}</div>
                                    <div class="text-sm text-gray-600">ทีมเยือน</div>
                                </div>
                                ${teamBLogo}
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-center space-x-2 text-sm">
                            <i class="${resultIcon} text-gray-600"></i>
                            <span class="font-medium">${resultText}</span>
                        </div>
                    </div>
                    
                    <div class="border-t pt-3 space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">📅 วันที่แข่งขัน:</span>
                            <span class="font-bold">${matchDate}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">⚽ ประตูรวม:</span>
                            <span class="font-bold text-green-600">${match.scoreA + match.scoreB} ประตู</span>
                        </div>
                    </div>
                    
                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-3 mt-3">
                        <div class="flex items-start space-x-2">
                            <i class="fas fa-exclamation-triangle text-orange-500 mt-0.5"></i>
                            <div class="text-orange-700 text-sm">
                                <div class="font-bold mb-1">ผลกระทบจากการลบ:</div>
                                <div>• คะแนนในตารางคะแนนจะถูกปรับปรุง</div>
                                <div>• สถิติทีมและผู้เล่นจะถูกอัปเดต</div>
                                <div>• ประวัติการแข่งขันจะหายไป</div>
                                <div class="mt-2 font-bold">⚠️ การลบจะไม่สามารถกู้คืนได้</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            showDeleteModal(message, details, () => {
                // Execute delete
                matches = matches.filter(m => m.id !== matchId);
                
                saveToDatabase();
                
                // Update all related UI
                updateMatchHistory();
                updateLeaderboard();
                updateDashboardStats();
                updateRecentMatches();
                
                showSuccessMessage(`ลบแมทช์ "${matchInfo}" เมื่อวันที่ ${matchDate} สำเร็จ!`);
            });
        }

        // Player Records Functions
        function updateRecordTeamDropdown() {
            const recordTeamSelect = document.getElementById('record-team');
            
            // Clear existing options except the first one
            while (recordTeamSelect.children.length > 1) {
                recordTeamSelect.removeChild(recordTeamSelect.lastChild);
            }
            
            teams.forEach(team => {
                const option = document.createElement('option');
                option.value = team.id;
                option.textContent = team.name;
                recordTeamSelect.appendChild(option);
            });
        }

        function updateStatsTeamFilter() {
            const statsTeamFilter = document.getElementById('stats-team-filter');
            if (!statsTeamFilter) return;
            
            // Clear existing options except the first one
            while (statsTeamFilter.children.length > 1) {
                statsTeamFilter.removeChild(statsTeamFilter.lastChild);
            }
            
            teams.forEach(team => {
                const option = document.createElement('option');
                option.value = team.id;
                option.textContent = team.name;
                statsTeamFilter.appendChild(option);
            });
        }

        function updatePlayersByTeam() {
            const teamId = document.getElementById('record-team').value;
            const playerSelect = document.getElementById('record-player');
            
            // Clear existing options except the first one
            while (playerSelect.children.length > 1) {
                playerSelect.removeChild(playerSelect.lastChild);
            }
            
            if (!teamId) return;
            
            const teamPlayers = players.filter(player => player.teamId == teamId);
            teamPlayers.forEach(player => {
                const option = document.createElement('option');
                option.value = player.id;
                option.textContent = `${player.name}${player.jersey ? ` (#${player.jersey})` : ''}`;
                playerSelect.appendChild(option);
            });
        }

        function handlePlayerRecordSubmit(event) {
            event.preventDefault();
            
            const date = document.getElementById('record-date').value;
            const time = document.getElementById('record-time').value;
            const teamId = document.getElementById('record-team').value;
            const playerId = document.getElementById('record-player').value;
            const recordType = document.querySelector('input[name="record-type"]:checked')?.value;
            const count = parseInt(document.getElementById('record-count').value);
            const note = document.getElementById('record-note').value.trim();
            
            if (!date || !teamId || !playerId || !recordType || !count) {
                showErrorMessage('กรุณากรอกข้อมูลที่จำเป็นให้ครบถ้วน');
                return;
            }
            
            const player = players.find(p => p.id == playerId);
            const team = getTeamById(parseInt(teamId));
            
            if (!player || !team) {
                showErrorMessage('ไม่พบข้อมูลผู้เล่นหรือทีม');
                return;
            }
            
            const typeNames = {
                'goal': 'ประตู',
                'save': 'เซฟ',
                'yellow': 'ใบเหลือง',
                'red': 'ใบแดง'
            };
            
            if (editingPlayerRecord) {
                // Edit existing record
                const recordIndex = playerRecords.findIndex(record => record.id === editingPlayerRecord.id);
                if (recordIndex !== -1) {
                    playerRecords[recordIndex].date = date;
                    playerRecords[recordIndex].time = time || null;
                    playerRecords[recordIndex].teamId = parseInt(teamId);
                    playerRecords[recordIndex].playerId = parseInt(playerId);
                    playerRecords[recordIndex].type = recordType;
                    playerRecords[recordIndex].count = count;
                    playerRecords[recordIndex].note = note || null;
                    
                    saveToDatabase();
                    updatePlayerRecordsList();
                    updateTopPlayersStats();
                    updatePlayerStatsDashboard();
                    clearRecordForm();
                    editingPlayerRecord = null;
                    
                    showSuccessMessage(`แก้ไขสถิติ ${typeNames[recordType]} ของ ${player.name} สำเร็จ!`);
                }
            } else {
                // Add new record
                const newRecord = {
                    id: Date.now(),
                    playerId: parseInt(playerId),
                    teamId: parseInt(teamId),
                    type: recordType,
                    count: count,
                    date: date,
                    time: time || null,
                    note: note || null,
                    createdAt: new Date()
                };
                
                playerRecords.push(newRecord);
                saveToDatabase();
                updatePlayerRecordsList();
                updateTopPlayersStats();
                updatePlayerStatsDashboard();
                clearRecordForm();
                
                showSuccessMessage(`บันทึก${typeNames[recordType]} ${count} ครั้ง ของ ${player.name} สำเร็จ!`);
            }
        }

        function editPlayerRecord(recordId) {
            const record = playerRecords.find(r => r.id === recordId);
            if (!record) {
                showErrorMessage('ไม่พบข้อมูลสถิติ');
                return;
            }
            
            editingPlayerRecord = record;
            
            // Fill form with record data
            document.getElementById('record-date').value = record.date;
            document.getElementById('record-time').value = record.time || '';
            document.getElementById('record-team').value = record.teamId;
            document.getElementById('record-count').value = record.count;
            document.getElementById('record-count-display').textContent = record.count;
            document.getElementById('record-note').value = record.note || '';
            
            // Update players dropdown based on team
            updatePlayersByTeam();
            document.getElementById('record-player').value = record.playerId;
            
            // Set record type
            const recordTypeRadio = document.querySelector(`input[name="record-type"][value="${record.type}"]`);
            if (recordTypeRadio) {
                recordTypeRadio.checked = true;
            }
            
            // Change button text
            const submitButton = document.querySelector('#player-records form button[type="submit"]');
            submitButton.innerHTML = '<i class="fas fa-save mr-2"></i>บันทึกการแก้ไข';
            
            // Scroll to form
            document.getElementById('player-records').scrollIntoView({ behavior: 'smooth' });
        }

        function increaseCount() {
            const countInput = document.getElementById('record-count');
            const countDisplay = document.getElementById('record-count-display');
            let currentCount = parseInt(countInput.value);
            
            if (currentCount < 10) {
                currentCount++;
                countInput.value = currentCount;
                countDisplay.textContent = currentCount;
            }
        }

        function decreaseCount() {
            const countInput = document.getElementById('record-count');
            const countDisplay = document.getElementById('record-count-display');
            let currentCount = parseInt(countInput.value);
            
            if (currentCount > 1) {
                currentCount--;
                countInput.value = currentCount;
                countDisplay.textContent = currentCount;
            }
        }

        function clearRecordForm() {
            document.getElementById('record-team').value = '';
            document.getElementById('record-player').value = '';
            document.getElementById('record-count').value = '1';
            document.getElementById('record-count-display').textContent = '1';
            document.getElementById('record-note').value = '';
            document.getElementById('record-time').value = '';
            
            // Clear record type selection
            document.querySelectorAll('input[name="record-type"]').forEach(input => {
                input.checked = false;
            });
            
            // Clear player dropdown
            const playerSelect = document.getElementById('record-player');
            while (playerSelect.children.length > 1) {
                playerSelect.removeChild(playerSelect.lastChild);
            }
            
            // Reset editing state
            editingPlayerRecord = null;
            
            // Reset button text
            const submitButton = document.querySelector('#player-records form button[type="submit"]');
            submitButton.innerHTML = '<i class="fas fa-save mr-2"></i>บันทึกสถิติ';
        }

        function updatePlayerRecordsList() {
            const container = document.getElementById('player-records-list');
            console.log('🔍 updatePlayerRecordsList called, records:', playerRecords.length);
            
            if (playerRecords.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-medal text-4xl mb-4 text-gray-300"></i>
                        <p class="text-lg font-medium">ยังไม่มีสถิติผู้เล่น</p>
                        <p class="text-sm">เริ่มต้นด้วยการบันทึกสถิติแรก</p>
                    </div>
                `;
                return;
            }
            
            let filteredRecords = [...playerRecords];
            
            // Apply filters
            const typeFilter = document.getElementById('filter-record-type').value;
            const dateFilter = document.getElementById('filter-record-date').value;
            
            if (typeFilter) {
                filteredRecords = filteredRecords.filter(record => record.type === typeFilter);
            }
            
            if (dateFilter) {
                filteredRecords = filteredRecords.filter(record => record.date === dateFilter);
            }
            
            // Sort by date (newest first)
            filteredRecords.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (filteredRecords.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500">ไม่พบข้อมูลตามเงื่อนไขที่เลือก</div>';
                return;
            }
            
            container.innerHTML = filteredRecords.map(record => {
                const player = players.find(p => p.id === record.playerId);
                const team = getTeamById(record.teamId);
                const date = new Date(record.date).toLocaleDateString('th-TH');
                
                if (!player || !team) return '';
                
                const typeConfig = {
                    'goal': { icon: 'fas fa-futbol', color: 'text-green-600', bg: 'bg-green-50', border: 'border-green-200', name: 'ประตู' },
                    'save': { icon: 'fas fa-hand-paper', color: 'text-blue-600', bg: 'bg-blue-50', border: 'border-blue-200', name: 'เซฟ' },
                    'yellow': { icon: 'fas fa-square', color: 'text-yellow-600', bg: 'bg-yellow-50', border: 'border-yellow-200', name: 'ใบเหลือง' },
                    'red': { icon: 'fas fa-square', color: 'text-red-600', bg: 'bg-red-50', border: 'border-red-200', name: 'ใบแดง' }
                };
                
                const config = typeConfig[record.type];
                
                const playerAvatar = player.photo 
                    ? `<img src="${player.photo}" alt="${player.name}" class="w-8 h-8 rounded-full object-cover">`
                    : `<div class="w-8 h-8 rounded-full ${getColorClass(team.primaryColor)} flex items-center justify-center text-white font-bold text-xs">
                        ${player.name.charAt(0)}
                       </div>`;
                
                return `
                    <div class="border ${config.border} rounded-lg ${config.bg} hover:shadow-md transition-all cursor-pointer" onclick="toggleRecordDetails(${record.id})">
                        <!-- Compact Header -->
                        <div class="p-3">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    ${playerAvatar}
                                    <div class="flex-1">
                                        <div class="font-bold text-sm">${player.name}</div>
                                        <div class="text-xs text-gray-500">${team.name}</div>
                                    </div>
                                </div>
                                
                                <div class="flex items-center space-x-3">
                                    <div class="flex items-center space-x-1 ${config.color}">
                                        <i class="${config.icon} text-sm"></i>
                                        <span class="font-bold">${record.count}</span>
                                        <span class="text-xs">${config.name}</span>
                                    </div>
                                    <div class="text-xs text-gray-500">${date}</div>
                                    <i class="fas fa-chevron-down text-gray-400 text-xs transition-transform" id="chevron-${record.id}"></i>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Expandable Details -->
                        <div id="details-${record.id}" class="hidden border-t ${config.border} bg-white bg-opacity-50">
                            <div class="p-4 space-y-3">
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <span class="text-gray-600">📅 วันที่:</span>
                                        <span class="font-medium ml-2">${date}</span>
                                    </div>
                                    ${record.time ? `
                                        <div>
                                            <span class="text-gray-600">⏰ เวลา:</span>
                                            <span class="font-medium ml-2">${record.time}</span>
                                        </div>
                                    ` : ''}
                                    <div>
                                        <span class="text-gray-600">👕 เบอร์:</span>
                                        <span class="font-medium ml-2">${player.jersey ? `#${player.jersey}` : 'ไม่มี'}</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-600">📊 ประเภท:</span>
                                        <span class="font-medium ml-2 ${config.color}">${config.name}</span>
                                    </div>
                                </div>
                                
                                ${record.note ? `
                                    <div class="bg-gray-50 rounded-lg p-3">
                                        <div class="text-xs text-gray-600 mb-1">📝 หมายเหตุ:</div>
                                        <div class="text-sm font-medium">${record.note}</div>
                                    </div>
                                ` : ''}
                                
                                <div class="flex justify-end space-x-2 pt-2 border-t border-gray-200">
                                    <button onclick="editPlayerRecord(${record.id}); event.stopPropagation();" class="flex items-center px-3 py-1 bg-blue-100 hover:bg-blue-200 text-blue-600 rounded-lg transition-colors text-sm" title="แก้ไข">
                                        <i class="fas fa-edit mr-1"></i>
                                        แก้ไข
                                    </button>
                                    <button onclick="deletePlayerRecord(${record.id}); event.stopPropagation();" class="flex items-center px-3 py-1 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg transition-colors text-sm" title="ลบ">
                                        <i class="fas fa-trash mr-1"></i>
                                        ลบ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Toggle record details function
        function toggleRecordDetails(recordId) {
            const detailsElement = document.getElementById(`details-${recordId}`);
            const chevronElement = document.getElementById(`chevron-${recordId}`);
            
            if (detailsElement && chevronElement) {
                const isHidden = detailsElement.classList.contains('hidden');
                
                if (isHidden) {
                    detailsElement.classList.remove('hidden');
                    chevronElement.classList.add('rotate-180');
                } else {
                    detailsElement.classList.add('hidden');
                    chevronElement.classList.remove('rotate-180');
                }
            }
        }

        function deletePlayerRecord(recordId) {
            const record = playerRecords.find(r => r.id === recordId);
            if (!record) {
                showErrorMessage('ไม่พบข้อมูลสถิติ');
                return;
            }
            
            const player = players.find(p => p.id === record.playerId);
            const team = getTeamById(record.teamId);
            
            if (!player) {
                showErrorMessage('ไม่พบข้อมูลผู้เล่น');
                return;
            }
            
            const typeNames = {
                'goal': 'ประตู',
                'save': 'เซฟ',
                'yellow': 'ใบเหลือง',
                'red': 'ใบแดง'
            };
            
            const typeConfig = {
                'goal': { icon: 'fas fa-futbol', color: 'text-green-600', bg: 'bg-green-100' },
                'save': { icon: 'fas fa-hand-paper', color: 'text-blue-600', bg: 'bg-blue-100' },
                'yellow': { icon: 'fas fa-square', color: 'text-yellow-600', bg: 'bg-yellow-100' },
                'red': { icon: 'fas fa-square', color: 'text-red-600', bg: 'bg-red-100' }
            };
            
            const config = typeConfig[record.type];
            const recordDate = new Date(record.date).toLocaleDateString('th-TH');
            
            const message = `คุณต้องการลบสถิตินี้หรือไม่?`;
            
            const playerAvatar = player.photo 
                ? `<img src="${player.photo}" alt="${player.name}" class="w-10 h-10 rounded-full object-cover">`
                : `<div class="w-10 h-10 rounded-full ${team ? getColorClass(team.primaryColor) : 'bg-gray-500'} flex items-center justify-center text-white font-bold text-sm">
                    ${player.name.charAt(0)}
                   </div>`;
            
            let details = `
                <div class="space-y-3">
                    <div class="border-2 ${config.bg} border-l-4 ${config.color.replace('text-', 'border-')} rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                ${playerAvatar}
                                <div>
                                    <div class="font-bold text-lg">${player.name}</div>
                                    <div class="text-gray-600 text-sm">${team ? team.name : 'ไม่มีทีม'}${player.jersey ? ` • #${player.jersey}` : ''}</div>
                                </div>
                            </div>
                            
                            <div class="flex items-center space-x-2 ${config.color}">
                                <i class="${config.icon} text-2xl"></i>
                                <div class="text-right">
                                    <div class="text-2xl font-bold">${record.count}</div>
                                    <div class="text-sm">${typeNames[record.type]}</div>
                                </div>
                            </div>
                        </div>
                        
                        ${record.note ? `
                            <div class="bg-white bg-opacity-50 rounded p-2 text-sm">
                                <i class="fas fa-sticky-note mr-1"></i>
                                ${record.note}
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="border-t pt-3 space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">📅 วันที่:</span>
                            <span class="font-bold">${recordDate}</span>
                        </div>
                        ${record.time ? `
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">⏰ เวลา:</span>
                                <span class="font-bold">${record.time}</span>
                            </div>
                        ` : ''}
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">📊 ประเภท:</span>
                            <span class="font-bold ${config.color}">${typeNames[record.type]}</span>
                        </div>
                    </div>
                    
                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-3 mt-3">
                        <div class="flex items-start space-x-2">
                            <i class="fas fa-exclamation-triangle text-orange-500 mt-0.5"></i>
                            <div class="text-orange-700 text-sm">
                                <div class="font-bold mb-1">ผลกระทบจากการลบ:</div>
                                <div>• อันดับดาวซัลโวจะถูกอัปเดต</div>
                                <div>• สถิติผู้เล่นจะถูกปรับปรุง</div>
                                <div>• ข้อมูล Dashboard จะเปลี่ยนแปลง</div>
                                <div class="mt-2 font-bold">⚠️ การลบจะไม่สามารถกู้คืนได้</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            showDeleteModal(message, details, () => {
                // Execute delete
                playerRecords = playerRecords.filter(r => r.id !== recordId);
                
                saveToDatabase();
                
                // Update all related UI
                updatePlayerRecordsList();
                updateTopPlayersStats();
                updateDashboardStats();
                
                showSuccessMessage(`ลบสถิติ ${typeNames[record.type]} ของ ${player.name} สำเร็จ!`);
            });
        }

        function filterPlayerRecords() {
            updatePlayerRecordsList();
        }

        function updateTopPlayersStats() {
            updateTopScorers();
            updateTopKeepers();
            updateMostYellowCards();
            updateMostRedCards();
            updatePlayerStatsDashboard();
        }

        function updatePlayerStatsDashboard() {
            const container = document.getElementById('player-stats-dashboard');
            if (!container) return;
            
            // Calculate player statistics with scoring system
            const playerStats = {};
            
            // Initialize stats for all players
            players.forEach(player => {
                playerStats[player.id] = {
                    player: player,
                    goals: 0,
                    saves: 0,
                    yellows: 0,
                    reds: 0,
                    totalRecords: 0,
                    score: 0 // Performance score
                };
            });
            
            // Calculate stats from records
            playerRecords.forEach(record => {
                if (playerStats[record.playerId]) {
                    playerStats[record.playerId].totalRecords++;
                    switch (record.type) {
                        case 'goal':
                            playerStats[record.playerId].goals += record.count;
                            playerStats[record.playerId].score += record.count * 3; // 3 points per goal
                            break;
                        case 'save':
                            playerStats[record.playerId].saves += record.count;
                            playerStats[record.playerId].score += record.count * 1; // 1 point per save
                            break;
                        case 'yellow':
                            playerStats[record.playerId].yellows += record.count;
                            playerStats[record.playerId].score -= record.count * 1; // -1 point per yellow
                            break;
                        case 'red':
                            playerStats[record.playerId].reds += record.count;
                            playerStats[record.playerId].score -= record.count * 3; // -3 points per red
                            break;
                    }
                }
            });
            
            // Filter players with stats
            let filteredStats = Object.values(playerStats).filter(stats => stats.totalRecords > 0);
            
            // Apply filters
            const teamFilter = document.getElementById('stats-team-filter')?.value;
            const typeFilter = document.getElementById('stats-type-filter')?.value;
            
            if (teamFilter) {
                filteredStats = filteredStats.filter(stats => stats.player.teamId == teamFilter);
            }
            
            if (typeFilter) {
                switch (typeFilter) {
                    case 'goal':
                        filteredStats = filteredStats.filter(stats => stats.goals > 0);
                        filteredStats.sort((a, b) => b.goals - a.goals);
                        break;
                    case 'save':
                        filteredStats = filteredStats.filter(stats => stats.saves > 0);
                        filteredStats.sort((a, b) => b.saves - a.saves);
                        break;
                    case 'yellow':
                        filteredStats = filteredStats.filter(stats => stats.yellows > 0);
                        filteredStats.sort((a, b) => b.yellows - a.yellows);
                        break;
                    case 'red':
                        filteredStats = filteredStats.filter(stats => stats.reds > 0);
                        filteredStats.sort((a, b) => b.reds - a.reds);
                        break;
                    default:
                        // Sort by performance score
                        filteredStats.sort((a, b) => b.score - a.score);
                }
            } else {
                // Sort by performance score when no type filter
                filteredStats.sort((a, b) => b.score - a.score);
            }
            
            if (filteredStats.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-8 text-gray-500">
                        <i class="fas fa-chart-bar text-4xl mb-4 text-gray-300"></i>
                        <p class="text-lg font-medium">ไม่มีข้อมูลสถิติ</p>
                        <p class="text-sm">เริ่มต้นด้วยการบันทึกสถิติผู้เล่น</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredStats.map((stats, index) => {
                const player = stats.player;
                const team = getTeamById(player.teamId);
                
                const playerAvatar = player.photo 
                    ? `<img src="${player.photo}" alt="${player.name}" class="w-20 h-20 rounded-full object-cover border-4 border-white shadow-lg">`
                    : `<div class="w-20 h-20 rounded-full ${team ? getColorClass(team.primaryColor) : 'bg-gray-500'} flex items-center justify-center text-white font-bold text-2xl shadow-lg border-4 border-white">
                        ${player.name.charAt(0)}
                       </div>`;
                
                // Determine rank badge and card styling
                let rankBadge = '';
                let cardClass = 'bg-white';
                let scoreColor = 'text-indigo-600';
                
                if (index === 0) {
                    rankBadge = '<div class="absolute -top-3 -right-3 w-10 h-10 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-full flex items-center justify-center shadow-xl border-3 border-white"><i class="fas fa-crown text-white text-lg"></i></div>';
                    cardClass = 'bg-gradient-to-br from-yellow-50 to-yellow-100 border-2 border-yellow-300';
                    scoreColor = 'text-yellow-700';
                } else if (index === 1) {
                    rankBadge = '<div class="absolute -top-3 -right-3 w-10 h-10 bg-gradient-to-br from-gray-400 to-gray-600 rounded-full flex items-center justify-center shadow-xl border-3 border-white"><span class="text-white text-sm font-bold">2</span></div>';
                    cardClass = 'bg-gradient-to-br from-gray-50 to-gray-100 border-2 border-gray-300';
                    scoreColor = 'text-gray-700';
                } else if (index === 2) {
                    rankBadge = '<div class="absolute -top-3 -right-3 w-10 h-10 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center shadow-xl border-3 border-white"><span class="text-white text-sm font-bold">3</span></div>';
                    cardClass = 'bg-gradient-to-br from-orange-50 to-orange-100 border-2 border-orange-300';
                    scoreColor = 'text-orange-700';
                }
                
                // Performance level
                let performanceLevel = 'มือใหม่';
                let performanceColor = 'text-gray-600';
                let performanceIcon = 'fas fa-seedling';
                
                if (stats.score >= 50) {
                    performanceLevel = 'ตำนาน';
                    performanceColor = 'text-purple-600';
                    performanceIcon = 'fas fa-crown';
                } else if (stats.score >= 30) {
                    performanceLevel = 'ซูเปอร์สตาร์';
                    performanceColor = 'text-yellow-600';
                    performanceIcon = 'fas fa-star';
                } else if (stats.score >= 20) {
                    performanceLevel = 'ผู้เชี่ยวชาญ';
                    performanceColor = 'text-blue-600';
                    performanceIcon = 'fas fa-medal';
                } else if (stats.score >= 10) {
                    performanceLevel = 'มืออาชีพ';
                    performanceColor = 'text-green-600';
                    performanceIcon = 'fas fa-trophy';
                } else if (stats.score >= 5) {
                    performanceLevel = 'มือดี';
                    performanceColor = 'text-indigo-600';
                    performanceIcon = 'fas fa-thumbs-up';
                }
                
                return `
                    <div class="${cardClass} rounded-2xl shadow-xl border border-gray-100 p-6 card-hover transition-all hover:shadow-2xl hover:scale-105">
                        <!-- Header with Rank -->
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-1 text-sm font-bold text-gray-600">
                                <span class="text-lg">#${index + 1}</span>
                            </div>
                            <div class="flex items-center space-x-2 ${performanceColor}">
                                <i class="${performanceIcon} text-sm"></i>
                                <span class="text-xs font-bold">${performanceLevel}</span>
                            </div>
                        </div>
                        
                        <!-- Player Info -->
                        <div class="flex flex-col items-center text-center mb-6">
                            <div class="relative mb-4">
                                ${playerAvatar}
                                ${rankBadge}
                            </div>
                            <h4 class="text-xl font-bold text-gray-800 mb-1">${player.name}</h4>
                            <p class="text-sm text-gray-600 mb-2">${team ? team.name : 'ไม่มีทีม'}${player.jersey ? ` • #${player.jersey}` : ''}</p>
                            
                            <!-- Performance Score -->
                            <div class="bg-white bg-opacity-70 rounded-xl px-4 py-2 shadow-md">
                                <div class="text-3xl font-bold ${scoreColor}">${stats.score}</div>
                                <div class="text-xs text-gray-600 font-medium">คะแนนผลงาน</div>
                            </div>
                        </div>
                        
                        <!-- Stats Grid -->
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <div class="bg-white bg-opacity-70 rounded-lg p-3 text-center shadow-sm">
                                <div class="flex items-center justify-center space-x-1 text-green-600 mb-1">
                                    <i class="fas fa-futbol text-sm"></i>
                                    <span class="text-xl font-bold">${stats.goals}</span>
                                </div>
                                <div class="text-xs text-green-700 font-medium">ประตู</div>
                                <div class="text-xs text-green-600 font-bold">+${stats.goals * 3} คะแนน</div>
                            </div>
                            
                            <div class="bg-white bg-opacity-70 rounded-lg p-3 text-center shadow-sm">
                                <div class="flex items-center justify-center space-x-1 text-blue-600 mb-1">
                                    <i class="fas fa-hand-paper text-sm"></i>
                                    <span class="text-xl font-bold">${stats.saves}</span>
                                </div>
                                <div class="text-xs text-blue-700 font-medium">เซฟ</div>
                                <div class="text-xs text-blue-600 font-bold">+${stats.saves * 1} คะแนน</div>
                            </div>
                            
                            ${(stats.yellows > 0 || stats.reds > 0) ? `
                                <div class="bg-white bg-opacity-70 rounded-lg p-3 text-center shadow-sm">
                                    <div class="flex items-center justify-center space-x-1 text-yellow-600 mb-1">
                                        <i class="fas fa-square text-sm"></i>
                                        <span class="text-xl font-bold">${stats.yellows}</span>
                                    </div>
                                    <div class="text-xs text-yellow-700 font-medium">ใบเหลือง</div>
                                    <div class="text-xs text-red-600 font-bold">-${stats.yellows * 1} คะแนน</div>
                                </div>
                                
                                <div class="bg-white bg-opacity-70 rounded-lg p-3 text-center shadow-sm">
                                    <div class="flex items-center justify-center space-x-1 text-red-600 mb-1">
                                        <i class="fas fa-square text-sm"></i>
                                        <span class="text-xl font-bold">${stats.reds}</span>
                                    </div>
                                    <div class="text-xs text-red-700 font-medium">ใบแดง</div>
                                    <div class="text-xs text-red-600 font-bold">-${stats.reds * 3} คะแนน</div>
                                </div>
                            ` : `
                                <div class="col-span-2 bg-white bg-opacity-70 rounded-lg p-3 text-center shadow-sm">
                                    <div class="flex items-center justify-center space-x-2 text-green-600">
                                        <i class="fas fa-check-circle text-lg"></i>
                                        <span class="text-sm font-bold">เล่นสะอาด</span>
                                    </div>
                                    <div class="text-xs text-green-600 mt-1">ไม่มีใบเหลือง/แดง</div>
                                </div>
                            `}
                        </div>
                        
                        <!-- Summary -->
                        <div class="bg-white bg-opacity-70 rounded-lg p-3 text-center shadow-sm">
                            <div class="flex items-center justify-between text-sm">
                                <span class="text-gray-600">สถิติทั้งหมด</span>
                                <span class="font-bold text-indigo-600">${stats.totalRecords} รายการ</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterPlayerStats() {
            updatePlayerStatsDashboard();
        }

        function updateTopScorers() {
            const goalStats = {};
            
            playerRecords.filter(record => record.type === 'goal').forEach(record => {
                const playerId = record.playerId;
                if (!goalStats[playerId]) {
                    goalStats[playerId] = { playerId, goals: 0 };
                }
                goalStats[playerId].goals += record.count;
            });
            
            const sortedScorers = Object.values(goalStats)
                .sort((a, b) => b.goals - a.goals)
                .slice(0, 5);
            
            const container = document.getElementById('top-scorers');
            
            if (sortedScorers.length === 0) {
                container.innerHTML = '<div class="text-gray-500 text-center py-3 text-sm">ยังไม่มีข้อมูล</div>';
                return;
            }
            
            container.innerHTML = sortedScorers.map((scorer, index) => {
                const player = players.find(p => p.id === scorer.playerId);
                const team = getTeamById(player?.teamId);
                
                if (!player) return '';
                
                let rankIcon = '';
                let rankClass = 'bg-gray-50 hover:bg-gray-100';
                
                if (index === 0) {
                    rankIcon = '<i class="fas fa-crown text-yellow-500"></i>';
                    rankClass = 'bg-yellow-50 hover:bg-yellow-100 border border-yellow-200';
                } else if (index === 1) {
                    rankIcon = '<i class="fas fa-medal text-gray-500"></i>';
                    rankClass = 'bg-gray-50 hover:bg-gray-100 border border-gray-200';
                } else if (index === 2) {
                    rankIcon = '<i class="fas fa-medal text-orange-500"></i>';
                    rankClass = 'bg-orange-50 hover:bg-orange-100 border border-orange-200';
                } else {
                    rankIcon = `<span class="text-gray-600 font-bold text-sm">${index + 1}</span>`;
                }
                
                return `
                    <div class="flex items-center justify-between p-2 ${rankClass} rounded-lg transition-colors">
                        <div class="flex items-center space-x-2">
                            <div class="w-6 h-6 rounded-full bg-white flex items-center justify-center shadow-sm">
                                ${rankIcon}
                            </div>
                            <div>
                                <div class="text-sm font-medium text-gray-800">${player.name}</div>
                                <div class="text-xs text-gray-500">${team ? team.name : 'ไม่มีทีม'}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold text-gray-800">${scorer.goals}</div>
                            <div class="text-xs text-gray-500">ประตู</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateTopKeepers() {
            const saveStats = {};
            
            playerRecords.filter(record => record.type === 'save').forEach(record => {
                const playerId = record.playerId;
                if (!saveStats[playerId]) {
                    saveStats[playerId] = { playerId, saves: 0 };
                }
                saveStats[playerId].saves += record.count;
            });
            
            const sortedKeepers = Object.values(saveStats)
                .sort((a, b) => b.saves - a.saves)
                .slice(0, 5);
            
            const container = document.getElementById('top-keepers');
            
            if (sortedKeepers.length === 0) {
                container.innerHTML = '<div class="text-gray-500 text-center py-3 text-sm">ยังไม่มีข้อมูล</div>';
                return;
            }
            
            container.innerHTML = sortedKeepers.map((keeper, index) => {
                const player = players.find(p => p.id === keeper.playerId);
                const team = getTeamById(player?.teamId);
                
                if (!player) return '';
                
                let rankIcon = '';
                let rankClass = 'bg-gray-50 hover:bg-gray-100';
                
                if (index === 0) {
                    rankIcon = '<i class="fas fa-crown text-yellow-500"></i>';
                    rankClass = 'bg-yellow-50 hover:bg-yellow-100 border border-yellow-200';
                } else if (index === 1) {
                    rankIcon = '<i class="fas fa-medal text-gray-500"></i>';
                    rankClass = 'bg-gray-50 hover:bg-gray-100 border border-gray-200';
                } else if (index === 2) {
                    rankIcon = '<i class="fas fa-medal text-orange-500"></i>';
                    rankClass = 'bg-orange-50 hover:bg-orange-100 border border-orange-200';
                } else {
                    rankIcon = `<span class="text-gray-600 font-bold text-sm">${index + 1}</span>`;
                }
                
                return `
                    <div class="flex items-center justify-between p-2 ${rankClass} rounded-lg transition-colors">
                        <div class="flex items-center space-x-2">
                            <div class="w-6 h-6 rounded-full bg-white flex items-center justify-center shadow-sm">
                                ${rankIcon}
                            </div>
                            <div>
                                <div class="text-sm font-medium text-gray-800">${player.name}</div>
                                <div class="text-xs text-gray-500">${team ? team.name : 'ไม่มีทีม'}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold text-gray-800">${keeper.saves}</div>
                            <div class="text-xs text-gray-500">เซฟ</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateMostYellowCards() {
            const yellowStats = {};
            
            playerRecords.filter(record => record.type === 'yellow').forEach(record => {
                const playerId = record.playerId;
                if (!yellowStats[playerId]) {
                    yellowStats[playerId] = { playerId, yellows: 0 };
                }
                yellowStats[playerId].yellows += record.count;
            });
            
            const sortedYellows = Object.values(yellowStats)
                .sort((a, b) => b.yellows - a.yellows)
                .slice(0, 5);
            
            const container = document.getElementById('most-yellow-cards');
            
            if (sortedYellows.length === 0) {
                container.innerHTML = '<div class="text-gray-500 text-center py-3 text-sm">ยังไม่มีข้อมูล</div>';
                return;
            }
            
            container.innerHTML = sortedYellows.map((yellow, index) => {
                const player = players.find(p => p.id === yellow.playerId);
                const team = getTeamById(player?.teamId);
                
                if (!player) return '';
                
                let rankIcon = '';
                let rankClass = 'bg-gray-50 hover:bg-gray-100';
                
                if (index === 0) {
                    rankIcon = '<i class="fas fa-exclamation-triangle text-red-500"></i>';
                    rankClass = 'bg-red-50 hover:bg-red-100 border border-red-200';
                } else if (index === 1) {
                    rankIcon = '<i class="fas fa-exclamation text-orange-500"></i>';
                    rankClass = 'bg-orange-50 hover:bg-orange-100 border border-orange-200';
                } else if (index === 2) {
                    rankIcon = '<i class="fas fa-exclamation text-yellow-500"></i>';
                    rankClass = 'bg-yellow-50 hover:bg-yellow-100 border border-yellow-200';
                } else {
                    rankIcon = `<span class="text-gray-600 font-bold text-sm">${index + 1}</span>`;
                }
                
                return `
                    <div class="flex items-center justify-between p-2 ${rankClass} rounded-lg transition-colors">
                        <div class="flex items-center space-x-2">
                            <div class="w-6 h-6 rounded-full bg-white flex items-center justify-center shadow-sm">
                                ${rankIcon}
                            </div>
                            <div>
                                <div class="text-sm font-medium text-gray-800">${player.name}</div>
                                <div class="text-xs text-gray-500">${team ? team.name : 'ไม่มีทีม'}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold text-gray-800">${yellow.yellows}</div>
                            <div class="text-xs text-gray-500">ใบเหลือง</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateMostRedCards() {
            const redStats = {};
            
            playerRecords.filter(record => record.type === 'red').forEach(record => {
                const playerId = record.playerId;
                if (!redStats[playerId]) {
                    redStats[playerId] = { playerId, reds: 0 };
                }
                redStats[playerId].reds += record.count;
            });
            
            const sortedReds = Object.values(redStats)
                .sort((a, b) => b.reds - a.reds)
                .slice(0, 5);
            
            const container = document.getElementById('most-red-cards');
            
            if (sortedReds.length === 0) {
                container.innerHTML = '<div class="text-gray-500 text-center py-3 text-sm">ยังไม่มีข้อมูล</div>';
                return;
            }
            
            container.innerHTML = sortedReds.map((red, index) => {
                const player = players.find(p => p.id === red.playerId);
                const team = getTeamById(player?.teamId);
                
                if (!player) return '';
                
                let rankIcon = '';
                let rankClass = 'bg-gray-50 hover:bg-gray-100';
                
                if (index === 0) {
                    rankIcon = '<i class="fas fa-ban text-red-600"></i>';
                    rankClass = 'bg-red-50 hover:bg-red-100 border border-red-200';
                } else if (index === 1) {
                    rankIcon = '<i class="fas fa-times-circle text-red-500"></i>';
                    rankClass = 'bg-red-50 hover:bg-red-100 border border-red-200';
                } else if (index === 2) {
                    rankIcon = '<i class="fas fa-times text-red-500"></i>';
                    rankClass = 'bg-red-50 hover:bg-red-100 border border-red-200';
                } else {
                    rankIcon = `<span class="text-gray-600 font-bold text-sm">${index + 1}</span>`;
                }
                
                return `
                    <div class="flex items-center justify-between p-2 ${rankClass} rounded-lg transition-colors">
                        <div class="flex items-center space-x-2">
                            <div class="w-6 h-6 rounded-full bg-white flex items-center justify-center shadow-sm">
                                ${rankIcon}
                            </div>
                            <div>
                                <div class="text-sm font-medium text-gray-800">${player.name}</div>
                                <div class="text-xs text-gray-500">${team ? team.name : 'ไม่มีทีม'}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold text-gray-800">${red.reds}</div>
                            <div class="text-xs text-gray-500">ใบแดง</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Next Matches Functions
        function updateNextMatchDropdowns() {
            const nextTeamASelect = document.getElementById('next-team-a');
            const nextTeamBSelect = document.getElementById('next-team-b');
            
            // Clear existing options except the first one
            [nextTeamASelect, nextTeamBSelect].forEach(select => {
                while (select.children.length > 1) {
                    select.removeChild(select.lastChild);
                }
            });
            
            teams.forEach(team => {
                [nextTeamASelect, nextTeamBSelect].forEach(select => {
                    const option = document.createElement('option');
                    option.value = team.id;
                    option.textContent = team.name;
                    select.appendChild(option);
                });
            });
        }

        function handleNextMatchSubmit(event) {
            event.preventDefault();
            
            const date = document.getElementById('next-match-date').value;
            const time = document.getElementById('next-match-time').value;
            const teamA = document.getElementById('next-team-a').value;
            const teamB = document.getElementById('next-team-b').value;
            const venue = document.getElementById('next-match-venue').value.trim();
            const note = document.getElementById('next-match-note').value.trim();
            
            if (!date || !time || !teamA || !teamB) {
                showErrorMessage('กรุณากรอกข้อมูลที่จำเป็นให้ครบถ้วน');
                return;
            }
            
            if (teamA === teamB) {
                showErrorMessage('ไม่สามารถเลือกทีมเดียวกันได้');
                return;
            }
            
            // Check if date is in the future
            const selectedDate = new Date(date + 'T' + time);
            const now = new Date();
            
            if (selectedDate <= now) {
                showErrorMessage('กรุณาเลือกวันที่และเวลาในอนาคต');
                return;
            }
            
            const teamAName = getTeamById(parseInt(teamA)).name;
            const teamBName = getTeamById(parseInt(teamB)).name;
            
            if (editingNextMatch) {
                // Edit existing next match
                const matchIndex = nextMatches.findIndex(match => match.id === editingNextMatch.id);
                if (matchIndex !== -1) {
                    nextMatches[matchIndex].date = date;
                    nextMatches[matchIndex].time = time;
                    nextMatches[matchIndex].teamA = parseInt(teamA);
                    nextMatches[matchIndex].teamB = parseInt(teamB);
                    nextMatches[matchIndex].venue = venue || null;
                    nextMatches[matchIndex].note = note || null;
                    
                    saveToDatabase();
                    updateUpcomingMatchesList();
                    updateUpcomingMatchesDashboard();
                    clearNextMatchForm();
                    editingNextMatch = null;
                    
                    showSuccessMessage(`แก้ไขแมทช์ ${teamAName} vs ${teamBName} สำเร็จ!`);
                }
            } else {
                // Add new next match
                const newNextMatch = {
                    id: Date.now(),
                    date: date,
                    time: time,
                    teamA: parseInt(teamA),
                    teamB: parseInt(teamB),
                    venue: venue || null,
                    note: note || null,
                    createdAt: new Date()
                };
                
                nextMatches.push(newNextMatch);
                saveToDatabase();
                updateUpcomingMatchesList();
                updateUpcomingMatchesDashboard();
                clearNextMatchForm();
                
                showSuccessMessage(`จัดแมทช์ ${teamAName} vs ${teamBName} สำเร็จ!`);
            }
        }

        function editNextMatch(matchId) {
            const match = nextMatches.find(m => m.id === matchId);
            if (!match) return;
            
            editingNextMatch = match;
            
            // Fill form with match data
            document.getElementById('next-match-date').value = match.date;
            document.getElementById('next-match-time').value = match.time;
            document.getElementById('next-team-a').value = match.teamA;
            document.getElementById('next-team-b').value = match.teamB;
            document.getElementById('next-match-venue').value = match.venue || '';
            document.getElementById('next-match-note').value = match.note || '';
            
            // Change button text
            const submitButton = document.querySelector('#next-matches form button[type="submit"]');
            submitButton.innerHTML = '<i class="fas fa-save mr-2"></i>บันทึกการแก้ไข';
            
            // Scroll to form
            document.getElementById('next-matches').scrollIntoView({ behavior: 'smooth' });
        }

        function clearNextMatchForm() {
            document.getElementById('next-match-date').value = '';
            document.getElementById('next-match-time').value = '';
            document.getElementById('next-team-a').value = '';
            document.getElementById('next-team-b').value = '';
            document.getElementById('next-match-venue').value = '';
            document.getElementById('next-match-note').value = '';
            editingNextMatch = null;
            
            // Reset button text
            const submitButton = document.querySelector('#next-matches form button[type="submit"]');
            submitButton.innerHTML = '<i class="fas fa-plus mr-2"></i>จัดแมทช์ต่อไป';
        }

        function deleteNextMatch(matchId) {
            const match = nextMatches.find(m => m.id === matchId);
            if (!match) {
                showErrorMessage('ไม่พบข้อมูลแมทช์');
                return;
            }
            
            const teamA = getTeamById(match.teamA);
            const teamB = getTeamById(match.teamB);
            
            if (!teamA || !teamB) {
                showErrorMessage('ไม่พบข้อมูลทีม');
                return;
            }
            
            const matchDate = new Date(match.date + 'T' + match.time).toLocaleString('th-TH');
            const matchInfo = `${teamA.name} vs ${teamB.name}`;
            
            const message = `คุณต้องการลบแมทช์ที่กำลังจะมาถึงนี้หรือไม่?`;
            
            const teamALogo = teamA.logo 
                ? `<img src="${teamA.logo}" alt="${teamA.name}" class="w-10 h-10 rounded-full object-cover">`
                : `<div class="w-10 h-10 rounded-full ${getColorClass(teamA.primaryColor)} flex items-center justify-center text-white font-bold text-sm">
                    ${teamA.name.charAt(0)}
                   </div>`;
            
            const teamBLogo = teamB.logo 
                ? `<img src="${teamB.logo}" alt="${teamB.name}" class="w-10 h-10 rounded-full object-cover">`
                : `<div class="w-10 h-10 rounded-full ${getColorClass(teamB.primaryColor)} flex items-center justify-center text-white font-bold text-sm">
                    ${teamB.name.charAt(0)}
                   </div>`;
            
            let details = `
                <div class="space-y-3">
                    <div class="border-2 bg-green-100 border-green-500 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                ${teamALogo}
                                <div>
                                    <div class="font-bold">${teamA.name}</div>
                                    <div class="text-sm text-gray-600">ทีมเจ้าบ้าน</div>
                                </div>
                            </div>
                            
                            <div class="text-center">
                                <div class="text-2xl font-bold text-gray-700">VS</div>
                                <div class="text-sm text-gray-600">แมทช์ต่อไป</div>
                            </div>
                            
                            <div class="flex items-center space-x-3">
                                <div class="text-right">
                                    <div class="font-bold">${teamB.name}</div>
                                    <div class="text-sm text-gray-600">ทีมเยือน</div>
                                </div>
                                ${teamBLogo}
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t pt-3 space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">📅 วันที่และเวลา:</span>
                            <span class="font-bold">${matchDate}</span>
                        </div>
                        ${match.venue ? `
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">🏟️ สถานที่:</span>
                                <span class="font-bold">${match.venue}</span>
                            </div>
                        ` : ''}
                        ${match.note ? `
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">📝 หมายเหตุ:</span>
                                <span class="font-bold">${match.note}</span>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-3 mt-3">
                        <div class="flex items-start space-x-2">
                            <i class="fas fa-info-circle text-orange-500 mt-0.5"></i>
                            <div class="text-orange-700 text-sm">
                                <div class="font-bold mb-1">การลบแมทช์ต่อไป:</div>
                                <div>• แมทช์นี้จะถูกยกเลิก</div>
                                <div>• ทีมทั้งสองจะไม่มีแมทช์ในวันที่นี้</div>
                                <div class="mt-2 font-bold">⚠️ การลบจะไม่สามารถกู้คืนได้</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            showDeleteModal(message, details, () => {
                // Execute delete
                nextMatches = nextMatches.filter(m => m.id !== matchId);
                
                saveToDatabase();
                updateUpcomingMatchesList();
                updateUpcomingMatchesDashboard();
                
                showSuccessMessage(`ลบแมทช์ "${matchInfo}" เมื่อวันที่ ${matchDate} สำเร็จ!`);
            });
        }

        function updateUpcomingMatchesList() {
            const container = document.getElementById('upcoming-matches-list');
            console.log('🔍 updateUpcomingMatchesList called, nextMatches:', nextMatches.length);
            
            if (nextMatches.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-calendar-plus text-4xl mb-4 text-gray-300"></i>
                        <p class="text-lg font-medium">ยังไม่มีแมทช์ที่กำลังจะมาถึง</p>
                        <p class="text-sm">เริ่มต้นด้วยการจัดแมทช์แรก</p>
                    </div>
                `;
                return;
            }
            
            // Sort by date and time (nearest first)
            const sortedMatches = [...nextMatches].sort((a, b) => {
                const dateA = new Date(a.date + 'T' + a.time);
                const dateB = new Date(b.date + 'T' + b.time);
                return dateA - dateB;
            });
            
            // Filter out past matches
            const now = new Date();
            const upcomingMatches = sortedMatches.filter(match => {
                const matchDateTime = new Date(match.date + 'T' + match.time);
                return matchDateTime > now;
            });
            
            if (upcomingMatches.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-clock text-4xl mb-4 text-gray-300"></i>
                        <p class="text-lg font-medium">ไม่มีแมทช์ที่กำลังจะมาถึง</p>
                        <p class="text-sm">แมทช์ทั้งหมดผ่านไปแล้ว กรุณาจัดแมทช์ใหม่</p>
                    </div>
                `;
                return;
            }
            
            // Create compact overview display
            container.innerHTML = `
                <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6 border border-green-200">
                    <div class="grid gap-4">
                        ${upcomingMatches.map((match, index) => {
                            const teamA = getTeamById(match.teamA);
                            const teamB = getTeamById(match.teamB);
                            const matchDateTime = new Date(match.date + 'T' + match.time);
                            const formattedDate = matchDateTime.toLocaleDateString('th-TH', { 
                                weekday: 'short', 
                                day: 'numeric', 
                                month: 'short' 
                            });
                            const formattedTime = matchDateTime.toLocaleTimeString('th-TH', { 
                                hour: '2-digit', 
                                minute: '2-digit' 
                            });
                            
                            // Calculate time until match
                            const timeUntil = matchDateTime - now;
                            const daysUntil = Math.floor(timeUntil / (1000 * 60 * 60 * 24));
                            const hoursUntil = Math.floor((timeUntil % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                            
                            let timeUntilText = '';
                            let urgencyColor = 'text-gray-600';
                            
                            if (daysUntil > 3) {
                                timeUntilText = `อีก ${daysUntil} วัน`;
                                urgencyColor = 'text-blue-600';
                            } else if (daysUntil > 1) {
                                timeUntilText = `อีก ${daysUntil} วัน`;
                                urgencyColor = 'text-yellow-600';
                            } else if (daysUntil === 1) {
                                timeUntilText = 'พรุ่งนี้';
                                urgencyColor = 'text-orange-600';
                            } else if (hoursUntil > 0) {
                                timeUntilText = `อีก ${hoursUntil} ชม.`;
                                urgencyColor = 'text-red-600';
                            } else {
                                timeUntilText = 'ใกล้เริ่ม!';
                                urgencyColor = 'text-red-700';
                            }
                            
                            const teamALogo = teamA.logo 
                                ? `<img src="${teamA.logo}" alt="${teamA.name}" class="w-10 h-10 rounded-full object-cover">`
                                : `<div class="w-10 h-10 rounded-full ${getColorClass(teamA.primaryColor)} flex items-center justify-center text-white font-bold text-sm">
                                    ${teamA.name.charAt(0)}
                                   </div>`;
                            
                            const teamBLogo = teamB.logo 
                                ? `<img src="${teamB.logo}" alt="${teamB.name}" class="w-10 h-10 rounded-full object-cover">`
                                : `<div class="w-10 h-10 rounded-full ${getColorClass(teamB.primaryColor)} flex items-center justify-center text-white font-bold text-sm">
                                    ${teamB.name.charAt(0)}
                                   </div>`;
                            
                            return `
                                <div class="bg-white rounded-lg p-4 shadow-sm border border-gray-100 hover:shadow-md transition-all cursor-pointer" onclick="toggleNextMatchActions(${match.id})">
                                    <!-- Date Header -->
                                    <div class="text-center mb-4">
                                        <div class="text-sm font-bold text-gray-700">${formattedDate} ${formattedTime}</div>
                                        <div class="text-xs font-bold ${urgencyColor}">${timeUntilText}</div>
                                        ${match.venue ? `<div class="text-xs text-gray-500 mt-1">📍 ${match.venue}</div>` : ''}
                                    </div>
                                    
                                    <!-- Teams Layout -->
                                    <div class="flex items-center justify-center space-x-6">
                                        <!-- Team A -->
                                        <div class="flex flex-col items-center space-y-2 flex-1">
                                            ${teamALogo}
                                            <span class="font-medium text-gray-800 text-center text-sm">${teamA.name}</span>
                                        </div>
                                        
                                        <!-- VS Center -->
                                        <div class="flex flex-col items-center">
                                            <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-4 py-2 rounded-full text-lg font-bold shadow-lg">
                                                VS
                                            </div>
                                        </div>
                                        
                                        <!-- Team B -->
                                        <div class="flex flex-col items-center space-y-2 flex-1">
                                            ${teamBLogo}
                                            <span class="font-medium text-gray-800 text-center text-sm">${teamB.name}</span>
                                        </div>
                                    </div>
                                    
                                    ${match.note ? `
                                        <div class="mt-4 pt-3 border-t border-gray-100">
                                            <div class="text-xs text-gray-600 text-center">
                                                <i class="fas fa-sticky-note mr-1"></i>
                                                ${match.note}
                                            </div>
                                        </div>
                                    ` : ''}
                                    
                                    <!-- Action buttons (Hidden by default) -->
                                    <div id="next-match-actions-${match.id}" class="hidden mt-4 pt-3 border-t border-gray-200">
                                        <div class="flex space-x-3 justify-center">
                                            <button onclick="editNextMatch(${match.id}); event.stopPropagation();" class="flex items-center justify-center py-2 px-4 bg-blue-100 hover:bg-blue-200 text-blue-600 rounded-lg transition-colors font-medium text-sm" title="แก้ไขแมทช์">
                                                <i class="fas fa-edit mr-2"></i>
                                                แก้ไข
                                            </button>
                                            <button onclick="deleteNextMatch(${match.id}); event.stopPropagation();" class="flex items-center justify-center py-2 px-4 bg-red-100 hover:bg-red-200 text-red-600 rounded-lg transition-colors font-medium text-sm" title="ลบแมทช์">
                                                <i class="fas fa-trash mr-2"></i>
                                                ลบ
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <!-- Summary footer -->
                    <div class="mt-6 pt-4 border-t border-green-200 flex items-center justify-between text-sm">
                        <div class="flex items-center space-x-4 text-gray-600">
                            <span><i class="fas fa-calendar-check mr-1 text-green-500"></i>แมทช์ต่อไป: <strong>${upcomingMatches.length}</strong> แมทช์</span>
                            ${nextMatches.length > upcomingMatches.length ? `
                                <span><i class="fas fa-clock mr-1 text-blue-500"></i>รวมทั้งหมด: <strong>${nextMatches.length}</strong> แมทช์</span>
                            ` : ''}
                        </div>
                        <div class="text-gray-500">
                            <i class="fas fa-info-circle mr-1"></i>
                            เรียงตามวันที่ใกล้ที่สุด
                        </div>
                    </div>
                </div>
            `;
        }

        // Player Actions Toggle Function
        function togglePlayerActions(playerId) {
            // Hide all other player actions first
            document.querySelectorAll('[id^="player-actions-"]').forEach(element => {
                if (element.id !== `player-actions-${playerId}`) {
                    element.classList.add('hidden');
                }
            });
            
            // Toggle the clicked player's actions
            const actionsElement = document.getElementById(`player-actions-${playerId}`);
            if (actionsElement) {
                actionsElement.classList.toggle('hidden');
            }
        }

        // Next Match Actions Toggle Function
        function toggleNextMatchActions(matchId) {
            // Hide all other match actions first
            document.querySelectorAll('[id^="next-match-actions-"]').forEach(element => {
                if (element.id !== `next-match-actions-${matchId}`) {
                    element.classList.add('hidden');
                }
            });
            
            // Toggle the clicked match's actions
            const actionsElement = document.getElementById(`next-match-actions-${matchId}`);
            if (actionsElement) {
                actionsElement.classList.toggle('hidden');
            }
        }

        // Leaderboard Functions
        function updateLeaderboard() {
            const teamStats = {};
            console.log('🔍 updateLeaderboard called, teams:', teams.length, 'matches:', matches.length);
            
            // Initialize team stats
            teams.forEach(team => {
                teamStats[team.id] = {
                    team: team,
                    played: 0,
                    won: 0,
                    drawn: 0,
                    lost: 0,
                    goalsFor: 0,
                    goalsAgainst: 0,
                    goalDifference: 0,
                    points: 0,
                    form: []
                };
            });
            
            // Calculate stats from matches (sorted by date for form calculation)
            const sortedMatches = [...matches].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            sortedMatches.forEach(match => {
                const teamAStats = teamStats[match.teamA];
                const teamBStats = teamStats[match.teamB];
                
                if (teamAStats && teamBStats) {
                    teamAStats.played++;
                    teamBStats.played++;
                    teamAStats.goalsFor += match.scoreA;
                    teamAStats.goalsAgainst += match.scoreB;
                    teamBStats.goalsFor += match.scoreB;
                    teamBStats.goalsAgainst += match.scoreA;
                    
                    if (match.scoreA > match.scoreB) {
                        teamAStats.won++;
                        teamAStats.points += 3;
                        teamBStats.lost++;
                        teamAStats.form.push('W');
                        teamBStats.form.push('L');
                    } else if (match.scoreB > match.scoreA) {
                        teamBStats.won++;
                        teamBStats.points += 3;
                        teamAStats.lost++;
                        teamBStats.form.push('W');
                        teamAStats.form.push('L');
                    } else {
                        teamAStats.drawn++;
                        teamBStats.drawn++;
                        teamAStats.points += 1;
                        teamBStats.points += 1;
                        teamAStats.form.push('D');
                        teamBStats.form.push('D');
                    }
                }
            });
            
            // Calculate goal difference and limit form to last 5 matches
            Object.values(teamStats).forEach(stats => {
                stats.goalDifference = stats.goalsFor - stats.goalsAgainst;
                stats.form = stats.form.slice(-5); // Keep only last 5 matches
            });
            
            // Sort teams by points, then goal difference, then goals for
            const sortedTeams = Object.values(teamStats).sort((a, b) => {
                if (b.points !== a.points) return b.points - a.points;
                if (b.goalDifference !== a.goalDifference) return b.goalDifference - a.goalDifference;
                return b.goalsFor - a.goalsFor;
            });
            
            // Update leaderboard container with banner
            const leaderboardContainer = document.getElementById('leaderboard');
            const existingBanner = leaderboardContainer.querySelector('.mb-8');
            
            // Create banner HTML if it doesn't exist
            if (!existingBanner) {
                const bannerHTML = `
                    <div class="mb-8">
                        <div class="bg-gradient-to-r from-blue-800 to-purple-800 text-white px-8 py-6 rounded-xl text-center">
                            <h2 class="text-3xl font-bold flex items-center justify-center mb-2">
                                <i class="fas fa-trophy mr-3 text-yellow-300"></i>
                                ตารางคะแนน JAKHONG LEAGUE
                            </h2>
                        </div>
                    </div>
                `;
                
                const glassEffect = leaderboardContainer.querySelector('.glass-effect');
                glassEffect.insertAdjacentHTML('afterbegin', bannerHTML);
            }
            
            // Update leaderboard table
            const tbody = document.querySelector('#leaderboard-table tbody');
            
            if (sortedTeams.length === 0) {
                tbody.innerHTML = '<tr><td colspan="11" class="text-center py-8 text-gray-500">ยังไม่มีข้อมูลตารางคะแนน</td></tr>';
                return;
            }
            
            tbody.innerHTML = sortedTeams.map((stats, index) => {
                let positionClass = '';
                let positionIcon = '';
                
                if (index === 0) {
                    positionClass = 'bg-gradient-to-r from-yellow-100 to-yellow-200 border-l-4 border-yellow-500 shadow-lg';
                    positionIcon = '<i class="fas fa-crown text-yellow-600 mr-1"></i>';
                } else if (index === 1) {
                    positionClass = 'bg-gradient-to-r from-gray-100 to-gray-200 border-l-4 border-gray-400 shadow-md';
                    positionIcon = '<i class="fas fa-medal text-gray-500 mr-1"></i>';
                } else if (index === 2) {
                    positionClass = 'bg-gradient-to-r from-orange-100 to-orange-200 border-l-4 border-orange-500 shadow-md';
                    positionIcon = '<i class="fas fa-medal text-orange-600 mr-1"></i>';
                }
                
                // Generate form display
                const formDisplay = stats.form.map(result => {
                    let formClass = '';
                    let formIcon = '';
                    
                    if (result === 'W') {
                        formClass = 'bg-green-500 text-white';
                        formIcon = 'W';
                    } else if (result === 'L') {
                        formClass = 'bg-red-500 text-white';
                        formIcon = 'L';
                    } else {
                        formClass = 'bg-yellow-500 text-white';
                        formIcon = 'D';
                    }
                    
                    return `<span class="inline-block w-6 h-6 ${formClass} rounded-full text-xs font-bold flex items-center justify-center mr-1">${formIcon}</span>`;
                }).join('');
                
                return `
                    <tr class="${positionClass} hover:bg-opacity-80 transition-all">
                        <td class="px-4 py-3 text-center font-bold text-lg">
                            ${positionIcon}${index + 1}
                        </td>
                        <td class="px-4 py-3">
                            <div class="flex items-center space-x-2">
                                ${stats.team.logo 
                                    ? `<img src="${stats.team.logo}" alt="${stats.team.name}" class="w-8 h-8 rounded-full object-cover">`
                                    : `<div class="w-8 h-8 rounded-full ${getColorClass(stats.team.primaryColor)} flex items-center justify-center text-white font-bold text-sm">
                                        ${stats.team.name.charAt(0)}
                                       </div>`
                                }
                                <span class="font-medium">${stats.team.name}</span>
                            </div>
                        </td>
                        <td class="px-4 py-3 text-center font-medium text-black">${stats.played}</td>
                        <td class="px-4 py-3 text-center font-bold text-black">${stats.won}</td>
                        <td class="px-4 py-3 text-center font-bold text-black">${stats.drawn}</td>
                        <td class="px-4 py-3 text-center font-bold text-black">${stats.lost}</td>
                        <td class="px-4 py-3 text-center font-medium text-black">${stats.goalsFor}</td>
                        <td class="px-4 py-3 text-center font-medium text-black">${stats.goalsAgainst}</td>
                        <td class="px-4 py-3 text-center font-bold text-black">
                            ${stats.goalDifference >= 0 ? '+' : ''}${stats.goalDifference}
                        </td>
                        <td class="px-4 py-3 text-center font-bold text-xl text-blue-600">${stats.points}</td>
                        <td class="px-4 py-3 text-center">
                            <div class="flex justify-center items-center">
                                ${formDisplay || '<span class="text-gray-400 text-xs">ไม่มีข้อมูล</span>'}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }


// ... (โค้ด JavaScript เดิมทั้งหมดของคุณจบตรงนี้) ...

// -----------------------------------------------
// โค้ด JavaScript ที่เพิ่มใหม่
// -----------------------------------------------
// ===============================================
// New Functionality: Auto-Save Form Data (Real-time Persistence)
// ใช้ Local Storage เพื่อบันทึกข้อมูลแบบ Real-time
// ===============================================

const MATCH_FORM_KEY = 'matchRecordAutoSave';
const matchFormElements = ['match-date', 'team-a', 'team-b', 'score-a', 'score-b'];

/**
 * 1. บันทึกข้อมูลฟอร์มปัจจุบันลงใน Local Storage
 */
function saveMatchFormData() {
    const data = {};
    matchFormElements.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            data[id] = element.value;
        }
    });
    // บันทึกเป็นสตริง JSON
    localStorage.setItem(MATCH_FORM_KEY, JSON.stringify(data));
    console.log('Match form data auto-saved.');
}

/**
 * 2. โหลดข้อมูลจาก Local Storage และกรอกกลับเข้าไปในฟอร์ม
 */
function loadMatchFormData() {
    const storedData = localStorage.getItem(MATCH_FORM_KEY);
    if (storedData) {
        try {
            const data = JSON.parse(storedData);
            matchFormElements.forEach(id => {
                const element = document.getElementById(id);
                // ตรวจสอบว่ามี element และมีค่าที่ถูกบันทึกไว้
                if (element && data[id] !== undefined) {
                    element.value = data[id];
                }
            });
            console.log('Match form data loaded from auto-save.');
        } catch (e) {
            console.error('Error parsing stored form data, clearing data.', e);
            localStorage.removeItem(MATCH_FORM_KEY); // ล้างข้อมูลที่เสียหาย
        }
    }
}

/**
 * 3. ผูก Event Listener เข้ากับฟิลด์ต่างๆ เพื่อเรียกใช้ saveMatchFormData เมื่อมีการเปลี่ยนแปลง
 */
function attachMatchFormAutoSaveListeners() {
    matchFormElements.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            // ใช้ 'input' สำหรับ input ทั่วไป และ 'change' สำหรับ select
            const eventType = (element.tagName === 'SELECT' || element.type === 'date') ? 'change' : 'input';
            element.addEventListener(eventType, saveMatchFormData);
        }
    });
}


// -----------------------------------------------
// 4. การเรียกใช้ฟังก์ชันเมื่อหน้าเว็บโหลดเสร็จ
// -----------------------------------------------
document.addEventListener('DOMContentLoaded', () => {
    // โหลดข้อมูลที่บันทึกอัตโนมัติ
    loadMatchFormData(); 
    // ผูก Event Listener เพื่อบันทึกข้อมูลอัตโนมัติ
    attachMatchFormAutoSaveListeners(); 
});


// -----------------------------------------------
// 5. อัปเดตฟังก์ชัน clearMatchForm (สำคัญ: ต้องแทนที่ฟังก์ชันเดิม)
// -----------------------------------------------
function clearMatchForm() {
    // ล้างค่าในฟอร์ม (ตามโค้ด HTML เดิมของคุณ)
    document.getElementById('match-date').value = '';
    document.getElementById('team-a').value = '';
    document.getElementById('team-b').value = '';
    document.getElementById('score-a').value = 0; 
    document.getElementById('score-b').value = 0; 
    
    // สำคัญ: ล้างข้อมูลที่บันทึกอัตโนมัติจาก Local Storage ด้วย
    localStorage.removeItem(MATCH_FORM_KEY); 
    
    // อัปเดต UI ให้ตรงกับการล้างข้อมูล (เช่น เรียกฟังก์ชันแสดงข้อความ)
    // showMessage('ฟอร์มถูกล้างแล้ว', 'info'); // หากมีฟังก์ชัน showMessage
}
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98d71c4750917b68',t:'MTc2MDI3NzQ5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>

<script>
// ===============================================
// NEW CODE BLOCK: UNIVERSAL AUTO-SAVE PERSISTENCE
// จัดการการบันทึก/โหลดข้อมูลหลักทุกส่วนของแอปพลิเคชัน
// ===============================================

// -----------------------------------------------
// 1. กำหนด Global Variables และ Keys
// -----------------------------------------------

// Map ข้อมูล Global Variable ที่ต้องการบันทึก: [Key สำหรับ Local Storage, ชื่อตัวแปร Global]
const DATA_STRUCTURES = {
    // ข้อมูลตารางคะแนน (Match History)
    'matchHistory': { key: 'APP_MATCH_HISTORY', variableName: 'matchHistory' }, 
    // ข้อมูลทีม (Team List)
    'teams': { key: 'APP_TEAM_LIST', variableName: 'teams' }, 
    // ข้อมูลรายชื่อนักกีฬา (สมมติว่าตัวแปรชื่อ 'players')
    'players': { key: 'APP_PLAYER_LIST', variableName: 'players' }, 
    // ข้อมูลตารางการแข่งขัน/แมตช์ต่อไป (สมมติว่าตัวแปรชื่อ 'schedule')
    'schedule': { key: 'APP_SCHEDULE', variableName: 'schedule' }
    // เพิ่มข้อมูลอื่นๆ ได้ที่นี่ เช่น 'settings', 'matchSummaries'
};

// Map ฟังก์ชันที่จะถูกห่อหุ้ม: [ชื่อฟังก์ชันเดิม, Array ของชื่อโครงสร้างข้อมูลที่ฟังก์ชันนั้นแก้ไข]
const FUNCTIONS_TO_WRAP = {
    // บันทึกผล, อัปเดตตารางคะแนน: แก้ไข matchHistory และ teams
    'updateLeaderboard': ['matchHistory', 'teams'], 
    
    // **แก้ไขจาก 'addTeam' เป็น 'handleTeamSubmit'**
    'handleTeamSubmit': ['teams'], 
    
    // **แก้ไขจาก 'addPlayer' เป็น 'handlePlayerSubmit'**
    'handlePlayerSubmit': ['players'], 
    
    // จัดการแมตช์ต่อไป: แก้ไข schedule
    'updateSchedule': ['schedule'], 
    
    // ฟังก์ชันแสดงผล UI (ใช้เป็นจุดบันทึกสำรองและโหลดรูปภาพ)
    'updatePlayersList': ['players', 'teams'], 
    
    // ฟังก์ชันสำหรับปุ่ม Manual Save (ต้องเปลี่ยนชื่อเป็นฟังก์ชันจริงที่เรียกใช้)
    'manualSaveAllData': ['matchHistory', 'teams', 'players', 'schedule', 'playerRecords', 'nextMatches'], // เพิ่ม keys ที่เหลือ
    
    // *** NEW FIX: เพิ่มฟังก์ชันอัปโหลดโลโก้ทีม (สำคัญมาก) ***
    'handleLogoUpload': ['teams'], 
    
    // *** NEW FIX: เพิ่มฟังก์ชันอัปโหลดรูปนักกีฬา (สำคัญมาก) ***
    'handlePlayerImageUpload': ['players'] 
};


/**
 * บันทึกข้อมูล Global Variable ที่กำหนดลงใน Firebase Firestore (Asynchronous)
 * @param {string} structName - ชื่อโครงสร้างข้อมูลจาก DATA_STRUCTURES (เช่น 'teams')
 */
async function saveToFirestore(structName) {
    const struct = DATA_STRUCTURES[structName];
    // ตรวจสอบว่ามีการเชื่อมต่อ Firestore (window.db) และตัวช่วยฟังก์ชัน (window.firebaseFirestore) หรือไม่
    // window.db และ window.firebaseFirestore ต้องถูกตั้งค่าใน <script type="module"> ก่อน
    if (!struct || !window.db || !window.firebaseFirestore) {
        console.error(`[Firestore SAVE] Firestore connection not fully initialized or DATA_STRUCTURES[${structName}] not found.`);
        // หาก Firebase ไม่พร้อม จะไม่ทำการบันทึก
        return; 
    }

    const globalVar = window[struct.variableName];

    try {
        // ใช้ชื่อ structName เป็นชื่อ Collection และ Document ID เป็น 'mainData'
        const docRef = window.firebaseFirestore.doc(window.db, structName, 'mainData'); 
        
        // setDoc คือการเขียนทับ/สร้าง Document ใหม่
        await window.firebaseFirestore.setDoc(docRef, { 
            // บันทึกข้อมูลทั้งหมดภายใต้คีย์ 'data'
            data: globalVar, 
            updatedAt: new Date().getTime()
        }); 

        console.log(`[Firestore SAVE] Data saved for: ${structName}`);
        
        // ฟังก์ชันแสดงข้อความสำเร็จ
        if (typeof showSuccessMessage === 'function') {
             showSuccessMessage(`บันทึกข้อมูล ${structName} ขึ้น Cloud สำเร็จ!`);
        }

    } catch (e) {
        console.error(`[Firestore SAVE] Error saving data for ${structName}.`, e);
        // ฟังก์ชันแสดงข้อความข้อผิดพลาด
        if (typeof showErrorMessage === 'function') {
             showErrorMessage(`ไม่สามารถบันทึกข้อมูล ${structName} ขึ้น Cloud ได้: ${e.message}`);
        }
    }
}
    
/**
 * โหลดข้อมูลจาก Firebase Firestore กลับเข้า Global Variable (Asynchronous)
 * @param {string} structName - ชื่อโครงสร้างข้อมูลจาก DATA_STRUCTURES (เช่น 'teams')
 * @returns {Promise<void>} - คืนค่า Promise เมื่อโหลดข้อมูลเสร็จสิ้น
 */
async function loadFromFirestore(structName) {
    const struct = DATA_STRUCTURES[structName];
    // ตรวจสอบว่ามีการเชื่อมต่อ Firestore (window.db) และตัวช่วยฟังก์ชัน (window.firebaseFirestore) หรือไม่
    // window.db และ window.firebaseFirestore ต้องถูกตั้งค่าใน <script type="module"> ก่อน
    if (!struct || !window.db || !window.firebaseFirestore) {
        console.error(`[Firestore LOAD] Firestore connection not fully initialized for ${structName}.`);
        return; 
    }

    try {
        // สร้าง Reference ไปยัง Document ที่เก็บข้อมูลหลักของ Collection นั้นๆ
        const docRef = window.firebaseFirestore.doc(window.db, structName, 'mainData');
        
        // ใช้ getDoc เพื่อโหลดข้อมูลเพียงครั้งเดียว (ต้องใช้ await)
        const docSnap = await window.firebaseFirestore.getDoc(docRef); 

        if (docSnap.exists()) {
            const loadedData = docSnap.data().data; // ดึงข้อมูลจากคีย์ 'data'
            
            // โหลดข้อมูลที่ได้กลับเข้าสู่ Global Variable
            if (window[struct.variableName] !== undefined) {
                window[struct.variableName] = loadedData;
                console.log(`[Firestore LOAD] Data loaded for: ${structName}`);
            }
        } else {
            console.log(`[Firestore LOAD] Document not found for: ${structName}. Using default variable value.`);
            // ถ้าไม่พบ Document จะปล่อยให้ตัวแปร Global ใช้ค่าเริ่มต้นที่กำหนดไว้
        }

    } catch (e) {
        console.error(`[Firestore LOAD] Error retrieving data for ${structName}.`, e);
        // ในกรณีที่เกิดข้อผิดพลาด ให้ใช้ค่าเริ่มต้น (Default Value) ที่กำหนดไว้
    }
}

// -----------------------------------------------
// 5. เปิดใช้งาน Auto-Save Logic
// -----------------------------------------------

// วนลูปเรียกใช้ wrapFunction สำหรับทุกฟังก์ชันที่กำหนดไว้
Object.keys(FUNCTIONS_TO_WRAP).forEach(funcName => {
    wrapFunction(funcName, FUNCTIONS_TO_WRAP[funcName]);
});
<script type="module">
    // 1. นำเข้า Firebase Modules ที่จำเป็น
    // - initializeApp: สำหรับเริ่มการทำงานของ Firebase
    // - Storage Modules: สำหรับอัปโหลดรูปภาพ
    // - Firestore Modules: *** NEW *** สำหรับจัดการข้อมูลหลัก
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-storage.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-firestore.js";
    
    // 2. ข้อมูล Config ของโปรเจกต์ของคุณ
    const firebaseConfig = {
        apiKey: "AIzaSyDRhbcfmYVWV0rjwZYyIVFFoqDdMjipXMk", 
        authDomain: "footballprogram-93b7d.firebaseapp.com",
        projectId: "footballprogram-93b7d",
        storageBucket: "footballprogram-93b7d.firebasestorage.app",
        messagingSenderId: "242565780267",
        appId: "1:242565780267:web:f5ccc63cec293be2de6b6e"
    };

    // 3. เริ่มเชื่อมต่อ Firebase และสร้าง Global Variable
    const app = initializeApp(firebaseConfig);
    
    // A. Storage Instance (สำหรับรูปภาพ)
    window.firebaseStorage = getStorage(app); 
    
    // B. Firestore Instance (สำหรับข้อมูลหลัก)
    window.db = getFirestore(app);
    
    // C. *** สำคัญที่สุด: สร้าง Global Object เพื่อส่ง Firestore API ให้โค้ดภายนอกใช้งาน ***
    // โค้ดนี้ทำให้ฟังก์ชัน saveToFirestore และ loadFromFirestore ที่อยู่ใน <script> ธรรมดา เรียกใช้ API ของ Firestore ได้
    window.firebaseFirestore = { getFirestore, doc, setDoc, getDoc };
    
    console.log("Firebase initialized. Storage and Firestore are ready.");
</script>

</body>
</html>
