<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏ô‡∏≤‡∏°‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏• Jakhong (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap" rel="stylesheet">
  
<style>
  body {
    font-family: 'Kanit', sans-serif;
    background-color: #f7f7f7;
    padding: 20px;
  }
  @layer components {
    .input { @apply w-full rounded-xl border border-slate-300 px-3 py-2 text-sm
                   focus:outline-none focus:ring-2 focus:ring-slate-400; }
    .lbl   { @apply block mb-1 text-sm font-medium text-slate-700; }

    .btn   { @apply inline-flex items-center justify-center rounded-xl px-3 py-2 text-sm font-medium
                     border transition shadow-sm hover:shadow active:scale-[.99]; }
    .btn-primary { @apply bg-blue-600 text-white border-blue-700 hover:bg-blue-700; }
    /* ‡πÄ‡∏û‡∏¥‡πà‡∏° overflow-hidden ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏¢‡πà‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï */
    .avatar { @apply w-20 h-20 bg-slate-200 rounded-full flex items-center justify-center text-3xl overflow-hidden; } 
  }
</style>
</head>
<body>

  <div class="max-w-xl mx-auto bg-white p-6 rounded-xl shadow-lg">
    <h1 class="text-2xl font-bold mb-4">‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤</h1>

    <form id="rosterForm">
      <div class="mb-4 flex gap-4 items-center">
        <div id="preview" class="avatar cursor-pointer" onclick="$('#npPhoto').click()">üë§</div>
        <div>
          <input type="file" id="npPhoto" class="hidden" accept="image/*">
          <button type="button" id="btnPickPhoto" class="btn btn-primary mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</button>
          <button type="button" id="btnClearPhoto" class="btn bg-red-500 text-white border-red-600 hover:bg-red-600">‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ</button>
        </div>
      </div>

      <div class="mb-4">
        <label for="npName" class="lbl">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤</label>
        <input type="text" id="npName" class="input" required>
      </div>

      <div class="mb-4">
        <label for="npNumber" class="lbl">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏™‡∏∑‡πâ‡∏≠</label>
        <input type="text" id="npNumber" class="input">
      </div>
      
      <select id="selRosterTeam" class="hidden"><option value="team1">Team A</option></select>
      <input type="hidden" id="npPos" value="Forward">
      <input type="hidden" id="npBirth">
      <input type="hidden" id="npAge">
      
      <div class="mb-4">
        <label for="teamColor" class="lbl">‡∏™‡∏µ‡∏ó‡∏µ‡∏°</label>
        <input type="color" id="teamColor" value="#0000ff" class="w-full h-10">
      </div>
      
      <button type="submit" id="btnAddPlayer" class="btn btn-primary w-full mt-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤</button>
    </form>
    
    <h2 class="text-xl font-semibold mt-8 mb-4">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤ (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)</h2>
    <div id="rosterGrid" class="grid grid-cols-2 gap-4">
      </div>
  </div>

  <script>
    // --------------------------------------------------------------------------------------
    // ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: Global Variables ‡πÅ‡∏•‡∏∞ Core Utilities (‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á isInitialized Flag)
    // --------------------------------------------------------------------------------------
    let state; 
    let tempPlayerPhoto = ''; 
    let isInitialized = false; // <<< Flag ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏≤‡∏¢
    
    const $ = (selector, parent = document) => parent.querySelector(selector);
    const $$ = (selector, parent = document) => parent.querySelectorAll(selector);

    // Placeholder Function: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    function createInitialState() {
        return {
            teams: [{ 
                id: 'team1', 
                name: 'Team Placeholder', 
                color: '#0000ff', 
                roster: [],
                logo: null
            }],
            currentNav: 'roster' // ‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏µ Navigation
        };
    }
    
    // Placeholder Function: ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏µ‡∏ó‡∏µ‡∏°
    function applyRosterColor(team) { 
        // Logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ UI
    } 

    // Placeholder Function: ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
    function renderRosterGrid(team) { 
        const grid = $('#rosterGrid');
        if (!grid) return;
        const teamId = $('#selRosterTeam')?.value || 'team1';
        const teamData = state.teams.find(t => t.id === teamId);

        if (!teamData) {
            grid.innerHTML = '<p class="text-slate-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°</p>';
            return;
        }

        grid.innerHTML = teamData.roster.map(p => `
          <div class="p-2 border rounded-lg flex items-center gap-3">
            <div class="avatar w-10 h-10 flex-shrink-0">
              <img src="${p.photo || ''}" class="w-full h-full object-cover" alt="Photo">
            </div>
            <span>${p.name} (#${p.number})</span>
          </div>
        `).join('');
    }

    // Placeholder Function: ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
    function wireNavigation() {}
    function wireRosterFormToggle() {}
    function wireMatchControls() {}
    function wireStatsButtons() {}
    function wireClearStatsButton() {}
    function wireTeamLogoPickers() {}
    function wireTeamCRUD() {}
    function wireRosterTeamSwitcher() {}
    function wireStatsHistoryActions() {}
    function wireGlobalClearButton() {}
    function renderTeamSelects() {}
    function renderPlayerDropdowns() {}
    function renderTable() {}
    function renderDashboard() {}
    function renderMatchLog() {}
    function renderTopStats() {}
    function renderRosterHooks() {}
    function renderStatsHistory() {}
    function renderActivities() {}
    function renderTeamContacts() {}
    function calcAgeFromISO() { return 25; } // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
    

    // --------------------------------------------------------------------------------------
    // ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: State Management (Save/Load - ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏≤‡∏¢)
    // --------------------------------------------------------------------------------------

    function save() {
      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å Initialize ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
      if (!isInitialized) {
        console.warn('Attempted to save state before initialization complete. Save prevented.');
        return;
      }
      localStorage.setItem('state', JSON.stringify(state));
      // ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ Firebase
      // firestore.collection('users').doc('user1').set(state);
      console.log('State saved successfully.');
    }

    function load() {
      const json = localStorage.getItem('state');
      if (json) {
        try {
          state = JSON.parse(json);
          console.log('State loaded successfully from localStorage.');
        } catch (e) {
          console.error('Failed to parse state from localStorage. Using initial state.', e);
          state = createInitialState(); 
        }
      } else {
          state = createInitialState();
      }
    }


    // --------------------------------------------------------------------------------------
    // ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: Roster (Upload/Add - ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ)
    // --------------------------------------------------------------------------------------
    
    /* ---------- Roster Photo Pickers (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå) ---------- */
    function wireRosterPhotoPickers(){
      $('#btnPickPhoto')?.addEventListener('click', ()=> $('#npPhoto')?.click());
      
      $('#btnClearPhoto')?.addEventListener('click', ()=>{
        tempPlayerPhoto=''; 
        if($('#preview')) $('#preview').innerHTML='üë§'; 
        if($('#npPhoto')) $('#npPhoto').value='';
        
        // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
        $('#btnAddPlayer')?.removeAttribute('disabled'); 
        $('#btnAddPlayer')?.textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤'; 
      });

      // --- ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: Canvas Resize + Async Control (‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ iPad ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î) ---
      $('#npPhoto')?.addEventListener('change', e=>{
        const file = e.target.files?.[0]; 
        if(!file) return;

        if(!file.type.startsWith('image/')){ 
            alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û'); 
            e.target.value=''; 
            return; 
        }
        
        // 1. ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡∏à‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°)
        $('#btnAddPlayer')?.setAttribute('disabled', 'true');
        $('#btnAddPlayer')?.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏£‡∏π‡∏õ...'; 

        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => {
            const MAX_SIZE = 800; // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 800px
            let width = img.width;
            let height = img.height;
            
            // Logic ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏¢‡πà‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î (‡∏£‡∏±‡∏Å‡∏©‡∏≤ Aspect Ratio)
            if (width > height && width > MAX_SIZE) {
              height *= MAX_SIZE / width;
              width = MAX_SIZE;
            } else if (height > width && height > MAX_SIZE) {
              width *= MAX_SIZE / height;
              height = MAX_SIZE;
            } else if (width > MAX_SIZE) { 
               width = height = MAX_SIZE;
            }

            const canvas = document.createElement('canvas');
            canvas.width = width;
            canvas.height = height;

            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);

            const compressedBase64 = canvas.toDataURL('image/jpeg', 0.8);

            // 2. ‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö Base64 ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            tempPlayerPhoto = compressedBase64; 
            if($('#preview')) {
                $('#preview').innerHTML = `<img src="${tempPlayerPhoto}" class="w-full h-full object-cover">`; 
            }
            
            // 3. ‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
            $('#btnAddPlayer')?.removeAttribute('disabled');
            $('#btnAddPlayer')?.textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤';
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      });
      
      // Hook ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î/‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
      $('#npBirth')?.addEventListener('input', ()=>{
        const iso=$('#npBirth')?.value;
        const a=calcAgeFromISO(iso);
        if($('#npAge') && (a||a===0)) $('#npAge').value=a;
      });
    }

    /* ---------- Roster (Add Player) ---------- */
    function wireAddPlayer(){
      $('#rosterForm')?.addEventListener('submit', (e)=>{
        e.preventDefault();

        const teamId = $('#selRosterTeam')?.value || 'team1'; 
        const t = state.teams.find(x=>x.id===teamId);
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö: ‡∏´‡∏≤‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏±‡∏á‡∏ñ‡∏π‡∏Å disabled ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏£‡∏π‡∏õ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à
        if ($('#btnAddPlayer')?.hasAttribute('disabled')) {
            alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å');
            return;
        }

        const newPlayer = {
          id: Date.now().toString(),
          name: $('#npName').value, 
          number: $('#npNumber').value || '',
          pos: $('#npPos').value || 'Forward',
          age: $('#npAge')?.value || '',
          photo: tempPlayerPhoto, // <<< ‡πÉ‡∏ä‡πâ tempPlayerPhoto ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÅ‡∏•‡πâ‡∏ß
          // ... (Stats ‡πÅ‡∏•‡∏∞ fields ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
        };
        
        if (t) t.roster.push(newPlayer);
        
        // 8. Reset form and save
        $('#npName').value = ''; 
        $('#npNumber').value = ''; 
        $('#npPhoto').value = ''; 
        tempPlayerPhoto = ''; // <<< ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Base64
        
        if($('#preview')) $('#preview').innerHTML='üë§';
        
        save(); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        if (t) renderRosterGrid(t);
      });
    }

    // --------------------------------------------------------------------------------------
    // ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4: Boot (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏≤‡∏¢)
    // --------------------------------------------------------------------------------------

    /* ---------- Boot ---------- */
    document.addEventListener('DOMContentLoaded', ()=> {
      load?.(); // 1. ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°
      
      // 2. Wire ALL event listeners (‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
      wireNavigation();
      wireRosterFormToggle?.();
      wireMatchControls?.();
      wireStatsButtons?.();
      wireClearStatsButton?.();
      wireTeamLogoPickers?.();
      wireTeamCRUD?.();
      wireRosterPhotoPickers?.(); // <= ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
      wireAddPlayer?.();
      wireRosterTeamSwitcher();  
      wireStatsHistoryActions();
      wireGlobalClearButton(); 
      
      // 3. Render ALL initial UI elements (‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
      renderTeamSelects?.();
      renderPlayerDropdowns?.();
      renderTable?.();
      renderDashboard?.();
      renderMatchLog?.();
      renderRosterGrid(state.teams[0]); // ‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
      renderTopStats?.();
      renderRosterHooks?.();
      renderStatsHistory();
      renderActivities();
      renderTeamContacts?.();

      // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ nav ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô submit
      $$('.nav-btn').forEach(btn => { if (btn.tagName === 'BUTTON') btn.type = 'button'; });

      // --- ‡∏™‡∏µ‡∏ó‡∏µ‡∏°: ‡∏ú‡∏π‡∏Å‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å) ---
      $('#teamColor')?.addEventListener('input', (e)=> {
        const teamId = $('#selRosterTeam')?.value || 'team1'; 
        const t = state.teams.find(x=>x.id===teamId);
        if (t) { 
          t.color = e.target.value; 
          save(); // ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å save() ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏£‡∏≤‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏î‡πâ‡∏ß‡∏¢ isInitialized flag
        }
        applyRosterColor(t);
      });

      // ******* ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏•‡πâ‡∏ß *******
      isInitialized = true; 
      // ********************************************************************************
    });
  </script>
</body>
</html>
