<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏• ‚Äî CE v2</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{ color-scheme:light; --team-color:#16a34a; --team-contrast:#ffffff }
    body{font-family:'Kanit',system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    .page{display:none}.page.active{display:block}
    .btn{border-radius:.9rem;padding:.55rem .9rem;font-weight:700;cursor:pointer}
    .btn-main{background:#0ea5e9;color:#fff;box-shadow:0 8px 18px rgba(14,165,233,.25)}
    .btn-s{background:#3b82f6;color:#fff;border-radius:.9rem;padding:.5rem .9rem}
    .btn-danger{background:#ef4444;color:#fff;border-radius:.9rem;padding:.5rem .9rem}
    .inp,.sel{width:100%;padding:.7rem;border:2px solid #e5e7eb;border-radius:.9rem;background:#fff}
    .inp:focus,.sel:focus{outline:none;border-color:#93c5fd;box-shadow:0 0 0 4px rgba(147,197,253,.3)}
    /* player card */
    .player-card{position:relative;background:#fff;border-radius:1.1rem;border:1px solid rgba(2,6,23,.06);
      padding:.85rem;display:flex;gap:.8rem;align-items:center;
      box-shadow:0 18px 30px rgba(2,6,23,.06),0 2px 6px rgba(2,6,23,.04),inset 0 1px 0 rgba(255,255,255,.9)}
    .player-card:hover{transform:translateY(-2px);transition:.2s ease;box-shadow:0 22px 36px rgba(2,6,23,.10),0 4px 10px rgba(2,6,23,.06)}
    .player-avatar{width:56px;height:56px;border-radius:14px;overflow:hidden;box-shadow:0 4px 10px rgba(2,6,23,.12)}
    .num-badge{position:absolute;left:44px;top:-6px;transform:translateX(-50%);
      background:var(--team-color);color:var(--team-contrast);font-weight:800;
      border-radius:999px;padding:.18rem .5rem;font-size:.7rem;box-shadow:0 4px 10px rgba(0,0,0,.25)}
    .chip{border:1px solid rgba(2,6,23,.08);background:linear-gradient(180deg,#fff,rgba(255,255,255,.92));
      border-radius:999px;padding:.1rem .5rem;font-size:.72rem}
    .team-header{background:var(--team-color);color:var(--team-contrast);border-radius:1rem;
      padding:.9rem 1rem;box-shadow:inset 0 -2px 0 rgba(255,255,255,.25),0 10px 24px rgba(0,0,0,.08)}
  </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 min-h-screen">

  <!-- Header -->
  <header class="bg-white/90 backdrop-blur shadow sticky top-0 z-50">
    <div class="container mx-auto px-4 py-3 flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
      <h1 class="text-xl md:text-2xl font-bold text-gray-800">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏• ‚Äî CE v2</h1>
      <div class="flex gap-2">
        <button id="btnSave" class="btn-s">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button id="btnExport" class="btn-s">üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å</button>
        <label class="btn-s cursor-pointer">üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤<input id="importFile" type="file" accept="application/json" class="hidden"></label>
        <button id="btnClear" class="btn-danger">üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      </div>
    </div>
  </header>

  <!-- Nav -->
  <nav class="bg-white shadow">
    <div class="container mx-auto px-4 py-2 grid grid-cols-3 md:grid-cols-6 gap-2">
      <button class="tab btn-s active" data-p="dashboard">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
      <button class="tab btn-s" data-p="table">üèÜ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
      <button class="tab btn-s" data-p="match">‚öΩ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•</button>
      <button class="tab btn-s" data-p="players">üë§ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</button>
      <button class="tab btn-s" data-p="teams">‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°</button>
      <button class="tab btn-s" data-p="roster">üìã ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤</button>
    </div>
  </nav>

  <main class="container mx-auto px-4 py-6 space-y-6">
    <!-- Dashboard -->
    <section id="dashboard" class="page active">...</section>

    <!-- Table -->
    <section id="table" class="page">...</section>

    <!-- Match -->
    <section id="match" class="page">...</section>

    <!-- Players -->
    <section id="players" class="page">...</section>

    <!-- Teams -->
    <section id="teams" class="page">...</section>

    <!-- Roster -->
    <section id="roster" class="page">
      <div class="bg-white rounded-2xl shadow p-5 mb-4 flex flex-col md:flex-row gap-3 md:items-center md:justify-between">
        <div class="flex items-center gap-2">
          <span class="font-semibold">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°:</span>
          <select id="selRosterTeam" class="sel w-56"></select>
        </div>
        <div class="flex items-center gap-3">
          <input id="teamColor" type="color" value="#16a34a" class="w-10 h-8 p-0 border rounded-lg">
          <button id="btnToggleAddPlayer" class="btn-main">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤</button>
        </div>
      </div>

      <div id="addPlayerForm" class="bg-white rounded-2xl shadow p-5 mb-5 hidden">
        <h3 class="text-center font-bold text-gray-800 mb-3">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
          <div class="flex flex-col items-center gap-3">
            <div id="preview" class="player-avatar grid place-items-center bg-slate-100 text-3xl">üë§</div>
            <input id="npPhoto" type="file" accept="image/*" class="hidden">
            <div class="flex gap-2">
              <button id="btnPickPhoto" class="btn-s">üì∑ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</button>
              <button id="btnClearPhoto" class="btn-danger">üßπ ‡∏•‡∏ö‡∏£‡∏π‡∏õ</button>
            </div>
          </div>

          <div class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-3">
            <div><label class="lbl">‡∏ó‡∏µ‡∏° *</label><select id="npTeam" class="sel"></select></div>
            <div><label class="lbl">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label><input id="npName" class="inp"></div>
            <div><label class="lbl">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á *</label>
              <select id="npPos" class="sel">
                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á --</option>
                <option value="goalkeeper">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏õ‡∏£‡∏∞‡∏ï‡∏π</option>
                <option value="defender">‡∏Å‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á</option>
                <option value="midfielder">‡∏Å‡∏≠‡∏á‡∏Å‡∏•‡∏≤‡∏á</option>
                <option value="forward">‡∏Å‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤</option>
              </select>
            </div>
            <div><label class="lbl">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏™‡∏∑‡πâ‡∏≠</label><input id="npNum" type="number" min="1" max="99" class="inp"></div>
            <div><label class="lbl">‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î</label><input id="npBirth" type="date" class="inp"></div>
            <div><label class="lbl">‡∏≠‡∏≤‡∏¢‡∏∏ *</label><input id="npAge" type="number" class="inp" placeholder="‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥"></div>
            <div class="md:col-span-2 flex gap-2 justify-center mt-2">
              <button id="btnAddNewPlayer" class="btn-main">‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤</button>
              <button id="btnClearNewPlayer" class="btn-s">üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
              <button id="btnDownloadRoster" class="btn-s">‚¨áÔ∏è ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°</button>
              <button id="btnCancelNewPlayer" class="btn-danger">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
          </div>
        </div>
      </div>

      <div class="team-header mb-4"><h2 class="font-bold text-xl">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°: <span id="rosterTeamName">-</span></h2></div>
      <div id="rosterGrid" class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
    </section>
  </main>

  <script>
    const STORAGE_KEY='football_state_ce_v2';
    const $=(s,r=document)=>r.querySelector(s);
    const esc=s=>String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');

    let state={teams:[]};
    function save(){localStorage.setItem(STORAGE_KEY,JSON.stringify(state));}
    function load(){try{state=JSON.parse(localStorage.getItem(STORAGE_KEY))||{teams:[]}}catch{state={teams:[]}}}

    function calcAgeFromISO(iso){if(!iso)return'';const b=new Date(iso),t=new Date();let a=t.getFullYear()-b.getFullYear();const m=t.getMonth()-b.getMonth();if(m<0||(m===0&&t.getDate()<b.getDate()))a--;return a;}

    // render roster grid
    function renderRosterGrid(){
      const teamId=$('#selRosterTeam').value;const team=state.teams.find(t=>t.id===teamId);
      $('#rosterTeamName').textContent=team?.name||'-';
      const grid=$('#rosterGrid');
      grid.innerHTML=(team?.members||[]).map(p=>`
        <div class="player-card">
          <div class="relative">
            <span class="num-badge">#${p.num||'-'}</span>
            <img src="${p.photo||''}" alt="${esc(p.name)}" class="player-avatar object-cover">
          </div>
          <div class="min-w-0">
            <div class="font-bold truncate">${esc(p.name)}</div>
            <div class="flex flex-wrap items-center gap-2 text-xs text-slate-600 mt-0.5">
              <span class="chip">${p.pos}</span>
              <span class="chip">‡∏≠‡∏≤‡∏¢‡∏∏ ${p.age??''}</span>
              <span class="chip">${(p.birth||'').split('-').reverse().join('/')}</span>
            </div>
          </div>
        </div>`).join('');
    }

    // add player
    let tempPlayerPhoto='';
    $('#btnPickPhoto')?.addEventListener('click',()=>$('#npPhoto').click());
    $('#btnClearPhoto')?.addEventListener('click',()=>{tempPlayerPhoto='';$('#preview').innerHTML='üë§';$('#npPhoto').value='';});
    $('#npPhoto')?.addEventListener('change',e=>{
      const f=e.target.files?.[0];if(!f)return;
      const r=new FileReader();r.onload=ev=>{tempPlayerPhoto=ev.target.result;$('#preview').innerHTML=`<img src=\"${tempPlayerPhoto}\" class=\"w-full h-full object-cover\">`;};r.readAsDataURL(f);
    });
    $('#npBirth')?.addEventListener('input',()=>{$('#npAge').value=calcAgeFromISO($('#npBirth').value);});

    $('#btnAddNewPlayer')?.addEventListener('click',()=>{
      const teamId=$('#npTeam').value;const team=state.teams.find(t=>t.id===teamId);if(!team)return;
      const name=$('#npName').value.trim(),pos=$('#npPos').value,num=$('#npNum').value;
      const birth=$('#npBirth').value,age=parseInt($('#npAge').value||calcAgeFromISO(birth)||0,10);
      if(!name||!pos||!age)return alert('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö');
      team.members.push({id:Date.now(),name,pos,num,birth,age,photo:tempPlayerPhoto||''});
      save();renderRosterGrid();
      ['npName','npPos','npNum','npBirth','npAge'].forEach(k=>$('#'+k).value='');tempPlayerPhoto='';$('#preview').innerHTML='üë§';$('#npPhoto').value='';
    });

    $('#btnDownloadRoster')?.addEventListener('click',()=>{
      const teamId=$('#selRosterTeam').value;const team=state.teams.find(t=>t.id===teamId);if(!team)return;
      const blob=new Blob([JSON.stringify({team:team.name,players:team.members},null,2)],{type:'application/json'});
      const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`roster-${team.name}.json`;a.click();URL.revokeObjectURL(url);
    });

    $('#btnToggleAddPlayer')?.addEventListener('click',()=>$('#addPlayerForm').classList.toggle('hidden'));
    $('#selRosterTeam')?.addEventListener('change',renderRosterGrid);

    function init(){
      load();
      if(!state.teams.length) state.teams=[{id:'t1',name:'Jakhong',logo:'',members:[]}];
      $('#selRosterTeam').innerHTML=state.teams.map(t=>`<option value=\"${t.id}\">${esc(t.name)}</option>`).join('');
      $('#npTeam').innerHTML=$('#selRosterTeam').innerHTML;
      renderRosterGrid();
    }
    document.addEventListener('DOMContentLoaded',init);
  </script>
</body>
</html>
